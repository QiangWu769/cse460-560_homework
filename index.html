<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSE460 Complete Visualization - Interactive Database Concepts</title>
  <style>
    /* === CSS RESET AND BASE === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'SF Pro Display', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      line-height: 1.6;
      word-spacing: 0.2em;
    }

    /* === LAYOUT GRID === */
    .app-container {
      display: grid;
      grid-template-areas:
        "header header"
        "sidebar content";
      grid-template-columns: 320px 1fr;
      grid-template-rows: auto 1fr;
      min-height: 100vh;
      background: white;
      box-shadow: 0 0 50px rgba(0,0,0,0.1);
    }

    /* === HEADER === */
    .app-header {
      grid-area: header;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 25px 40px;
      position: relative;
      overflow: hidden;
    }

    .app-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='5' cy='5' r='5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .app-title {
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 8px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .app-subtitle {
      font-size: 1.2em;
      opacity: 0.9;
      font-weight: 400;
    }

    .search-container {
      position: absolute;
      top: 50%;
      right: 40px;
      transform: translateY(-50%);
    }

    .search-input {
      padding: 10px 15px;
      border: none;
      border-radius: 25px;
      background: rgba(255,255,255,0.2);
      color: white;
      placeholder-color: rgba(255,255,255,0.7);
      font-size: 1em;
      width: 250px;
      backdrop-filter: blur(10px);
    }

    .search-input::placeholder {
      color: rgba(255,255,255,0.7);
    }

    /* === SIDEBAR NAVIGATION === */
    .sidebar {
      grid-area: sidebar;
      background: #f8f9fa;
      border-right: 1px solid #e9ecef;
      overflow-y: auto;
      height: calc(100vh - 120px);
    }

    .nav-section {
      border-bottom: 1px solid #e9ecef;
    }

    .nav-problem {
      display: block;
      width: 100%;
      padding: 20px 25px;
      background: transparent;
      border: none;
      text-align: left;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-problem:hover {
      background: rgba(79, 172, 254, 0.05);
    }

    .nav-problem.active {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }

    .nav-problem.active::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: #007bff;
    }

    .problem-indicator {
      display: inline-block;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #6c757d;
      color: white;
      text-align: center;
      line-height: 24px;
      font-size: 0.8em;
      font-weight: bold;
      margin-right: 12px;
    }

    .nav-problem.active .problem-indicator {
      background: rgba(255,255,255,0.3);
    }

    .nav-subproblems {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: #ffffff;
    }

    .nav-subproblems.expanded {
      max-height: 500px;
    }

    .nav-subproblem {
      display: block;
      width: 100%;
      padding: 12px 25px 12px 60px;
      background: transparent;
      border: none;
      text-align: left;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .nav-subproblem:hover {
      background: #f8f9fa;
      border-left-color: #dee2e6;
    }

    .nav-subproblem.active {
      background: #e3f2fd;
      border-left-color: #2196f3;
      font-weight: 600;
      color: #1976d2;
    }

    .subproblem-status {
      float: right;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      margin-top: 2px;
    }

    .status-completed {
      background: #28a745;
    }

    .status-current {
      background: #ffc107;
    }

    .status-pending {
      background: #6c757d;
      opacity: 0.3;
    }

    .difficulty-indicator {
      margin-left: 8px;
      color: #dc3545;
      font-weight: bold;
    }

    /* === MAIN CONTENT AREA === */
    .content-area {
      grid-area: content;
      padding: 0;
      overflow-y: auto;
      height: calc(100vh - 120px);
      background: white;
    }

    .content-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 25px 40px;
      border-bottom: 1px solid #e9ecef;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .breadcrumb {
      color: #6c757d;
      font-size: 0.9em;
      margin-bottom: 8px;
    }

    .breadcrumb a {
      color: #007bff;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .content-title {
      font-size: 2em;
      color: #2c3e50;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .content-description {
      color: #6c757d;
      font-size: 1.1em;
    }

    .content-body {
      padding: 40px;
    }

    /* === PROBLEM CONTENT STYLES === */
    .problem-content {
      display: none;
    }

    .problem-content.active {
      display: block;
    }

    .method-selector {
      display: flex;
      gap: 12px;
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .method-btn {
      padding: 10px 20px;
      border: 2px solid #007bff;
      background: white;
      color: #007bff;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .method-btn:hover {
      background: #007bff;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    }

    .method-btn.active {
      background: #007bff;
      color: white;
    }

    .method-button {
      padding: 10px 20px;
      border: 2px solid #007bff;
      background: white;
      color: #007bff;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .method-button:hover {
      background: #f0f8ff;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,123,255,0.2);
    }

    .method-button.active {
      background: #007bff;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    }

    /* === DATA TABLES === */
    .database-schema {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .schema-title {
      font-size: 1.4em;
      color: #495057;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .table-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
    }

    .data-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .data-table:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .table-name {
      background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);
      color: white;
      padding: 15px 20px;
      font-weight: 700;
      font-size: 1.1em;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e9ecef;
      transition: all 0.3s ease;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #495057;
      font-size: 0.95em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    tr:hover td {
      background: #e3f2fd;
    }

    /* === STEP CONTROL === */
    .controls {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      text-align: center;
      border: 1px solid #e9ecef;
    }

    .btn {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      margin: 0 8px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,123,255,0.2);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,123,255,0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-reset {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      box-shadow: 0 2px 8px rgba(220,53,69,0.2);
    }

    .btn-reset:hover {
      box-shadow: 0 4px 16px rgba(220,53,69,0.3);
    }

    .step-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .step-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #dee2e6;
      transition: all 0.3s ease;
    }

    .step-dot.active {
      background: #007bff;
      transform: scale(1.3);
    }

    .step-dot.completed {
      background: #28a745;
    }

    /* === STEP INFO AND RESULTS === */
    .step-info {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      border-left: 4px solid #007bff;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }

    .sql-code {
      background: #2d3748;
      color: #e2e8f0;
      padding: 25px;
      border-radius: 12px;
      font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
      font-size: 0.95em;
      line-height: 1.8;
      overflow-x: auto;
      margin: 20px 0;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
      white-space: pre-line;
    }

    .sql-keyword { color: #63b3ed; font-weight: bold; }
    .sql-string { color: #68d391; }
    .sql-comment { color: #a0aec0; font-style: italic; }
    .sql-function { color: #fbb6ce; }

    .intermediate-results {
      margin: 25px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border-left: 4px solid #28a745;
    }

    .result-explanation {
      background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
      border: 1px solid #28a745;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    /* === TABLE HIGHLIGHTING === */
    .highlighted {
      background: #fff3cd !important;
      border-left: 4px solid #ffc107;
    }

    .result-row {
      background: #d4edda !important;
      border-left: 4px solid #28a745;
      font-weight: 600;
    }

    .filtered-out {
      background: #f8d7da !important;
      opacity: 0.6;
      text-decoration: line-through;
    }

    .error-highlight {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
    }

    .capable {
      background: #d1ecf1 !important;
      border-left: 4px solid #17a2b8;
      font-weight: 600;
    }

    .incapable {
      background: #f8d7da !important;
      border-left: 4px solid #dc3545;
      opacity: 0.7;
    }

    .high-salary {
      background: #d1ecf1 !important;
      border-left: 4px solid #17a2b8;
      font-weight: 600;
    }

    .certified-aircraft {
      background: #fff3cd !important;
      border-left: 4px solid #ffc107;
      font-weight: 500;
    }

    .long-range {
      background: #d4edda !important;
      color: #155724 !important;
      border-left: 4px solid #28a745;
    }

    .boeing-aircraft {
      background: #f8d7da !important;
      color: #721c24 !important;
      border-left: 4px solid #dc3545;
    }

    /* Problem 3 Highlighting */
    .highlight-step1 {
      background: #e3f2fd !important;
      color: #1565c0 !important;
      border-left: 4px solid #2196f3;
    }

    .highlight-step2 {
      background: #e8f5e8 !important;
      color: #2e7d32 !important;
      border-left: 4px solid #4caf50;
    }

    .highlight-missing {
      background: #fff3e0 !important;
      color: #e65100 !important;
      border-left: 4px solid #ff9800;
    }

    /* === RESPONSIVE DESIGN === */
    @media (max-width: 1200px) {
      .app-container {
        grid-template-columns: 280px 1fr;
      }

      .search-input {
        width: 200px;
      }
    }

    @media (max-width: 1024px) {
      .app-container {
        grid-template-areas:
          "header"
          "content";
        grid-template-columns: 1fr;
      }

      .sidebar {
        display: none;
      }

      .app-header {
        padding: 20px;
      }

      .app-title {
        font-size: 2em;
      }

      .search-container {
        position: static;
        transform: none;
        margin-top: 15px;
      }

      .search-input {
        width: 100%;
        max-width: 300px;
      }

      .content-body {
        padding: 25px;
      }

      .table-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .app-header {
        padding: 15px;
      }

      .content-body {
        padding: 20px;
      }

      .controls {
        padding: 20px;
      }

      .btn {
        padding: 10px 20px;
        margin: 5px;
        font-size: 0.9em;
      }

      .method-selector {
        flex-direction: column;
        align-items: stretch;
      }

      .method-btn {
        margin-bottom: 8px;
      }
    }

    /* === ANIMATIONS === */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    /* === SCROLLBAR STYLING === */
    .sidebar::-webkit-scrollbar,
    .content-area::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar::-webkit-scrollbar-track,
    .content-area::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .sidebar::-webkit-scrollbar-thumb,
    .content-area::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    .sidebar::-webkit-scrollbar-thumb:hover,
    .content-area::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h1 class="app-title">CSE460 Complete Visualization</h1>
        <p class="app-subtitle">Interactive Database Concepts and SQL Query Analysis</p>
      </div>
      <div class="search-container">
        <input type="text" class="search-input" placeholder="Search concepts, problems..." id="search-input">
      </div>
    </header>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <!-- Problem 1: SQL Query Analysis -->
      <div class="nav-section">
        <button class="nav-problem active" data-problem="problem1">
          <span class="problem-indicator">1</span>
          SQL Query Analysis
        </button>
        <div class="nav-subproblems expanded" id="problem1-subs">
          <button class="nav-subproblem active" data-problem="problem1" data-subproblem="1a">
            <span class="subproblem-status status-current"></span>
            1a: Relational Division
            <span class="difficulty-indicator">⭐</span>
          </button>
          <button class="nav-subproblem" data-problem="problem1" data-subproblem="1b">
            <span class="subproblem-status status-pending"></span>
            1b: Group Aggregation
          </button>
          <button class="nav-subproblem" data-problem="problem1" data-subproblem="1c">
            <span class="subproblem-status status-pending"></span>
            1c: Outer Join Handling
          </button>
        </div>
      </div>

      <!-- Problem 2: Relational Algebra -->
      <div class="nav-section">
        <button class="nav-problem" data-problem="problem2">
          <span class="problem-indicator">2</span>
          Relational Algebra Analysis
        </button>
        <div class="nav-submenu" id="problem2-subs">
          <button class="nav-subproblem" data-problem="problem2" data-subproblem="2a">Basic Selection & Projection</button>
          <button class="nav-subproblem" data-problem="problem2" data-subproblem="2b">Multi-table Joins</button>
          <button class="nav-subproblem" data-problem="problem2" data-subproblem="2c">Cartesian Product & Theta Join</button>
          <button class="nav-subproblem" data-problem="problem2" data-subproblem="2d">Relational Division</button>
          <button class="nav-subproblem" data-problem="problem2" data-subproblem="2e">Set Difference Operation</button>
        </div>
      </div>

      <!-- Problem 3: Comprehensive Relational Algebra Analysis -->
      <div class="nav-section">
        <button class="nav-problem" data-problem="problem3">
          <span class="problem-indicator">3</span>
          Comprehensive Relational Algebra
        </button>
        <div class="nav-subproblems" id="problem3-subs">
          <button class="nav-subproblem" data-problem="problem3" data-subproblem="3a-i">
            <span class="subproblem-status status-pending"></span>
            3a(i): Correlated Division
            <span class="difficulty-indicator">⭐⭐</span>
          </button>
          <button class="nav-subproblem" data-problem="problem3" data-subproblem="3a-ii">
            <span class="subproblem-status status-pending"></span>
            3a(ii): Static Division
          </button>
          <button class="nav-subproblem" data-problem="problem3" data-subproblem="3b">
            <span class="subproblem-status status-pending"></span>
            3b: Set Difference Application
          </button>
          <button class="nav-subproblem" data-problem="problem3" data-subproblem="3c">
            <span class="subproblem-status status-pending"></span>
            3c: Self-Join
          </button>
        </div>
      </div>

      <!-- Problem 4: Standard SQL Solutions -->
      <div class="nav-section">
        <button class="nav-problem" data-problem="problem4">
          <span class="problem-indicator">4</span>
          Standard SQL Solutions
        </button>
        <div class="nav-subproblems" id="problem4-subs">
          <button class="nav-subproblem" data-problem="problem4" data-subproblem="4-1">
            <span class="subproblem-status status-pending"></span>
            4.1: Multi-table Join Query
          </button>
          <button class="nav-subproblem" data-problem="problem4" data-subproblem="4-2">
            <span class="subproblem-status status-pending"></span>
            4.2: Time-series Aggregation
            <span class="difficulty-indicator">⭐</span>
          </button>
          <button class="nav-subproblem" data-problem="problem4" data-subproblem="4-3">
            <span class="subproblem-status status-pending"></span>
            4.3: Anti-Join Pattern
            <span class="difficulty-indicator">⭐</span>
          </button>
          <button class="nav-subproblem" data-problem="problem4" data-subproblem="4-4">
            <span class="subproblem-status status-pending"></span>
            4.4: Complex Group Filtering
          </button>
          <button class="nav-subproblem" data-problem="problem4" data-subproblem="4-5">
            <span class="subproblem-status status-pending"></span>
            4.5: Top-N Queries
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="content-area">
      <div class="content-header">
        <nav class="breadcrumb">
          CSE460 > <a href="#" id="current-problem-link">Problem 1: SQL Query Analysis</a> > <span id="current-subproblem">1a: Relational Division</span>
        </nav>
        <h2 class="content-title" id="content-title">Find members who borrowed "every" McGraw-Hill book</h2>
        <p class="content-description" id="content-description">
          This is a classic relational division problem - finding entities related to "all" elements in another relation.
        </p>
      </div>

      <div class="content-body">
        <!-- Problem 1a Content -->
        <div class="problem-content active" id="content-problem1-1a">
          <!-- Database Schema -->
          <div class="database-schema">
            <div class="schema-title">Database Schema - Library Management System</div>
            <div class="table-grid">
              <div class="data-table">
                <div class="table-name">Member (Members Table)</div>
                <table id="member-table">
                  <thead>
                    <tr><th>memb_no</th><th>name</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>M001</td><td>Alice</td></tr>
                    <tr><td>M002</td><td>Bob</td></tr>
                    <tr><td>M003</td><td>Charlie</td></tr>
                    <tr><td>M004</td><td>Diana</td></tr>
                    <tr><td>M005</td><td>Eve</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Book (Books Table)</div>
                <table id="book-table">
                  <thead>
                    <tr><th>isbn</th><th>title</th><th>publisher</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                    <tr><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                    <tr><td>978-1-3</td><td>Computer Networks</td><td>McGraw-Hill</td></tr>
                    <tr><td>978-2-1</td><td>Java Programming</td><td>Pearson</td></tr>
                    <tr><td>978-2-2</td><td>Python Guide</td><td>O'Reilly</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Borrowed (Borrowing Records)</div>
                <table id="borrowed-table">
                  <thead>
                    <tr><th>memb_no</th><th>isbn</th><th>borrow_date</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>M001</td><td>978-1-1</td><td>2024-01-15</td></tr>
                    <tr><td>M001</td><td>978-1-2</td><td>2024-01-16</td></tr>
                    <tr><td>M001</td><td>978-1-3</td><td>2024-01-17</td></tr>
                    <tr><td>M002</td><td>978-1-1</td><td>2024-01-18</td></tr>
                    <tr><td>M002</td><td>978-1-2</td><td>2024-01-19</td></tr>
                    <tr><td>M003</td><td>978-1-1</td><td>2024-01-20</td></tr>
                    <tr><td>M003</td><td>978-2-1</td><td>2024-01-21</td></tr>
                    <tr><td>M004</td><td>978-1-1</td><td>2024-01-22</td></tr>
                    <tr><td>M004</td><td>978-1-2</td><td>2024-01-23</td></tr>
                    <tr><td>M004</td><td>978-1-3</td><td>2024-01-24</td></tr>
                    <tr><td>M005</td><td>978-2-1</td><td>2024-01-25</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Method Selector -->
          <div class="method-selector">
            <button class="method-btn active" data-method="count">COUNT Method</button>
            <button class="method-btn" data-method="not-exists">NOT EXISTS Method</button>
          </div>

          <!-- Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-1a">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn" disabled>Previous</button>
              <button class="btn" id="next-btn">Next</button>
              <button class="btn btn-reset" id="reset-btn">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info">
            <strong>Problem Analysis:</strong> This is a classic relational division problem. We need to find members who borrowed "every" McGraw-Hill book.
          </div>

          <!-- SQL Code Display -->
          <div class="sql-code" id="sql-code">
<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">WHERE</span>
  bk.publisher = <span class="sql-string">'McGraw-Hill'</span>
<span class="sql-keyword">GROUP BY</span>
  m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> bk.isbn) = (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>);
          </div>

          <!-- Intermediate Results -->
          <div class="intermediate-results" id="intermediate-results">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Placeholder for other problems -->
        <div class="problem-content" id="content-problem1-1b">
          <!-- Database Schema with Extended Data -->
          <div class="database-schema">
            <div class="schema-title">Extended Dataset - More Borrowed Records for Demonstrating Group Aggregation</div>
            <div class="table-grid">
              <div class="data-table">
                <div class="table-name">Extended Borrowed (ExtendedBorrowed Table)</div>
                <table id="extended-borrowed-table">
                  <thead>
                    <tr><th>memb_no</th><th>name</th><th>publisher</th><th>title</th><th>borrow_date</th></tr>
                  </thead>
                  <tbody id="extended-borrowed-tbody">
                    <!-- Will be populated dynamically -->
                  </tbody>
                </table>
              </div>
            </div>
            <div class="table-grid" style="margin-top: 20px;">
              <div class="data-table">
                <div class="table-name">Publisher Summary (Publisher Aggregation)</div>
                <table id="publisher-summary-table">
                  <thead>
                    <tr><th>Publisher</th><th>Total Books</th><th>Active Members</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>McGraw-Hill</td><td>3</td><td>4</td></tr>
                    <tr><td>Pearson</td><td>4</td><td>3</td></tr>
                    <tr><td>O'Reilly</td><td>6</td><td>2</td></tr>
                    <tr><td>MIT Press</td><td>2</td><td>1</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-1b">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn-1b" disabled>Previous</button>
              <button class="btn" id="next-btn-1b">Next</button>
              <button class="btn btn-reset" id="reset-btn-1b">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-1b">
            <strong>Problem Analysis:</strong> Find members who borrowed more than 5books from any publisher. This requires using GROUP BY to group by publisher and member, then using HAVING to filter groups that meet the condition.
          </div>

          <!-- SQL Code Display -->
          <div class="sql-code" id="sql-code-1b">
<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">GROUP BY</span>
  bk.publisher, m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(bk.isbn) > 5;
          </div>

          <!-- Intermediate Results -->
          <div class="intermediate-results" id="intermediate-results-1b">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-1b">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <div class="problem-content" id="content-problem1-1c">
          <!-- Database Schema with Non-borrowing Members -->
          <div class="database-schema">
            <div class="schema-title">Extended Member Data - Including Members Who Haven't Borrowed Any Books</div>
            <div class="table-grid">
              <div class="data-table">
                <div class="table-name">All Members</div>
                <table id="all-members-table-1c">
                  <thead>
                    <tr><th>memb_no</th><th>name</th><th>join_date</th><th>status</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>M001</td><td>Alice</td><td>2023-01-15</td><td>Has Borrowed</td></tr>
                    <tr><td>M002</td><td>Bob</td><td>2023-02-20</td><td>Has Borrowed</td></tr>
                    <tr><td>M003</td><td>Charlie</td><td>2023-03-10</td><td>Has Borrowed</td></tr>
                    <tr><td>M004</td><td>Diana</td><td>2023-04-05</td><td>Has Borrowed</td></tr>
                    <tr><td>M005</td><td>Eve</td><td>2023-05-12</td><td>Has Borrowed</td></tr>
                    <tr class="highlighted"><td>M006</td><td>Frank</td><td>2023-06-18</td><td><strong>No Borrowing</strong></td></tr>
                    <tr class="highlighted"><td>M007</td><td>Grace</td><td>2023-07-22</td><td><strong>No Borrowing</strong></td></tr>
                    <tr class="highlighted"><td>M008</td><td>Henry</td><td>2023-08-30</td><td><strong>No Borrowing</strong></td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Borrowing Summary</div>
                <table id="borrowing-summary-table">
                  <thead>
                    <tr><th>Statistics</th><th>Count</th><th>Description</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Total Members</td><td>8</td><td>All Registered Members</td></tr>
                    <tr><td>Active Members</td><td>5</td><td>Members with Borrowing Records</td></tr>
                    <tr class="result-row"><td>Non-Borrowing Members</td><td>3</td><td>Never borrowedbooks</td></tr>
                    <tr><td>Total Borrowed Records</td><td>11</td><td>All borrowing records count</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Method Selector -->
          <div class="method-selector">
            <button class="method-btn active" data-method="subquery">Subquery Method</button>
            <button class="method-btn" data-method="left-join">LEFT JOIN Method</button>
          </div>

          <!-- Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-1c">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn-1c" disabled>Previous</button>
              <button class="btn" id="next-btn-1c">Next</button>
              <button class="btn btn-reset" id="reset-btn-1c">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-1c">
            <strong>Problem Analysis:</strong> When calculating average borrows, must ensure denominator includes all members (including non-borrowers). This is a classic application of LEFT JOIN handling NULL values.
          </div>

          <!-- SQL Code Display -->
          <div class="sql-code" id="sql-code-1c">
<span class="sql-comment">-- Subquery method: Calculate numerator and denominator separately</span>
<span class="sql-keyword">SELECT</span>
  (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Borrowed)::<span class="sql-keyword">numeric</span> /
  (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Member)::<span class="sql-keyword">numeric</span> <span class="sql-keyword">AS</span> average_books_per_member;
          </div>

          <!-- Intermediate Results -->
          <div class="intermediate-results" id="intermediate-results-1c">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-1c">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 2a Content -->
        <div class="problem-content" id="content-problem2-2a">
          <!-- Database Schema for Airline System -->
          <div class="database-schema">
            <div class="schema-title">Airline Database Schema</div>
            <div class="table-grid">
              <div class="data-table">
                <div class="table-name">Aircraft (Aircraft Table)</div>
                <table id="aircraft-table">
                  <thead>
                    <tr><th>aid</th><th>aname</th><th>cruisingrange</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>A001</td><td>Boeing 737</td><td>3000</td></tr>
                    <tr><td>A002</td><td>Boeing 747</td><td>7500</td></tr>
                    <tr><td>A003</td><td>Airbus A320</td><td>3500</td></tr>
                    <tr><td>A004</td><td>Boeing 777</td><td>9700</td></tr>
                    <tr><td>A005</td><td>Airbus A380</td><td>8000</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Certified (Certification Table)</div>
                <table id="certified-table">
                  <thead>
                    <tr><th>eid</th><th>aid</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>E101</td><td>A001</td></tr>
                    <tr><td>E101</td><td>A002</td></tr>
                    <tr><td>E102</td><td>A001</td></tr>
                    <tr><td>E102</td><td>A004</td></tr>
                    <tr><td>E103</td><td>A003</td></tr>
                    <tr><td>E103</td><td>A005</td></tr>
                    <tr><td>E104</td><td>A001</td></tr>
                    <tr><td>E104</td><td>A002</td></tr>
                    <tr><td>E104</td><td>A004</td></tr>
                    <tr><td>E105</td><td>A003</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Employees (Employee Table)</div>
                <table id="employees-table">
                  <thead>
                    <tr><th>eid</th><th>ename</th><th>salary</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>E101</td><td>John Smith</td><td>80000</td></tr>
                    <tr><td>E102</td><td>Sarah Johnson</td><td>85000</td></tr>
                    <tr><td>E103</td><td>Mike Davis</td><td>75000</td></tr>
                    <tr><td>E104</td><td>Lisa Brown</td><td>90000</td></tr>
                    <tr><td>E105</td><td>Tom Wilson</td><td>70000</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Relational Algebra Expression -->
          <div class="algebra-expression" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3 style="color: #495057; margin-bottom: 15px;">Relational Algebra Expression</h3>
            <div style="font-size: 1.5em; font-family: 'Times New Roman', serif; color: #007bff;">
              π<sub>eid</sub>(σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft) ⋈ Certified)
            </div>
            <div style="margin-top: 15px; color: #6c757d;">
              Find all pilot IDs who fly Boeing aircraft
            </div>
          </div>

          <!-- Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-2a">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn-2a" disabled>Previous</button>
              <button class="btn" id="next-btn-2a">Next</button>
              <button class="btn btn-reset" id="reset-btn-2a">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-2a">
            <strong>Problem Analysis:</strong> Find pilot IDs who can fly Boeing aircraft. Need to first filter Boeing aircraft, then join with the certification table, and finally project employee IDs.
          </div>

          <!-- Intermediate Results -->
          <div class="intermediate-results" id="intermediate-results-2a">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-2a">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 2b Content -->
        <div class="problem-content" id="content-problem2-2b">
          <!-- Database Schema for Airline System -->
          <div class="database-schema">
            <div class="schema-title">Airline Database Schema</div>
            <div class="table-grid">
              <div class="data-table">
                <div class="table-name">Aircraft (Aircraft Table)</div>
                <table id="aircraft-table-2b">
                  <thead>
                    <tr><th>aid</th><th>aname</th><th>cruisingrange</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>101</td><td>Boeing 747</td><td>3000</td></tr>
                    <tr><td>102</td><td>Airbus A320</td><td>2500</td></tr>
                    <tr><td>103</td><td>Boeing 777</td><td>4500</td></tr>
                    <tr><td>104</td><td>Cessna 172</td><td>800</td></tr>
                    <tr><td>105</td><td>Boeing 737</td><td>2200</td></tr>
                    <tr><td>106</td><td>Embraer E190</td><td>2400</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Certified (Certification Table)</div>
                <table id="certified-table-2b">
                  <thead>
                    <tr><th>eid</th><th>aid</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>101</td><td>101</td></tr>
                    <tr><td>101</td><td>103</td></tr>
                    <tr><td>102</td><td>101</td></tr>
                    <tr><td>102</td><td>105</td></tr>
                    <tr><td>103</td><td>102</td></tr>
                    <tr><td>104</td><td>103</td></tr>
                    <tr><td>105</td><td>104</td></tr>
                    <tr><td>106</td><td>105</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Employees (Employee Table)</div>
                <table id="employees-table-2b">
                  <thead>
                    <tr><th>eid</th><th>ename</th><th>salary</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>101</td><td>Alice Johnson</td><td>75000</td></tr>
                    <tr><td>102</td><td>Bob Smith</td><td>82000</td></tr>
                    <tr><td>103</td><td>Carol White</td><td>68000</td></tr>
                    <tr><td>104</td><td>David Wilson</td><td>90000</td></tr>
                    <tr><td>105</td><td>Eva Martinez</td><td>71000</td></tr>
                    <tr><td>106</td><td>Frank Miller</td><td>85000</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Relational Algebra Expression -->
          <div class="algebra-expression" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3 style="color: #495057; margin-bottom: 15px;">Relational Algebra Expression</h3>
            <div style="font-size: 1.5em; font-family: 'Times New Roman', serif; color: #007bff;">
              π<sub>ename</sub>(σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft) ⋈ Certified ⋈ Employees)
            </div>
            <div style="margin-top: 15px; color: #6c757d;">
              Find names of pilots who fly Boeing aircraft
            </div>
          </div>

          <!-- Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-2b">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn-2b" disabled>Previous</button>
              <button class="btn" id="next-btn-2b">Next</button>
              <button class="btn btn-reset" id="reset-btn-2b">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-2b">
            <strong>Problem Analysis:</strong> Find pilot names who can fly Boeing aircraft. Need to first filter Boeing aircraft, then join with certification and employee tables, and finally project employee names.
          </div>

          <!-- Intermediate Results -->
          <div class="intermediate-results" id="intermediate-results-2b">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Table Container -->
          <div id="result-table-container">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-2b">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 2c Content -->
        <div class="problem-content" id="content-problem2-2c">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 2d Content -->
        <div class="problem-content" id="content-problem2-2d">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 2e Content -->
        <div class="problem-content" id="content-problem2-2e">
          <!-- Database Schema -->
          <div class="database-schema">
            <div class="schema-title">Airline Database Schema</div>
            <div class="table-grid">
              <div class="data-table">
                <div class="table-name">Employees (Employee Table)</div>
                <table id="employees-table-2e">
                  <thead>
                    <tr><th>eid</th><th>ename</th><th>salary</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>101</td><td>Alice Johnson</td><td>95000</td></tr>
                    <tr><td>102</td><td>Bob Smith</td><td>82000</td></tr>
                    <tr><td>103</td><td>Carol Davis</td><td>68000</td></tr>
                    <tr><td>104</td><td>David Wilson</td><td>96000</td></tr>
                    <tr><td>105</td><td>Eva Brown</td><td>71000</td></tr>
                    <tr><td>106</td><td>Frank Miller</td><td>91000</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Certified (Certification Table)</div>
                <table id="certified-table-2e">
                  <thead>
                    <tr><th>eid</th><th>aid</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>101</td><td>747</td></tr>
                    <tr><td>101</td><td>777</td></tr>
                    <tr><td>101</td><td>A320</td></tr>
                    <tr><td>102</td><td>747</td></tr>
                    <tr><td>102</td><td>A320</td></tr>
                    <tr><td>103</td><td>777</td></tr>
                    <tr><td>104</td><td>747</td></tr>
                    <tr><td>104</td><td>777</td></tr>
                    <tr><td>104</td><td>A320</td></tr>
                    <tr><td>105</td><td>A320</td></tr>
                    <tr><td>106</td><td>747</td></tr>
                    <tr><td>106</td><td>777</td></tr>
                  </tbody>
                </table>
              </div>

              <div class="data-table">
                <div class="table-name">Aircraft (Aircraft Table)</div>
                <table id="aircraft-table-2e">
                  <thead>
                    <tr><th>aid</th><th>aname</th><th>cruisingrange</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>747</td><td>Boeing 747</td><td>8000</td></tr>
                    <tr><td>777</td><td>Boeing 777</td><td>9000</td></tr>
                    <tr><td>A320</td><td>Airbus A320</td><td>3200</td></tr>
                    <tr><td>737</td><td>Boeing 737</td><td>2800</td></tr>
                    <tr><td>A330</td><td>Airbus A330</td><td>7500</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Relational Algebra Expression -->
          <div class="algebra-expression" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3 style="color: #495057; margin-bottom: 15px;">Relational Algebra Expression</h3>
            <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #dc3545;">
              π<sub>ename</sub>((π<sub>eid</sub>(σ<sub>cruisingrange>3000</sub>(Aircraft) ⋈ Certified) - π<sub>eid</sub>(σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft) ⋈ Certified)) ⋈ Employees)
            </div>
            <div style="margin-top: 15px; color: #6c757d;">
              Find pilot names who can fly long-range aircraft but not Boeing aircraft
            </div>
          </div>

          <!-- Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-2e">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn-2e" disabled>Previous</button>
              <button class="btn" id="next-btn-2e">Next</button>
              <button class="btn btn-reset" id="reset-btn-2e">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-2e">
            <strong>Problem Analysis:</strong> Find pilot names who can fly long-range aircraft (cruisingrange > 3000) but do not fly Boeing aircraft. This is a typical application of set difference operation.
          </div>

          <!-- Intermediate Results -->
          <div class="intermediate-results" id="intermediate-results-2e">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Table Container -->
          <div id="result-table-container-2e">
            <!-- Dynamic content will be inserted here -->
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-2e">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 3a(i) Content -->
        <div class="problem-content" id="content-problem3-3a-i">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 3a(ii) Content -->
        <div class="problem-content" id="content-problem3-3a-ii">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 3b Content -->
        <div class="problem-content" id="content-problem3-3b">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 3c Content -->
        <div class="problem-content" id="content-problem3-3c">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>

        <!-- Problem 4.1 Content -->
        <div class="problem-content" id="content-problem4-4-1">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>
        <!-- Problem 4.2 Content -->
        <div class="problem-content" id="content-problem4-4-2">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>
        <!-- Problem 4.3 Content -->
        <div class="problem-content" id="content-problem4-4-3">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>
        <!-- Problem 4.4 Content -->
        <div class="problem-content" id="content-problem4-4-4">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>
        <!-- Problem 4.5 Content -->
        <div class="problem-content" id="content-problem4-4-5">
          <div class="step-controls">
            <!-- Dynamic content will be inserted here -->
          </div>
          <div class="content-area">
            <!-- Dynamic content will be inserted here -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Global State Management
    const AppState = {
      currentProblem: 'problem1',
      currentSubProblem: '1a',
      currentStep: 0,
      currentMethod: 'count',

      problemStates: {
        problem1: {
          '1a': { step: 0, method: 'count', maxSteps: { count: 6, 'not-exists': 5 } },
          '1b': { step: 0, maxSteps: { default: 6 } },
          '1c': { step: 0, method: 'subquery', maxSteps: { subquery: 4, 'left-join': 5 } }
        }
      }
    };

    // Problem Metadata
    const ProblemMeta = {
      problem1: {
        title: "Problem 1: SQL Query Analysis",
        subProblems: {
          '1a': {
            title: "Find members who borrowed \"every\" McGraw-Hill book",
            description: "This is a classic relational division problem that requires finding entities related to \"all\" elements in another relation.",
            concept: "Relational Division"
          },
          '1b': {
            title: "Find members who borrowed more than 5books from any publisher",
            description: "Typical application of GROUP BY + HAVING, demonstrating how to filter grouped data using aggregation conditions.",
            concept: "GROUP BY + HAVING"
          },
          '1c': {
            title: "Calculate Average Borrowed Count (Including Non-Borrowers)",
            description: "Classic LEFT JOIN scenario for NULL handling, ensuring statistics include all entities.",
            concept: "LEFT JOIN + NULL Handling"
          }
        }
      },
      problem3: {
        title: "Problem 3: Comprehensive Relational Algebra Analysis",
        subProblems: {
          '3a-i': {
            title: "Find students who took all courses in their major",
            description: "Advanced application of correlated relational division, demonstrating double negation logic and personalized condition handling.",
            concept: "Correlated relational division"
          },
          '3a-ii': {
            title: "Find teachers who have taught in all classrooms",
            description: "Classic application of static relational division, comparing division operation and set difference methods.",
            concept: "Static relational division"
          },
          '3b': {
            title: "Find students who have not taken courses taught by faculty in their department",
            description: "Set difference operation for handling department-related exclusion queries.",
            concept: "Set difference operation"
          },
          '3c': {
            title: "Find students taking multiple courses at the same time",
            description: "Practical application of self-join for handling time conflict detection problems.",
            concept: "Self-join"
          }
        }
      },
      problem2: {
        title: "Problem 2: Relational Algebra Analysis",
        subProblems: {
          '2a': {
            title: "Find pilot IDs qualified to fly Boeing aircraft",
            description: "Basic combination of selection, join and Projection operations, demonstrating fundamental relational algebra operations.",
            concept: "Basic selection and projection"
          },
          '2b': {
            title: "Find names of pilots who fly Boeing aircraft",
            description: "Extended multi-table join operations, extending from ID to specific name information.",
            concept: "Multi-table join"
          },
          '2c': {
            title: "Find aircraft IDs that can fly from Bonn to Madras",
            description: "Practical application of Cartesian product and conditional joins for handling geographic route queries.",
            concept: "Cartesian product and conditional joins"
          },
          '2d': {
            title: "Find flights that every high-salary pilot can fly",
            description: "Classic application of relational algebra division, identifying universal flight capabilities.",
            concept: "Relational algebra division"
          },
          '2e': {
            title: "Find pilot names who fly long-range aircraft but not Boeing",
            description: "Set difference operations demonstrating \"but not including\" type query patterns.",
            concept: "Set difference"
          }
        }
      },
      problem4: {
        title: "Problem 4: Standard SQL Solutions",
        subProblems: {
          '4-1': {
            title: "SQL Implementation of Relational Division",
            description: "Using standard SQL to implement relational division queries, demonstrating double negation logic in SQL syntax.",
            concept: "SQL Division"
          },
          '4-2': {
            title: "SQL Subquery Optimization",
            description: "Comparing different subquery strategies and demonstrating performance optimization techniques.",
            concept: "Subquery Optimization"
          },
          '4-3': {
            title: "SQL Window Function Applications",
            description: "Using window functions to handle ranking and analytical problems.",
            concept: "Window Functions"
          },
          '4-4': {
            title: "SQL Recursive Queries",
            description: "Using CTE to implement recursive queries for handling hierarchical data.",
            concept: "Recursive CTE"
          },
          '4-5': {
            title: "SQL Performance Analysis",
            description: "Analyzing execution plans and understanding how query optimizers work.",
            concept: "Query Optimization"
          }
        }
      }
    };

    // Navigation System
    class NavigationSystem {
      constructor() {
        this.init();
      }

      init() {
        console.log('NavigationSystem init() called');
        this.bindEvents();
        this.updateDisplay();
        console.log('NavigationSystem init() completed');
      }

      bindEvents() {
        console.log('NavigationSystem bindEvents() called');

        // Problem navigation
        const problemBtns = document.querySelectorAll('.nav-problem');
        console.log('Found problem buttons:', problemBtns.length);
        problemBtns.forEach(btn => {
          btn.addEventListener('click', (e) => {
            console.log('Problem button clicked');
            const problem = e.currentTarget.dataset.problem;
            this.toggleProblem(problem);
          });
        });

        // Sub-problem navigation
        const subproblemBtns = document.querySelectorAll('.nav-subproblem');
        console.log('Found subproblem buttons:', subproblemBtns.length);
        subproblemBtns.forEach(btn => {
          btn.addEventListener('click', (e) => {
            console.log('Subproblem button clicked');
            const problem = e.currentTarget.dataset.problem;
            const subproblem = e.currentTarget.dataset.subproblem;
            this.navigateToSubProblem(problem, subproblem);
          });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => this.handleKeyboard(e));
      }

      toggleProblem(problemId) {
        const problemBtn = document.querySelector(`[data-problem="${problemId}"].nav-problem`);
        const subProblems = document.getElementById(`${problemId}-subs`);

        if (subProblems.classList.contains('expanded')) {
          subProblems.classList.remove('expanded');
        } else {
          // Close all other expanded sections
          document.querySelectorAll('.nav-subproblems.expanded').forEach(el => {
            el.classList.remove('expanded');
          });

          // Update active problem
          document.querySelectorAll('.nav-problem.active').forEach(el => {
            el.classList.remove('active');
          });
          problemBtn.classList.add('active');

          // Expand current section
          subProblems.classList.add('expanded');
        }
      }

      navigateToSubProblem(problemId, subProblemId) {
        // Update state
        AppState.currentProblem = problemId;
        AppState.currentSubProblem = subProblemId;

        // Update navigation active states
        document.querySelectorAll('.nav-subproblem.active').forEach(el => {
          el.classList.remove('active');
        });

        document.querySelector(`[data-problem="${problemId}"][data-subproblem="${subProblemId}"]`)
          .classList.add('active');

        // Update content display
        this.updateDisplay();

        // Clean up previous problem listeners
        if (typeof Problem1A !== 'undefined' && Problem1A.removeKeyboardListener) {
          Problem1A.removeKeyboardListener();
        }
        if (typeof Problem1B !== 'undefined' && Problem1B.removeKeyboardListener) {
          Problem1B.removeKeyboardListener();
        }
        if (typeof Problem1C !== 'undefined' && Problem1C.removeKeyboardListener) {
          Problem1C.removeKeyboardListener();
        }
        if (typeof Problem2A !== 'undefined' && Problem2A.removeKeyboardListener) {
          Problem2A.removeKeyboardListener();
        }
        if (typeof Problem2B !== 'undefined' && Problem2B.removeKeyboardListener) {
          Problem2B.removeKeyboardListener();
        }
        if (typeof Problem2C !== 'undefined' && Problem2C.removeKeyboardListener) {
          Problem2C.removeKeyboardListener();
        }
        if (typeof Problem2D !== 'undefined' && Problem2D.removeKeyboardListener) {
          Problem2D.removeKeyboardListener();
        }
        if (typeof Problem2E !== 'undefined' && Problem2E.removeKeyboardListener) {
          Problem2E.removeKeyboardListener();
        }
        if (typeof Problem3AI !== 'undefined' && Problem3AI.removeKeyboardListener) {
          Problem3AI.removeKeyboardListener();
        }
        if (typeof Problem3AII !== 'undefined' && Problem3AII.removeKeyboardListener) {
          Problem3AII.removeKeyboardListener();
        }
        if (typeof Problem3B !== 'undefined' && Problem3B.removeKeyboardListener) {
          Problem3B.removeKeyboardListener();
        }
        if (typeof Problem3C !== 'undefined' && Problem3C.removeKeyboardListener) {
          Problem3C.removeKeyboardListener();
        }
        if (typeof Problem41 !== 'undefined' && Problem41.removeKeyboardListener) {
          Problem41.removeKeyboardListener();
        }
        if (typeof Problem42 !== 'undefined' && Problem42.removeKeyboardListener) {
          Problem42.removeKeyboardListener();
        }
        if (typeof Problem43 !== 'undefined' && Problem43.removeKeyboardListener) {
          Problem43.removeKeyboardListener();
        }
        if (typeof Problem44 !== 'undefined' && Problem44.removeKeyboardListener) {
          Problem44.removeKeyboardListener();
        }
        if (typeof Problem45 !== 'undefined' && Problem45.removeKeyboardListener) {
          Problem45.removeKeyboardListener();
        }

        // Initialize the specific problem content
        if (problemId === 'problem1' && subProblemId === '1a') {
          Problem1A.init();
        } else if (problemId === 'problem1' && subProblemId === '1b') {
          Problem1B.init();
        } else if (problemId === 'problem1' && subProblemId === '1c') {
          Problem1C.init();
        } else if (problemId === 'problem2' && subProblemId === '2a') {
          Problem2A.init();
        } else if (problemId === 'problem2' && subProblemId === '2b') {
          Problem2B.init();
        } else if (problemId === 'problem2' && subProblemId === '2c') {
          Problem2C.init();
        } else if (problemId === 'problem2' && subProblemId === '2d') {
          Problem2D.init();
        } else if (problemId === 'problem2' && subProblemId === '2e') {
          Problem2E.init();
        } else if (problemId === 'problem3' && subProblemId === '3a-i') {
          Problem3AI.init();
        } else if (problemId === 'problem3' && subProblemId === '3a-ii') {
          Problem3AII.init();
        } else if (problemId === 'problem3' && subProblemId === '3b') {
          Problem3B.init();
        } else if (problemId === 'problem3' && subProblemId === '3c') {
          Problem3C.init();
        } else if (problemId === 'problem4' && subProblemId === '4-1') {
          Problem41.init();
        } else if (problemId === 'problem4' && subProblemId === '4-2') {
          Problem42.init();
        } else if (problemId === 'problem4' && subProblemId === '4-3') {
          Problem43.init();
        } else if (problemId === 'problem4' && subProblemId === '4-4') {
          Problem44.init();
        } else if (problemId === 'problem4' && subProblemId === '4-5') {
          Problem45.init();
        }
      }

      updateDisplay() {
        const { currentProblem, currentSubProblem } = AppState;
        const meta = ProblemMeta[currentProblem]?.subProblems[currentSubProblem];

        if (meta) {
          // Update breadcrumb
          document.getElementById('current-problem-link').textContent =
            ProblemMeta[currentProblem].title;
          document.getElementById('current-subproblem').textContent =
            `${currentSubProblem}: ${meta.concept}`;

          // Update content header
          document.getElementById('content-title').textContent = meta.title;
          document.getElementById('content-description').textContent = meta.description;
        }

        // Show/hide content sections
        document.querySelectorAll('.problem-content').forEach(el => {
          el.classList.remove('active');
        });

        const contentId = `content-${currentProblem}-${currentSubProblem}`;
        const contentEl = document.getElementById(contentId);
        if (contentEl) {
          contentEl.classList.add('active', 'fade-in');
        }
      }

      handleKeyboard(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        switch(e.key) {
          case '1':
            this.navigateToSubProblem('problem1', '1a');
            break;
          case '2':
            this.navigateToSubProblem('problem1', '1b');
            break;
          case '3':
            this.navigateToSubProblem('problem1', '1c');
            break;
        }
      }
    }

    // Problem 1A Implementation
    class Problem1A {
      static init() {
        this.currentStep = AppState.problemStates.problem1['1a'].step;
        this.currentMethod = AppState.problemStates.problem1['1a'].method;

        this.bindEvents();
        this.addKeyboardListener();
        this.updateStepIndicator();
        this.showStep(this.currentStep);
        this.updateButtons();
      }

      static bindEvents() {
        // Method selector
        document.querySelectorAll('.method-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const method = e.target.dataset.method;
            this.switchMethod(method);
          });
        });

        // Step controls
        document.getElementById('prev-btn').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn').addEventListener('click', () => this.reset());
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }

      static switchMethod(method) {
        this.currentMethod = method;
        AppState.problemStates.problem1['1a'].method = method;

        // Update method buttons
        document.querySelectorAll('.method-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`[data-method="${method}"]`).classList.add('active');

        // Reset to step 0 and update display
        this.currentStep = 0;
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static nextStep() {
        const maxSteps = AppState.problemStates.problem1['1a'].maxSteps[this.currentMethod];
        if (this.currentStep < maxSteps) {
          this.currentStep++;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static previousStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        const maxSteps = AppState.problemStates.problem1['1a'].maxSteps[this.currentMethod];
        document.getElementById('prev-btn').disabled = this.currentStep === 0;
        document.getElementById('next-btn').disabled = this.currentStep >= maxSteps;
      }

      static updateStepIndicator() {
        const maxSteps = AppState.problemStates.problem1['1a'].maxSteps[this.currentMethod];
        const indicator = document.getElementById('step-indicator-1a');

        let html = '';
        for (let i = 0; i <= maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info');
        const intermediateResults = document.getElementById('intermediate-results');
        const resultExplanation = document.getElementById('result-explanation');
        const sqlCode = document.getElementById('sql-code');

        if (this.currentMethod === 'count') {
          this.showCountStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode);
        } else {
          this.showNotExistsStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode);
        }
      }

      static showCountStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode) {
        // Update SQL code progressively based on step
        switch(step) {
          case 0:
            sqlCode.innerHTML = `<span class="sql-comment">-- Analyzing the problem...</span>`;
            stepInfo.innerHTML = '<strong>Step 0:</strong>Problem analysis - Find members who borrowed "every" McGraw-Hill book. There are a total of 3 McGraw-Hillbooks.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            this.highlightMcGrawHillBooks();
            break;

          case 1:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn`;
            stepInfo.innerHTML = '<strong>Step 1:</strong>Execute multi-table join - Member ⋈ Borrowed ⋈ Book, getting book information for member borrowings.';
            intermediateResults.innerHTML = `
              <h4>Join Result</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>isbn</th><th>title</th><th>publisher</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-3</td><td>Computer Networks</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-3</td><td>Computer Networks</td><td>McGraw-Hill</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 2:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">WHERE</span>
  bk.publisher = <span class="sql-string">'McGraw-Hill'</span>`;
            stepInfo.innerHTML = '<strong>Step 2:</strong>WHERE filter - Keep only McGraw-Hill published book records.';
            intermediateResults.innerHTML = `
              <h4>Filtered Result (publisher = 'McGraw-Hill')</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>isbn</th><th>title</th><th>publisher</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-3</td><td>Computer Networks</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-1</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-2</td><td>Operating Systems</td><td>McGraw-Hill</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-3</td><td>Computer Networks</td><td>McGraw-Hill</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 3:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">WHERE</span>
  bk.publisher = <span class="sql-string">'McGraw-Hill'</span>
<span class="sql-keyword">GROUP BY</span>
  m.memb_no, m.name`;
            stepInfo.innerHTML = '<strong>Step 3:</strong>GROUP BY - Group by memb_no and name, calculating borrowed McGraw-Hill book count for each member.';
            intermediateResults.innerHTML = `
              <h4>Grouping Result</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>borrowed McGraw-Hillbooks</th><th>COUNT(DISTINCT isbn)</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>M001</td><td>Alice</td><td>978-1-1, 978-1-2, 978-1-3</td><td>3</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-1, 978-1-2</td><td>2</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>978-1-1</td><td>1</td></tr>
                  <tr class="result-row"><td>M004</td><td>Diana</td><td>978-1-1, 978-1-2, 978-1-3</td><td>3</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 4:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">WHERE</span>
  bk.publisher = <span class="sql-string">'McGraw-Hill'</span>
<span class="sql-keyword">GROUP BY</span>
  m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> bk.isbn) = (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>)`;
            stepInfo.innerHTML = '<strong>Step 4:</strong>Calculate McGraw-Hill book total - subquery returns 3.';
            intermediateResults.innerHTML = `
              <h4>Subquery Result</h4>
              <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                <strong>SELECT COUNT(*) FROM Book WHERE publisher = 'McGraw-Hill'</strong><br>
                Result: <span style="color: #28a745; font-weight: bold;">3</span>
              </div>
              <h4>HAVING condition comparison</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>COUNT(DISTINCT isbn)</th><th>= 3?</th><th>meets condition</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>M001</td><td>Alice</td><td>3</td><td>✓</td><td>Yes</td></tr>
                  <tr class="filtered-out"><td>M002</td><td>Bob</td><td>2</td><td>✗</td><td>No</td></tr>
                  <tr class="filtered-out"><td>M003</td><td>Charlie</td><td>1</td><td>✗</td><td>No</td></tr>
                  <tr class="result-row"><td>M004</td><td>Diana</td><td>3</td><td>✓</td><td>Yes</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 5:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">WHERE</span>
  bk.publisher = <span class="sql-string">'McGraw-Hill'</span>
<span class="sql-keyword">GROUP BY</span>
  m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> bk.isbn) = (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>);`;
            stepInfo.innerHTML = '<strong>Step 5:</strong>HAVING filter - Keep only records where COUNT(DISTINCT isbn) = 3.';
            intermediateResults.innerHTML = `
              <h4>Final Result after HAVING filter</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>M001</td><td>Alice</td></tr>
                  <tr class="result-row"><td>M004</td><td>Diana</td></tr>
                </tbody>
              </table>
            `;
            resultExplanation.innerHTML = `
              <h4>Result Explanation</h4>
              <p><strong>Alice (M001)</strong> and <strong>Diana (M004)</strong> borrowed all3 McGraw-Hillbooks, satisfies"every" requirement. </p>
              <p><strong>Core Logic:</strong>If a certainMemberBorrowed's distinctMcGraw-Hill bookscount = McGraw-Hill bookstotal, then thatmember borrowed"every"McGraw-Hill books. </p>
            `;
            break;

          case 6:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">WHERE</span>
  bk.publisher = <span class="sql-string">'McGraw-Hill'</span>
<span class="sql-keyword">GROUP BY</span>
  m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> bk.isbn) = (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>);`;
            stepInfo.innerHTML = '<strong>Complete:</strong>COUNT method successfully found members who borrowed every McGraw-Hill book.';
            resultExplanation.innerHTML = `
              <h4>COUNTMethod Summary</h4>
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                <p><strong>Advantages:</strong></p>
                <ul>
                  <li>Clear and intuitive logic</li>
                  <li>Good performance, requires only one table scan</li>
                  <li>Easy to understand and maintain</li>
                </ul>
                <p><strong>Core Concept:</strong>Implementing through count comparisonrelational division</p>
              </div>
            `;
            break;
        }
      }

      static showNotExistsStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode) {
        // Update SQL code progressively based on step
        switch(step) {
          case 0:
            sqlCode.innerHTML = `<span class="sql-comment">-- NOT EXISTS method: double negation logic</span>`;
            stepInfo.innerHTML = '<strong>Step 0:</strong>NOT EXISTS method - Using double negation logic: if there is no McGraw-Hill book that the member has not borrowed, then the member has borrowed all McGraw-Hillbooks.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            break;

          case 1:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span> isbn
<span class="sql-keyword">FROM</span> Book
<span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>`;
            stepInfo.innerHTML = '<strong>Step 1:</strong>Inner query - Find all McGraw-Hill book ISBNs.';
            intermediateResults.innerHTML = `
              <h4>SELECT isbn FROM Book WHERE publisher = 'McGraw-Hill'</h4>
              <table>
                <thead><tr><th>isbn</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>978-1-1</td></tr>
                  <tr class="highlighted"><td>978-1-2</td></tr>
                  <tr class="highlighted"><td>978-1-3</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 2:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span> isbn
<span class="sql-keyword">FROM</span> Borrowed b
<span class="sql-keyword">WHERE</span> b.memb_no = m.memb_no`;
            stepInfo.innerHTML = '<strong>Step 2:</strong>For each member, find the book ISBNs they have borrowed.';
            intermediateResults.innerHTML = `
              <h4>Each member's borrowed records</h4>
              <table>
                <thead><tr><th>Member</th><th>Borrowed ISBN</th></tr></thead>
                <tbody>
                  <tr><td>M001 (Alice)</td><td>978-1-1, 978-1-2, 978-1-3</td></tr>
                  <tr><td>M002 (Bob)</td><td>978-1-1, 978-1-2</td></tr>
                  <tr><td>M003 (Charlie)</td><td>978-1-1</td></tr>
                  <tr><td>M004 (Diana)</td><td>978-1-1, 978-1-2, 978-1-3</td></tr>
                  <tr><td>M005 (Eve)</td><td>(none)</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 3:
            sqlCode.innerHTML = `(<span class="sql-keyword">SELECT</span> isbn <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>)
<span class="sql-keyword">EXCEPT</span>
(<span class="sql-keyword">SELECT</span> isbn <span class="sql-keyword">FROM</span> Borrowed b <span class="sql-keyword">WHERE</span> b.memb_no = m.memb_no)`;
            stepInfo.innerHTML = '<strong>Step 3:</strong>EXCEPT operation - For each member, calculate the difference between McGraw-Hill book set and their borrowed set.';
            intermediateResults.innerHTML = `
              <h4>EXCEPTResult Analysis</h4>
              <table>
                <thead><tr><th>Member</th><th>McGraw-Hill books</th><th>EXCEPT</th><th>MemberBorrowed</th><th>=</th><th>Books not borrowed</th></tr></thead>
                <tbody>
                  <tr class="result-row">
                    <td>M001</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>EXCEPT</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>=</td>
                    <td><strong>∅ (empty set)</strong></td>
                  </tr>
                  <tr class="highlighted">
                    <td>M002</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>EXCEPT</td>
                    <td>{978-1-1, 978-1-2}</td>
                    <td>=</td>
                    <td>{978-1-3}</td>
                  </tr>
                  <tr class="highlighted">
                    <td>M003</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>EXCEPT</td>
                    <td>{978-1-1}</td>
                    <td>=</td>
                    <td>{978-1-2, 978-1-3}</td>
                  </tr>
                  <tr class="result-row">
                    <td>M004</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>EXCEPT</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>=</td>
                    <td><strong>∅ (empty set)</strong></td>
                  </tr>
                  <tr class="highlighted">
                    <td>M005</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>EXCEPT</td>
                    <td>∅</td>
                    <td>=</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                  </tr>
                </tbody>
              </table>
            `;
            break;

          case 4:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">WHERE</span>
  <span class="sql-keyword">NOT EXISTS</span> (
    (<span class="sql-keyword">SELECT</span> isbn <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>)
    <span class="sql-keyword">EXCEPT</span>
    (<span class="sql-keyword">SELECT</span> isbn <span class="sql-keyword">FROM</span> Borrowed b <span class="sql-keyword">WHERE</span> b.memb_no = m.memb_no)
  )`;
            stepInfo.innerHTML = '<strong>Step 4:</strong>NOT EXISTS evaluation - Only members with empty set results meet the condition.';
            intermediateResults.innerHTML = `
              <h4>NOT EXISTS Logic Evaluation</h4>
              <table>
                <thead><tr><th>Member</th><th>Books not borrowed</th><th>NOT EXISTS?</th><th>Final Result</th></tr></thead>
                <tbody>
                  <tr class="result-row">
                    <td>M001 (Alice)</td>
                    <td>∅ (empty set)</td>
                    <td><strong>TRUE</strong></td>
                    <td>✓ Include</td>
                  </tr>
                  <tr class="filtered-out">
                    <td>M002 (Bob)</td>
                    <td>{978-1-3}</td>
                    <td>FALSE</td>
                    <td>✗ Exclude</td>
                  </tr>
                  <tr class="filtered-out">
                    <td>M003 (Charlie)</td>
                    <td>{978-1-2, 978-1-3}</td>
                    <td>FALSE</td>
                    <td>✗ Exclude</td>
                  </tr>
                  <tr class="result-row">
                    <td>M004 (Diana)</td>
                    <td>∅ (empty set)</td>
                    <td><strong>TRUE</strong></td>
                    <td>✓ Include</td>
                  </tr>
                  <tr class="filtered-out">
                    <td>M005 (Eve)</td>
                    <td>{978-1-1, 978-1-2, 978-1-3}</td>
                    <td>FALSE</td>
                    <td>✗ Exclude</td>
                  </tr>
                </tbody>
              </table>
            `;
            break;

          case 5:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  m.memb_no,
  m.name
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">WHERE</span>
  <span class="sql-keyword">NOT EXISTS</span> (
    (<span class="sql-keyword">SELECT</span> isbn <span class="sql-keyword">FROM</span> Book <span class="sql-keyword">WHERE</span> publisher = <span class="sql-string">'McGraw-Hill'</span>)
    <span class="sql-keyword">EXCEPT</span>
    (<span class="sql-keyword">SELECT</span> isbn <span class="sql-keyword">FROM</span> Borrowed b <span class="sql-keyword">WHERE</span> b.memb_no = m.memb_no)
  );`;
            stepInfo.innerHTML = '<strong>Complete:</strong>NOT EXISTS method produces the same result.';
            intermediateResults.innerHTML = `
              <h4>Final Result</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>M001</td><td>Alice</td></tr>
                  <tr class="result-row"><td>M004</td><td>Diana</td></tr>
                </tbody>
              </table>
            `;
            resultExplanation.innerHTML = `
              <h4>NOT EXISTSMethod Summary</h4>
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                <p><strong>Advantages:</strong></p>
                <ul>
                  <li>Closer to natural language logic</li>
                  <li>Suitable for complex division conditions</li>
                  <li>Highly extensible</li>
                </ul>
                <p><strong>Core Concept:</strong>Double negation implements relational division - "no unsatisfied conditions exist" is equivalent to "satisfies all conditions"</p>
              </div>
            `;
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('td, tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out', 'error-highlight');
        });
      }

      static highlightMcGrawHillBooks() {
        const bookTable = document.getElementById('book-table');
        const rows = bookTable.querySelectorAll('tbody tr');
        rows.forEach((row, index) => {
          if (index < 3) { // First 3 rows are McGraw-Hillbooks
            row.classList.add('highlighted');
          }
        });
      }
    }

    // Problem 1B Implementation
    class Problem1B {
      static init() {
        this.currentStep = 0;
        this.maxSteps = 6;

        this.bindEvents();
        this.addKeyboardListener();
        this.populateExtendedData();
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static bindEvents() {
        // Step controls
        document.getElementById('prev-btn-1b').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn-1b').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn-1b').addEventListener('click', () => this.reset());
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }

      static nextStep() {
        if (this.currentStep < this.maxSteps) {
          this.currentStep++;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static previousStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        document.getElementById('prev-btn-1b').disabled = this.currentStep === 0;
        document.getElementById('next-btn-1b').disabled = this.currentStep >= this.maxSteps;
      }

      static updateStepIndicator() {
        const indicator = document.getElementById('step-indicator-1b');
        let html = '';
        for (let i = 0; i <= this.maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static populateExtendedData() {
        // Define extended borrowed data
        this.extendedBorrowedData = [
          {memb_no: 'M001', name: 'Alice', publisher: 'McGraw-Hill', title: 'Database Systems', date: '2024-01-15'},
          {memb_no: 'M001', name: 'Alice', publisher: 'McGraw-Hill', title: 'Operating Systems', date: '2024-01-16'},
          {memb_no: 'M001', name: 'Alice', publisher: 'McGraw-Hill', title: 'Computer Networks', date: '2024-01-17'},
          {memb_no: 'M002', name: 'Bob', publisher: 'McGraw-Hill', title: 'Database Systems', date: '2024-01-18'},
          {memb_no: 'M002', name: 'Bob', publisher: 'McGraw-Hill', title: 'Operating Systems', date: '2024-01-19'},
          {memb_no: 'M002', name: 'Bob', publisher: 'Pearson', title: 'Java Programming', date: '2024-01-20'},
          {memb_no: 'M002', name: 'Bob', publisher: 'Pearson', title: 'Python Guide', date: '2024-01-21'},
          {memb_no: 'M003', name: 'Charlie', publisher: 'Pearson', title: 'Java Programming', date: '2024-01-22'},
          {memb_no: 'M003', name: 'Charlie', publisher: 'Pearson', title: 'C++ Programming', date: '2024-01-23'},
          {memb_no: 'M003', name: 'Charlie', publisher: 'Pearson', title: 'Software Engineering', date: '2024-01-24'},
          {memb_no: 'M003', name: 'Charlie', publisher: 'Pearson', title: 'Algorithm Design', date: '2024-01-25'},
          {memb_no: 'M003', name: 'Charlie', publisher: 'Pearson', title: 'Data Structures', date: '2024-01-26'},
          {memb_no: 'M003', name: 'Charlie', publisher: 'Pearson', title: 'Computer Architecture', date: '2024-01-27'},
          {memb_no: 'M004', name: 'Diana', publisher: 'O\'Reilly', title: 'JavaScript Guide', date: '2024-01-28'},
          {memb_no: 'M004', name: 'Diana', publisher: 'O\'Reilly', title: 'React Handbook', date: '2024-01-29'},
          {memb_no: 'M004', name: 'Diana', publisher: 'O\'Reilly', title: 'Node.js Guide', date: '2024-01-30'},
          {memb_no: 'M004', name: 'Diana', publisher: 'O\'Reilly', title: 'Web Development', date: '2024-02-01'},
          {memb_no: 'M004', name: 'Diana', publisher: 'O\'Reilly', title: 'CSS Mastery', date: '2024-02-02'},
          {memb_no: 'M004', name: 'Diana', publisher: 'O\'Reilly', title: 'HTML5 Guide', date: '2024-02-03'},
          {memb_no: 'M005', name: 'Eve', publisher: 'MIT Press', title: 'AI Fundamentals', date: '2024-02-04'},
          {memb_no: 'M005', name: 'Eve', publisher: 'MIT Press', title: 'Machine Learning', date: '2024-02-05'},
          {memb_no: 'M005', name: 'Eve', publisher: 'Pearson', title: 'Statistics', date: '2024-02-06'}
        ];

        const tbody = document.getElementById('extended-borrowed-tbody');
        tbody.innerHTML = '';

        this.extendedBorrowedData.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.memb_no}</td>
            <td>${row.name}</td>
            <td>${row.publisher}</td>
            <td>${row.title}</td>
            <td>${row.date}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info-1b');
        const intermediateResults = document.getElementById('intermediate-results-1b');
        const resultExplanation = document.getElementById('result-explanation-1b');
        const sqlCode = document.getElementById('sql-code-1b');

        switch(step) {
          case 0:
            sqlCode.innerHTML = `<span class="sql-comment">-- Analyzing the problem...</span>`;
            stepInfo.innerHTML = '<strong>Step 0:</strong>Problem analysis - Find members who borrowed more than 5books from any publisher. Need to group by (publisher, member) and calculate book count for each group.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            this.highlightAllRows();
            break;

          case 1:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn`;
            stepInfo.innerHTML = '<strong>Step 1:</strong>Multi-table join - Member ⋈ Borrowed ⋈ Book, getting complete borrowing information including member names and publishers.';
            intermediateResults.innerHTML = `
              <h4>Multi-table Join Result (partial display)</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>publisher</th><th>title</th><th>borrow_date</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>McGraw-Hill</td><td>Database Systems</td><td>2024-01-15</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>McGraw-Hill</td><td>Operating Systems</td><td>2024-01-16</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>McGraw-Hill</td><td>Computer Networks</td><td>2024-01-17</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>Pearson</td><td>Java Programming</td><td>2024-01-22</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>Pearson</td><td>C++ Programming</td><td>2024-01-23</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>O'Reilly</td><td>JavaScript Guide</td><td>2024-01-28</td></tr>
                  <tr><td colspan="5" style="text-align: center; color: #6c757d; font-style: italic;">... ${this.extendedBorrowedData.length - 6} more records ...</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 2:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">GROUP BY</span>
  bk.publisher, m.memb_no, m.name`;
            stepInfo.innerHTML = '<strong>Step 2:</strong>GROUP BY - Group by (publisher, memb_no, name), calculating borrowed count for each \"publisher-member\" combination.';
            intermediateResults.innerHTML = `
              <h4>Data preview before grouping - Classified by publisher</h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                  <h5 style="color: #856404;">McGraw-Hill group</h5>
                  <ul style="margin: 10px 0; font-size: 0.9em;">
                    <li>M001 (Alice): 3 books</li>
                    <li>M002 (Bob): 2 books</li>
                  </ul>
                </div>
                <div style="background: #d4edda; padding: 15px; border-radius: 8px;">
                  <h5 style="color: #155724;">Pearson group</h5>
                  <ul style="margin: 10px 0; font-size: 0.9em;">
                    <li>M002 (Bob): 2 books</li>
                    <li><strong>M003 (Charlie): 6 books ✓</strong></li>
                    <li>M005 (Eve): 1 books</li>
                  </ul>
                </div>
                <div style="background: #d1ecf1; padding: 15px; border-radius: 8px;">
                  <h5 style="color: #0c5460;">O'Reilly group</h5>
                  <ul style="margin: 10px 0; font-size: 0.9em;">
                    <li><strong>M004 (Diana): 6 books ✓</strong></li>
                  </ul>
                </div>
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px;">
                  <h5 style="color: #721c24;">MIT Press group</h5>
                  <ul style="margin: 10px 0; font-size: 0.9em;">
                    <li>M005 (Eve): 2 books</li>
                  </ul>
                </div>
              </div>
            `;
            break;

          case 3:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">GROUP BY</span>
  bk.publisher, m.memb_no, m.name`;
            stepInfo.innerHTML = '<strong>Step 3:</strong>GROUP BY execution - Data aggregated by group keys, COUNT function calculates book count for each group.';
            intermediateResults.innerHTML = `
              <h4>GROUP BY Group Statistics Result</h4>
              <table>
                <thead><tr><th>publisher</th><th>memb_no</th><th>name</th><th>COUNT(isbn)</th><th>Status</th></tr></thead>
                <tbody>
                  <tr><td>McGraw-Hill</td><td>M001</td><td>Alice</td><td>3</td><td>Normal</td></tr>
                  <tr><td>McGraw-Hill</td><td>M002</td><td>Bob</td><td>2</td><td>Normal</td></tr>
                  <tr><td>Pearson</td><td>M002</td><td>Bob</td><td>2</td><td>Normal</td></tr>
                  <tr class="result-row"><td>Pearson</td><td>M003</td><td>Charlie</td><td>6</td><td><strong>meets condition</strong></td></tr>
                  <tr><td>Pearson</td><td>M005</td><td>Eve</td><td>1</td><td>Normal</td></tr>
                  <tr class="result-row"><td>O'Reilly</td><td>M004</td><td>Diana</td><td>6</td><td><strong>meets condition</strong></td></tr>
                  <tr><td>MIT Press</td><td>M005</td><td>Eve</td><td>2</td><td>Normal</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 4:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">GROUP BY</span>
  bk.publisher, m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(bk.isbn) > 5`;
            stepInfo.innerHTML = '<strong>Step 4:</strong>HAVING condition evaluation - Check COUNT(isbn) > 5 condition for each group.';
            intermediateResults.innerHTML = `
              <h4>HAVING Condition Evaluation: COUNT(isbn) > 5</h4>
              <table>
                <thead><tr><th>publisher</th><th>memb_no</th><th>name</th><th>book_count</th><th>> 5?</th><th>Result</th></tr></thead>
                <tbody>
                  <tr class="filtered-out"><td>McGraw-Hill</td><td>M001</td><td>Alice</td><td>3</td><td>✗</td><td>Filtered out</td></tr>
                  <tr class="filtered-out"><td>McGraw-Hill</td><td>M002</td><td>Bob</td><td>2</td><td>✗</td><td>Filtered out</td></tr>
                  <tr class="filtered-out"><td>Pearson</td><td>M002</td><td>Bob</td><td>2</td><td>✗</td><td>Filtered out</td></tr>
                  <tr class="result-row"><td>Pearson</td><td>M003</td><td>Charlie</td><td>6</td><td>✓</td><td><strong>Keep</strong></td></tr>
                  <tr class="filtered-out"><td>Pearson</td><td>M005</td><td>Eve</td><td>1</td><td>✗</td><td>Filtered out</td></tr>
                  <tr class="result-row"><td>O'Reilly</td><td>M004</td><td>Diana</td><td>6</td><td>✓</td><td><strong>Keep</strong></td></tr>
                  <tr class="filtered-out"><td>MIT Press</td><td>M005</td><td>Eve</td><td>2</td><td>✗</td><td>Filtered out</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 5:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">GROUP BY</span>
  bk.publisher, m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(bk.isbn) > 5;`;
            stepInfo.innerHTML = '<strong>Step 5:</strong>Final Result - Only display groups that satisfy HAVING conditions.';
            intermediateResults.innerHTML = `
              <h4>Final Query Result</h4>
              <table>
                <thead><tr><th>publisher</th><th>memb_no</th><th>name</th><th>book_count</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>Pearson</td><td>M003</td><td>Charlie</td><td>6</td></tr>
                  <tr class="result-row"><td>O'Reilly</td><td>M004</td><td>Diana</td><td>6</td></tr>
                </tbody>
              </table>
            `;
            resultExplanation.innerHTML = `
              <h4>Result Analysis</h4>
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <p><strong>Found Members:</strong></p>
                <ul>
                  <li><strong>Charlie (M003)</strong>: Borrowed 6books from Pearson publisher</li>
                  <li><strong>Diana (M004)</strong>: Borrowed 6books from O'Reilly publisher</li>
                </ul>
              </div>
            `;
            break;

          case 6:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  bk.publisher,
  m.memb_no,
  m.name,
  <span class="sql-function">COUNT</span>(bk.isbn) <span class="sql-keyword">AS</span> book_count
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no
<span class="sql-keyword">JOIN</span>
  Book bk <span class="sql-keyword">ON</span> b.isbn = bk.isbn
<span class="sql-keyword">GROUP BY</span>
  bk.publisher, m.memb_no, m.name
<span class="sql-keyword">HAVING</span>
  <span class="sql-function">COUNT</span>(bk.isbn) > 5;`;
            stepInfo.innerHTML = '<strong>Complete:</strong>GROUP BY + HAVING successfully found members who borrowed more than 5books from any publisher.';
            resultExplanation.innerHTML = `
              <h4>GROUP BY + HAVING Pattern Summary</h4>
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5>Core Concept Explanation:</h5>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                  <div>
                    <h6 style="color: #007bff;">GROUP BY Group</h6>
                    <ul style="font-size: 0.9em; margin: 8px 0;">
                      <li>Group data byspecified columns</li>
                      <li>Each group produces only one row of results</li>
                      <li>Can use aggregation functions</li>
                      <li>Group keys must be in SELECT</li>
                    </ul>
                  </div>
                  <div>
                    <h6 style="color: #28a745;">HAVING Filter</h6>
                    <ul style="font-size: 0.9em; margin: 8px 0;">
                      <li>Filter results after grouping</li>
                      <li>Can use aggregation function conditions</li>
                      <li>Execute after GROUP BY</li>
                      <li>Cannot replace WHERE</li>
                    </ul>
                  </div>
                </div>
                <h6 style="color: #dc3545;">WHERE vs HAVING:</h6>
                <ul style="font-size: 0.9em; margin: 8px 0;">
                  <li><strong>WHERE</strong>: Filter rows before grouping</li>
                  <li><strong>HAVING</strong>: Filter groups after grouping</li>
                  <li>Both can be used simultaneously</li>
                </ul>
              </div>
            `;
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('#extended-borrowed-table td, #extended-borrowed-table tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out');
        });
      }

      static highlightAllRows() {
        document.querySelectorAll('#extended-borrowed-table tbody tr').forEach((row, index) => {
          if (index < 10) { // Highlight first 10 rows to show variety
            row.classList.add('highlighted');
          }
        });
      }
    }

    // Problem 1C Implementation
    class Problem1C {
      static init() {
        this.currentStep = 0;
        this.currentMethod = 'subquery';
        this.maxSteps = { subquery: 4, 'left-join': 5 };

        this.bindEvents();
        this.addKeyboardListener();
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static bindEvents() {
        // Method selector
        document.querySelectorAll('#content-problem1-1c .method-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const method = e.target.dataset.method;
            this.switchMethod(method);
          });
        });

        // Step controls
        document.getElementById('prev-btn-1c').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn-1c').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn-1c').addEventListener('click', () => this.reset());
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }

      static switchMethod(method) {
        this.currentMethod = method;

        // Update method buttons
        document.querySelectorAll('#content-problem1-1c .method-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        document.querySelector(`#content-problem1-1c [data-method="${method}"]`).classList.add('active');

        // Reset to step 0 and update display
        this.currentStep = 0;
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static nextStep() {
        const maxSteps = this.maxSteps[this.currentMethod];
        if (this.currentStep < maxSteps) {
          this.currentStep++;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static previousStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        const maxSteps = this.maxSteps[this.currentMethod];
        document.getElementById('prev-btn-1c').disabled = this.currentStep === 0;
        document.getElementById('next-btn-1c').disabled = this.currentStep >= maxSteps;
      }

      static updateStepIndicator() {
        const maxSteps = this.maxSteps[this.currentMethod];
        const indicator = document.getElementById('step-indicator-1c');

        let html = '';
        for (let i = 0; i <= maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info-1c');
        const intermediateResults = document.getElementById('intermediate-results-1c');
        const resultExplanation = document.getElementById('result-explanation-1c');
        const sqlCode = document.getElementById('sql-code-1c');

        if (this.currentMethod === 'subquery') {
          this.showSubqueryStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode);
        } else {
          this.showLeftJoinStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode);
        }
      }

      static showSubqueryStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode) {
        // Update SQL code progressively based on step
        switch(step) {
          case 0:
            sqlCode.innerHTML = `<span class="sql-comment">-- Subquery method: Calculate numerator and denominator separately</span>`;
            stepInfo.innerHTML = '<strong>Step 0:</strong>Subquery method - Calculate total borrowings and total members separately, then divide to get the average. The key is that the denominator must include all members.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            this.highlightNonBorrowers();
            break;

          case 1:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Borrowed`;
            stepInfo.innerHTML = '<strong>Step 1:</strong>Calculate numerator - SELECT COUNT(*) FROM Borrowed counts total borrowed records.';
            intermediateResults.innerHTML = `
              <h4>Numerator Calculation: Total Borrowed Records Count</h4>
              <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px;">
                <div style="font-size: 1.2em; margin-bottom: 10px;">
                  <strong>SELECT COUNT(*) FROM Borrowed</strong>
                </div>
                <div style="font-size: 2.5em; color: #28a745; font-weight: bold;">11</div>
                <div style="color: #6c757d; margin-top: 8px;"> borrowed records</div>
              </div>
              <h4>Borrowed records details</h4>
              <table>
                <thead><tr><th>Record</th><th>Member</th><th>Book</th><th>Date</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>1</td><td>M001 (Alice)</td><td>Database Systems</td><td>2024-01-15</td></tr>
                  <tr class="highlighted"><td>2</td><td>M001 (Alice)</td><td>Operating Systems</td><td>2024-01-16</td></tr>
                  <tr class="highlighted"><td>3</td><td>M001 (Alice)</td><td>Computer Networks</td><td>2024-01-17</td></tr>
                  <tr class="highlighted"><td>4</td><td>M002 (Bob)</td><td>Database Systems</td><td>2024-01-18</td></tr>
                  <tr class="highlighted"><td>5</td><td>M002 (Bob)</td><td>Operating Systems</td><td>2024-01-19</td></tr>
                  <tr class="highlighted"><td>6</td><td>M003 (Charlie)</td><td>Database Systems</td><td>2024-01-20</td></tr>
                  <tr class="highlighted"><td>7</td><td>M003 (Charlie)</td><td>Java Programming</td><td>2024-01-21</td></tr>
                  <tr class="highlighted"><td>8</td><td>M004 (Diana)</td><td>Database Systems</td><td>2024-01-22</td></tr>
                  <tr class="highlighted"><td>9</td><td>M004 (Diana)</td><td>Operating Systems</td><td>2024-01-23</td></tr>
                  <tr class="highlighted"><td>10</td><td>M004 (Diana)</td><td>Computer Networks</td><td>2024-01-24</td></tr>
                  <tr class="highlighted"><td>11</td><td>M005 (Eve)</td><td>Java Programming</td><td>2024-01-25</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 2:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Member`;
            stepInfo.innerHTML = '<strong>Step 2:</strong>Calculate denominator - SELECT COUNT(*) FROM Member counts total members (key: include non-borrowing members).';
            intermediateResults.innerHTML = `
              <h4>Denominator Calculation: Total Members</h4>
              <div style="background: #fff3cd; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 20px;">
                <div style="font-size: 1.2em; margin-bottom: 10px;">
                  <strong>SELECT COUNT(*) FROM Member</strong>
                </div>
                <div style="font-size: 2.5em; color: #856404; font-weight: bold;">8</div>
                <div style="color: #6c757d; margin-top: 8px;"> members(including non-borrowers)</div>
              </div>
              <h4>All Members List</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>join_date</th><th>BorrowedStatus</th><th>borrowed count</th></tr></thead>
                <tbody>
                  <tr><td>M001</td><td>Alice</td><td>2023-01-15</td><td>Active</td><td>3books</td></tr>
                  <tr><td>M002</td><td>Bob</td><td>2023-02-20</td><td>Active</td><td>2books</td></tr>
                  <tr><td>M003</td><td>Charlie</td><td>2023-03-10</td><td>Active</td><td>2books</td></tr>
                  <tr><td>M004</td><td>Diana</td><td>2023-04-05</td><td>Active</td><td>3books</td></tr>
                  <tr><td>M005</td><td>Eve</td><td>2023-05-12</td><td>Active</td><td>1books</td></tr>
                  <tr class="result-row"><td>M006</td><td>Frank</td><td>2023-06-18</td><td><strong>Not borrowed</strong></td><td><strong>0books</strong></td></tr>
                  <tr class="result-row"><td>M007</td><td>Grace</td><td>2023-07-22</td><td><strong>Not borrowed</strong></td><td><strong>0books</strong></td></tr>
                  <tr class="result-row"><td>M008</td><td>Henry</td><td>2023-08-30</td><td><strong>Not borrowed</strong></td><td><strong>0books</strong></td></tr>
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #f8d7da; border-radius: 8px; border-left: 4px solid #dc3545;">
                <strong>Key point:</strong>If denominator only calculates members with borrowing records count(5 members), average would be 11÷5=2.2, this is wrong!
              </div>
            `;
            break;

          case 3:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Borrowed)::<span class="sql-keyword">numeric</span> /
  (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Member)::<span class="sql-keyword">numeric</span> <span class="sql-keyword">AS</span> average_books_per_member`;
            stepInfo.innerHTML = '<strong>Step 3:</strong>Calculate average - 11 ÷ 8 = 1.375, note using ::numeric to ensure floating point division.';
            intermediateResults.innerHTML = `
              <h4>Final Calculation</h4>
              <div style="background: #d4edda; padding: 30px; border-radius: 8px; text-align: center;">
                <div style="font-size: 1.8em; margin-bottom: 15px;">
                  <span style="color: #28a745; font-weight: bold;">11</span>
                  <span style="color: #6c757d;">(Total borrowed count)</span>
                  <span style="font-size: 1.2em; margin: 0 20px;">÷</span>
                  <span style="color: #856404; font-weight: bold;">8</span>
                  <span style="color: #6c757d;">(Total Members)</span>
                </div>
                <div style="font-size: 3em; color: #155724; font-weight: bold; margin: 20px 0;">
                  1.375
                </div>
                <div style="color: #6c757d; font-size: 1.1em;">
                  Each member averages borrowed <strong>1.375</strong> books
                </div>
              </div>
              <div style="margin-top: 20px;">
                <h5>Compare incorrect calculation:</h5>
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px;">
                  If only calculating active members:11 ÷ 5 = <strong>2.2</strong> books/per person(Wrong!)
                </div>
              </div>
            `;
            break;

          case 4:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Borrowed)::<span class="sql-keyword">numeric</span> /
  (<span class="sql-keyword">SELECT</span> <span class="sql-function">COUNT</span>(*) <span class="sql-keyword">FROM</span> Member)::<span class="sql-keyword">numeric</span> <span class="sql-keyword">AS</span> average_books_per_member;`;
            stepInfo.innerHTML = '<strong>Complete:</strong>Subquery method successfully calculated the correct average borrowed count including non-borrowing users.';
            resultExplanation.innerHTML = `
              <h4>Subquery Method Summary</h4>
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #007bff; margin-bottom: 15px;">Method Advantages:</h5>
                <ul style="margin-bottom: 20px;">
                  <li><strong>Clear logic</strong>:Calculate numerator and denominator separately, easy to understand</li>
                  <li><strong>Excellent performance</strong>:Each subquery executes only once</li>
                  <li><strong>Easy to debug</strong>:Can separately verify numerator and denominator</li>
                  <li><strong>Avoid complex JOINs</strong>:No need to handle NULL value logic</li>
                </ul>

                <h5 style="color: #dc3545; margin-bottom: 15px;">Key Technical Points:</h5>
                <ul style="margin-bottom: 20px;">
                  <li><strong>::numeric conversion</strong>:Ensure floating point division instead of integer division</li>
                  <li><strong>Include all entities</strong>:Denominator must be all members, not just active members</li>
                  <li><strong>Statistical granularity</strong>:COUNT(*)Count records, COUNT(column)Ignore NULL</li>
                </ul>

                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                  <strong>Application scenarios:</strong>When calculating statistical indicators involving "all" entities, the subquery method is usually the most intuitive choice.
                </div>
              </div>
            `;
            break;
        }
      }

      static showLeftJoinStep(step, stepInfo, intermediateResults, resultExplanation, sqlCode) {
        // Update SQL code progressively based on step
        switch(step) {
          case 0:
            sqlCode.innerHTML = `<span class="sql-comment">-- LEFT JOIN method: Complete all calculations in one query</span>`;
            stepInfo.innerHTML = '<strong>Step 0:</strong>LEFT JOIN method - Use LEFT JOIN to ensure all members are included, then utilize the NULL handling characteristics of aggregation functions.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            break;

          case 1:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span> *
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">LEFT JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no`;
            stepInfo.innerHTML = '<strong>Step 1:</strong>LEFT JOIN operation - Member LEFT JOIN Borrowed, ensuring all members are in the result, with non-borrowing members corresponding to NULL.';
            intermediateResults.innerHTML = `
              <h4>LEFT JOIN executeResult</h4>
              <table>
                <thead><tr><th>memb_no</th><th>name</th><th>isbn</th><th>borrow_date</th><th>Description</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-1</td><td>2024-01-15</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-2</td><td>2024-01-16</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M001</td><td>Alice</td><td>978-1-3</td><td>2024-01-17</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-1</td><td>2024-01-18</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M002</td><td>Bob</td><td>978-1-2</td><td>2024-01-19</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>978-1-1</td><td>2024-01-20</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M003</td><td>Charlie</td><td>978-2-1</td><td>2024-01-21</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-1</td><td>2024-01-22</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-2</td><td>2024-01-23</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M004</td><td>Diana</td><td>978-1-3</td><td>2024-01-24</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M005</td><td>Eve</td><td>978-2-1</td><td>2024-01-25</td><td>Has borrowed records</td></tr>
                  <tr class="result-row"><td>M006</td><td>Frank</td><td><strong>NULL</strong></td><td><strong>NULL</strong></td><td><strong>No borrowed records</strong></td></tr>
                  <tr class="result-row"><td>M007</td><td>Grace</td><td><strong>NULL</strong></td><td><strong>NULL</strong></td><td><strong>No borrowed records</strong></td></tr>
                  <tr class="result-row"><td>M008</td><td>Henry</td><td><strong>NULL</strong></td><td><strong>NULL</strong></td><td><strong>No borrowed records</strong></td></tr>
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #d1ecf1; border-radius: 8px; border-left: 4px solid #0c5460;">
                <strong>LEFT JOIN characteristics:</strong>Keep left table(Member) all records, right table(Borrowed)fills with NULL when no match.
              </div>
            `;
            break;

          case 2:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  <span class="sql-function">COUNT</span>(b.isbn)
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">LEFT JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no`;
            stepInfo.innerHTML = '<strong>Step 2:</strong>COUNT(b.isbn) - Calculate non-NULL isbn values, automatically ignoring NULL values from non-borrowing users.';
            intermediateResults.innerHTML = `
              <h4>COUNT(b.isbn) Calculation Process</h4>
              <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                <div style="font-size: 1.2em; margin-bottom: 10px;">
                  <strong>COUNT(b.isbn)</strong> automatically ignores NULL values
                </div>
                <div style="font-size: 2.5em; color: #28a745; font-weight: bold;">11</div>
                <div style="color: #6c757d;">Only calculate actual borrowed records</div>
              </div>
              <table>
                <thead><tr><th>isbnvalues</th><th>Counted by COUNT</th><th>Reason</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>978-1-1</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-2</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-3</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-1</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-2</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-1</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-2-1</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-1</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-2</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-1-3</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="highlighted"><td>978-2-1</td><td>✓</td><td>Valid values</td></tr>
                  <tr class="error-highlight"><td>NULL</td><td>✗</td><td>Ignored by COUNT</td></tr>
                  <tr class="error-highlight"><td>NULL</td><td>✗</td><td>Ignored by COUNT</td></tr>
                  <tr class="error-highlight"><td>NULL</td><td>✗</td><td>Ignored by COUNT</td></tr>
                </tbody>
              </table>
            `;
            break;

          case 3:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  <span class="sql-function">COUNT</span>(b.isbn),
  <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> m.memb_no)
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">LEFT JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no`;
            stepInfo.innerHTML = '<strong>Step 3:</strong>COUNT(DISTINCT m.memb_no) - Calculate all unique member IDs, including non-borrowing members.';
            intermediateResults.innerHTML = `
              <h4>COUNT(DISTINCT m.memb_no) Calculation Process</h4>
              <div style="background: #fff3cd; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                <div style="font-size: 1.2em; margin-bottom: 10px;">
                  <strong>COUNT(DISTINCT m.memb_no)</strong> Calculate all unique members
                </div>
                <div style="font-size: 2.5em; color: #856404; font-weight: bold;">8</div>
                <div style="color: #6c757d;">Include all members</div>
              </div>
              <table>
                <thead><tr><th>memb_no</th><th>Calculated by COUNT</th><th>Description</th></tr></thead>
                <tbody>
                  <tr class="highlighted"><td>M001</td><td>✓</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M002</td><td>✓</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M003</td><td>✓</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M004</td><td>✓</td><td>Has borrowed records</td></tr>
                  <tr class="highlighted"><td>M005</td><td>✓</td><td>Has borrowed records</td></tr>
                  <tr class="result-row"><td>M006</td><td><strong>✓</strong></td><td>No borrowed records, but still calculated</td></tr>
                  <tr class="result-row"><td>M007</td><td><strong>✓</strong></td><td>No borrowed records, but still calculated</td></tr>
                  <tr class="result-row"><td>M008</td><td><strong>✓</strong></td><td>No borrowed records, but still calculated</td></tr>
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #d4edda; border-radius: 8px; border-left: 4px solid #28a745;">
                <strong>Key point:</strong>Although Frank, Grace, Henry don't have borrowed records, their memb_no is not NULL, so they will be counted by COUNT(DISTINCT).
              </div>
            `;
            break;

          case 4:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  <span class="sql-function">CAST</span>(<span class="sql-function">COUNT</span>(b.isbn) <span class="sql-keyword">AS</span> <span class="sql-keyword">REAL</span>) / <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> m.memb_no) <span class="sql-keyword">AS</span> average_books_per_member
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">LEFT JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no`;
            stepInfo.innerHTML = '<strong>Step 4:</strong>Final Calculation - CAST(11 AS REAL) / 8 = 1.375';
            intermediateResults.innerHTML = `
              <h4>Final Calculation</h4>
              <div style="background: #d4edda; padding: 30px; border-radius: 8px; text-align: center;">
                <div style="font-size: 1.8em; margin-bottom: 15px;">
                  <span style="color: #28a745; font-weight: bold;">CAST(11 AS REAL)</span>
                  <span style="color: #6c757d;">(Total borrowed count)</span>
                  <span style="font-size: 1.2em; margin: 0 20px;">÷</span>
                  <span style="color: #856404; font-weight: bold;">8</span>
                  <span style="color: #6c757d;">(Total Members)</span>
                </div>
                <div style="font-size: 3em; color: #155724; font-weight: bold; margin: 20px 0;">
                  1.375
                </div>
              </div>
            `;
            break;

          case 5:
            sqlCode.innerHTML = `<span class="sql-keyword">SELECT</span>
  <span class="sql-function">CAST</span>(<span class="sql-function">COUNT</span>(b.isbn) <span class="sql-keyword">AS</span> <span class="sql-keyword">REAL</span>) / <span class="sql-function">COUNT</span>(<span class="sql-keyword">DISTINCT</span> m.memb_no) <span class="sql-keyword">AS</span> average_books_per_member
<span class="sql-keyword">FROM</span>
  Member m
<span class="sql-keyword">LEFT JOIN</span>
  Borrowed b <span class="sql-keyword">ON</span> m.memb_no = b.memb_no;`;
            stepInfo.innerHTML = '<strong>Complete:</strong>LEFT JOIN method achieved the same result, demonstrating the combined usage techniques of JOIN and aggregation functions.';
            resultExplanation.innerHTML = `
              <h4>LEFT JOINMethod Summary</h4>
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #007bff; margin-bottom: 15px;">Method Advantages:</h5>
                <ul style="margin-bottom: 20px;">
                  <li><strong>Complete in one query</strong>:Avoid overhead of multiple subqueries</li>
                  <li><strong>Demonstrate JOIN techniques</strong>:Demonstrates practical application of LEFT JOIN</li>
                  <li><strong>Aggregation function combination</strong>:Cleverly use COUNT for NULL distinct handling</li>
                  <li><strong>NULL values handling</strong>:Naturally handles missing data situations</li>
                </ul>

                <h5 style="color: #dc3545; margin-bottom: 15px;">Key Technical Points:</h5>
                <ul style="margin-bottom: 20px;">
                  <li><strong>LEFT JOIN</strong>: Keep all records from left table</li>
                  <li><strong>COUNT(column)</strong>: Automatically ignore NULL values</li>
                  <li><strong>COUNT(DISTINCT)</strong>: Calculate count of unique values</li>
                  <li><strong>CAST AS REAL</strong>: Ensure floating-point division</li>
                </ul>

                <h5 style="color: #28a745; margin-bottom: 15px;">Method Comparison:</h5>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                    <h6>Subquery method</h6>
                    <ul style="font-size: 0.9em;">
                      <li>More intuitive logic</li>
                      <li>Easy to debug</li>
                      <li>Suitable for simple scenarios</li>
                    </ul>
                  </div>
                  <div style="background: #d1ecf1; padding: 15px; border-radius: 8px;">
                    <h6>LEFT JOIN Method</h6>
                    <ul style="font-size: 0.9em;">
                      <li>Single query execution</li>
                      <li>Demonstrate JOIN techniques</li>
                      <li>Suitable for complex statistics</li>
                    </ul>
                  </div>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-top: 15px;">
                  <strong>Both methods yield identical results</strong>, both correctly handle the case of users with no borrows, demonstrating SQL's flexibility.
                </div>
              </div>
            `;
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('#all-members-table-1c td, #all-members-table-1c tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out', 'error-highlight');
        });
      }

      static highlightNonBorrowers() {
        // Highlight the non-borrowing members in the main table
        const rows = document.querySelectorAll('#all-members-table-1c tbody tr');
        rows.forEach((row, index) => {
          if (index >= 5) { // Last 3 rows are non-borrowers
            row.classList.add('result-row');
          }
        });
      }
    }

    // Problem 2A Implementation
    class Problem2A {
      static init() {
        this.currentStep = 0;
        this.maxSteps = 5;

        this.bindEvents();
        this.addKeyboardListener();
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static bindEvents() {
        // Step controls
        document.getElementById('prev-btn-2a').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn-2a').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn-2a').addEventListener('click', () => this.reset());
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }

      static nextStep() {
        if (this.currentStep < this.maxSteps) {
          this.currentStep++;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static previousStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        document.getElementById('prev-btn-2a').disabled = this.currentStep === 0;
        document.getElementById('next-btn-2a').disabled = this.currentStep >= this.maxSteps;
      }

      static updateStepIndicator() {
        const indicator = document.getElementById('step-indicator-2a');
        let html = '';
        for (let i = 0; i <= this.maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info-2a');
        const intermediateResults = document.getElementById('intermediate-results-2a');
        const resultExplanation = document.getElementById('result-explanation-2a');

        switch(step) {
          case 0:
            stepInfo.innerHTML = '<strong>Step 0:</strong>Initial status - We have three tables: Aircraft (planes), Certified (certifications) and Employees (staff). The goal is to find pilot IDs who fly Boeing aircraft.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            break;

          case 1:
            stepInfo.innerHTML = '<strong>Step 1:</strong>Selection operation σ<sub>aname LIKE \'Boeing%\'</sub>(Aircraft) - Filter all Boeing aircraft from the Aircraft table.';
            intermediateResults.innerHTML = `
              <h4>Selection operation: Filter Boeing aircraft</h4>
              <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft)</strong>
              </div>
              <table>
                <thead><tr><th>aid</th><th>aname</th><th>cruisingrange</th><th>Status</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>A001</td><td>Boeing 737</td><td>3000</td><td>✓ Selected</td></tr>
                  <tr class="result-row"><td>A002</td><td>Boeing 747</td><td>7500</td><td>✓ Selected</td></tr>
                  <tr class="filtered-out"><td>A003</td><td>Airbus A320</td><td>3500</td><td>✗ Filter</td></tr>
                  <tr class="result-row"><td>A004</td><td>Boeing 777</td><td>9700</td><td>✓ Selected</td></tr>
                  <tr class="filtered-out"><td>A005</td><td>Airbus A380</td><td>8000</td><td>✗ Filter</td></tr>
                </tbody>
              </table>
            `;
            this.highlightBoeingAircraft();
            break;

          case 2:
            stepInfo.innerHTML = '<strong>Step 2:</strong>Selection result - Get all Boeing aircraft records.';
            intermediateResults.innerHTML = `
              <h4>Selection Operation Result</h4>
              <table>
                <thead><tr><th>aid</th><th>aname</th><th>cruisingrange</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>A001</td><td>Boeing 737</td><td>3000</td></tr>
                  <tr class="result-row"><td>A002</td><td>Boeing 747</td><td>7500</td></tr>
                  <tr class="result-row"><td>A004</td><td>Boeing 777</td><td>9700</td></tr>
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                <strong>Note:</strong>Filtered 3 Boeing aircraft from 5 total aircraft.
              </div>
            `;
            break;

          case 3:
            stepInfo.innerHTML = '<strong>Step 3:</strong>Natural join ⋈ - Perform natural join between filtered Boeing aircraft and Certified table (based on aid column).';
            intermediateResults.innerHTML = `
              <h4>Natural join operation: Boeing Aircraft ⋈ Certified</h4>
              <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>(σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft)) ⋈ Certified</strong>
              </div>
              <table>
                <thead><tr><th>aid</th><th>aname</th><th>cruisingrange</th><th>eid</th><th>Description</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>A001</td><td>Boeing 737</td><td>3000</td><td>E101</td><td>E101certified forBoeing 737</td></tr>
                  <tr class="result-row"><td>A001</td><td>Boeing 737</td><td>3000</td><td>E102</td><td>E102certified forBoeing 737</td></tr>
                  <tr class="result-row"><td>A001</td><td>Boeing 737</td><td>3000</td><td>E104</td><td>E104certified forBoeing 737</td></tr>
                  <tr class="result-row"><td>A002</td><td>Boeing 747</td><td>7500</td><td>E101</td><td>E101certified forBoeing 747</td></tr>
                  <tr class="result-row"><td>A002</td><td>Boeing 747</td><td>7500</td><td>E104</td><td>E104certified forBoeing 747</td></tr>
                  <tr class="result-row"><td>A004</td><td>Boeing 777</td><td>9700</td><td>E102</td><td>E102certified forBoeing 777</td></tr>
                  <tr class="result-row"><td>A004</td><td>Boeing 777</td><td>9700</td><td>E104</td><td>E104certified forBoeing 777</td></tr>
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #d4edda; border-radius: 8px;">
                <strong>Join condition:</strong>Aircraft.aid = Certified.aid
              </div>
            `;
            break;

          case 4:
            stepInfo.innerHTML = '<strong>Step 4:</strong>Projection operation π<sub>eid</sub> - Keep only the eid column from join result.';
            intermediateResults.innerHTML = `
              <h4>Projection operation: Extract employee IDs</h4>
              <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>π<sub>eid</sub>((σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft)) ⋈ Certified)</strong>
              </div>
              <table>
                <thead><tr><th>eid</th><th>Description</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>E101</td><td>certified forBoeing 737, Boeing 747</td></tr>
                  <tr class="result-row"><td>E102</td><td>certified forBoeing 737, Boeing 777</td></tr>
                  <tr class="result-row"><td>E104</td><td>certified forBoeing 737, Boeing 747, Boeing 777</td></tr>
                </tbody>
              </table>
              <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                <strong>Note:</strong>Projection operation automatically removes duplicate eid values.
              </div>
            `;
            break;

          case 5:
            stepInfo.innerHTML = '<strong>Complete:</strong>Successfully found all pilot IDs who fly Boeing aircraft.';
            intermediateResults.innerHTML = `
              <h4>Final Result</h4>
              <table>
                <thead><tr><th>eid</th><th>Pilot Name</th><th>Certified Boeing Aircraft</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>E101</td><td>John Smith</td><td>Boeing 737, Boeing 747</td></tr>
                  <tr class="result-row"><td>E102</td><td>Sarah Johnson</td><td>Boeing 737, Boeing 777</td></tr>
                  <tr class="result-row"><td>E104</td><td>Lisa Brown</td><td>Boeing 737, Boeing 747, Boeing 777</td></tr>
                </tbody>
              </table>
            `;
            resultExplanation.innerHTML = `
              <h4>Relational Algebra Operations Summary</h4>
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <h5 style="color: #007bff;">Core Operations Explanation:</h5>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #28a745;">σ (Selection)</h6>
                    <p style="font-size: 0.9em;">Filter rows by condition</p>
                    <p style="font-size: 0.8em; color: #6c757d;">Horizontal table partitioning</p>
                  </div>
                  <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #0c5460;">⋈ (Natural join)</h6>
                    <p style="font-size: 0.9em;">Join based on common attributes</p>
                    <p style="font-size: 0.8em; color: #6c757d;">Combine related information</p>
                  </div>
                  <div style="background: #fff3cd; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #856404;">π (projection)</h6>
                    <p style="font-size: 0.9em;">Select specific columns</p>
                    <p style="font-size: 0.8em; color: #6c757d;">Vertical table slicing</p>
                  </div>
                </div>

                <h5 style="color: #dc3545;">Importance of execution order:</h5>
                <ol style="margin: 10px 0;">
                  <li><strong>Selection first, then join</strong>:Reduce data volume for joins, improve efficiency</li>
                  <li><strong>Projection at the end</strong>:Ensure required attributes are available throughout the operation</li>
                  <li><strong>Natural join characteristics</strong>:Automatically match attributes with same name, simplify expressions</li>
                </ol>

                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                  <strong>Practical applications:</strong>This query pattern is very common in practical database systems, such as finding employees with specific qualifications, team members with specific skills, etc.
                </div>
              </div>
            `;
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('#aircraft-table td, #aircraft-table tr, #certified-table td, #certified-table tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out');
        });
      }

      static highlightBoeingAircraft() {
        const aircraftTable = document.getElementById('aircraft-table');
        const rows = aircraftTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const anameCell = row.cells[1];
          if (anameCell && anameCell.textContent.includes('Boeing')) {
            row.classList.add('result-row');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }
    }

    // Problem 2b: Find Employee Names for Pilots of Boeing Aircraft
    class Problem2B {
      static init() {
        this.currentStep = 0;
        this.maxSteps = 7;

        this.bindEvents();
        this.addKeyboardListener();
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static bindEvents() {
        document.getElementById('prev-btn-2b').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn-2b').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn-2b').addEventListener('click', () => this.reset());
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }

      static nextStep() {
        if (this.currentStep < this.maxSteps) {
          this.currentStep++;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static previousStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        document.getElementById('prev-btn-2b').disabled = this.currentStep === 0;
        document.getElementById('next-btn-2b').disabled = this.currentStep >= this.maxSteps;
      }

      static updateStepIndicator() {
        const indicator = document.getElementById('step-indicator-2b');
        let html = '';
        for (let i = 0; i <= this.maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info-2b');
        const intermediateResults = document.getElementById('intermediate-results-2b');
        const resultExplanation = document.getElementById('result-explanation-2b');

        switch(step) {
          case 0:
            stepInfo.innerHTML = '<strong>Step 0:</strong> Initial status - We have three tables: Aircraft (planes), Certified (certifications) and Employees (staff). The goal is to find pilot names who fly Boeing aircraft.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            break;

          case 1:
            stepInfo.innerHTML = '<strong>Step 1:</strong> Selection operation σ<sub>aname LIKE \'Boeing%\'</sub>(Aircraft) - Filter all Boeing aircraft from the Aircraft table.';
            intermediateResults.innerHTML = `
              <h4>Selection operation: Filter Boeing aircraft</h4>
              <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft)</strong>
              </div>
              <table>
                <thead><tr><th>aid</th><th>aname</th><th>cruisingrange</th><th>Status</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td><td>✓ Selected</td></tr>
                  <tr class="filtered-out"><td>102</td><td>Airbus A320</td><td>2500</td><td>✗ Filtered</td></tr>
                  <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td><td>✓ Selected</td></tr>
                  <tr class="filtered-out"><td>104</td><td>Cessna 172</td><td>800</td><td>✗ Filtered</td></tr>
                  <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td><td>✓ Selected</td></tr>
                  <tr class="filtered-out"><td>106</td><td>Embraer E190</td><td>2400</td><td>✗ Filtered</td></tr>
                </tbody>
              </table>
            `;
            this.highlightBoeingAircraft();
            break;

          case 2:
            stepInfo.innerHTML = '<strong>Step 2:</strong> Selection result - Get all Boeing aircraft records (R1 = 3 records).';
            intermediateResults.innerHTML = `
              <h4>Selection Operation Result (R1)</h4>
              <table>
                <thead><tr><th>aid</th><th>aname</th><th>cruisingrange</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td></tr>
                  <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td></tr>
                  <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td></tr>
                </tbody>
              </table>
              <p style="margin-top: 15px;">Result R1 contains <strong>3 Boeing aircraft</strong></p>
            `;
            this.highlightBoeingAircraft();
            break;

          case 3:
            stepInfo.innerHTML = '<strong>Step 3:</strong> First Natural Join - R1 ⋈ Certified (join based on common attribute aid).';
            intermediateResults.innerHTML = `
              <h4>First Natural Join: R1 ⋈ Certified</h4>
              <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>Join Condition:</strong> R1.aid = Certified.aid<br>
                <strong>Purpose:</strong> Find employee IDs certified for Boeing aircraft
              </div>
              <table>
                <thead><tr><th>eid</th><th>aid</th><th>aname</th><th>cruisingrange</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>101</td><td>101</td><td>Boeing 747</td><td>3000</td></tr>
                  <tr class="result-row"><td>102</td><td>101</td><td>Boeing 747</td><td>3000</td></tr>
                  <tr class="result-row"><td>101</td><td>103</td><td>Boeing 777</td><td>4500</td></tr>
                  <tr class="result-row"><td>104</td><td>103</td><td>Boeing 777</td><td>4500</td></tr>
                  <tr class="result-row"><td>102</td><td>105</td><td>Boeing 737</td><td>2200</td></tr>
                  <tr class="result-row"><td>106</td><td>105</td><td>Boeing 737</td><td>2200</td></tr>
                </tbody>
              </table>
              <p style="margin-top: 15px;">Result R2 contains <strong>6 certification records</strong></p>
            `;
            this.highlightBoeingCertified();
            break;

          case 4:
            stepInfo.innerHTML = '<strong>Step 4:</strong> First Join Result - We now have employee IDs (eid) certified for Boeing aircraft.';
            intermediateResults.innerHTML = `
              <h4>First Join Result (R2)</h4>
              <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>Result Attributes:</strong> (eid, aid, aname, cruisingrange)<br>
                <strong>Key Information:</strong> Employee IDs who can fly Boeing aircraft
              </div>
              <table>
                <thead><tr><th>eid</th><th>aid</th><th>aname</th></tr></thead>
                <tbody>
                  <tr class="highlight"><td>101</td><td>101</td><td>Boeing 747</td></tr>
                  <tr class="highlight"><td>102</td><td>101</td><td>Boeing 747</td></tr>
                  <tr class="highlight"><td>101</td><td>103</td><td>Boeing 777</td></tr>
                  <tr class="highlight"><td>104</td><td>103</td><td>Boeing 777</td></tr>
                  <tr class="highlight"><td>102</td><td>105</td><td>Boeing 737</td></tr>
                  <tr class="highlight"><td>106</td><td>105</td><td>Boeing 737</td></tr>
                </tbody>
              </table>
            `;
            this.highlightBoeingCertified();
            break;

          case 5:
            stepInfo.innerHTML = '<strong>Step 5:</strong> Second Natural Join - R2 ⋈ Employees (join based on common attribute eid).';
            intermediateResults.innerHTML = `
              <h4>Second Natural Join: R2 ⋈ Employees</h4>
              <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>Join Condition:</strong> R2.eid = Employees.eid<br>
                <strong>Purpose:</strong> Get complete employee information including names
              </div>
              <table>
                <thead><tr><th>eid</th><th>ename</th><th>aid</th><th>aname</th><th>salary</th></tr></thead>
                <tbody>
                  <tr class="result-row"><td>101</td><td>Alice Johnson</td><td>101</td><td>Boeing 747</td><td>75000</td></tr>
                  <tr class="result-row"><td>102</td><td>Bob Smith</td><td>101</td><td>Boeing 747</td><td>82000</td></tr>
                  <tr class="result-row"><td>101</td><td>Alice Johnson</td><td>103</td><td>Boeing 777</td><td>75000</td></tr>
                  <tr class="result-row"><td>104</td><td>David Wilson</td><td>103</td><td>Boeing 777</td><td>90000</td></tr>
                  <tr class="result-row"><td>102</td><td>Bob Smith</td><td>105</td><td>Boeing 737</td><td>82000</td></tr>
                  <tr class="result-row"><td>106</td><td>Frank Miller</td><td>105</td><td>Boeing 737</td><td>85000</td></tr>
                </tbody>
              </table>
              <p style="margin-top: 15px;">Result R3 contains <strong>complete pilot information</strong></p>
            `;
            this.highlightEmployeesJoin();
            break;

          case 6:
            stepInfo.innerHTML = '<strong>Step 6:</strong> Second Join Result - We now have complete information including pilot names.';
            intermediateResults.innerHTML = `
              <h4>Second Join Result (R3)</h4>
              <div style="background: #e1f5fe; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>Result Attributes:</strong> (eid, ename, aid, aname, cruisingrange, salary)<br>
                <strong>Key Information:</strong> All information about pilots flying Boeing aircraft
              </div>
              <table>
                <thead><tr><th>eid</th><th>ename</th><th>aid</th><th>aname</th></tr></thead>
                <tbody>
                  <tr class="highlight"><td>101</td><td>Alice Johnson</td><td>101</td><td>Boeing 747</td></tr>
                  <tr class="highlight"><td>102</td><td>Bob Smith</td><td>101</td><td>Boeing 747</td></tr>
                  <tr class="highlight"><td>101</td><td>Alice Johnson</td><td>103</td><td>Boeing 777</td></tr>
                  <tr class="highlight"><td>104</td><td>David Wilson</td><td>103</td><td>Boeing 777</td></tr>
                  <tr class="highlight"><td>102</td><td>Bob Smith</td><td>105</td><td>Boeing 737</td></tr>
                  <tr class="highlight"><td>106</td><td>Frank Miller</td><td>105</td><td>Boeing 737</td></tr>
                </tbody>
              </table>
            `;
            this.highlightEmployeesJoin();
            break;

          case 7:
            stepInfo.innerHTML = '<strong>Step 7:</strong> Projection operation π<sub>ename</sub> - Keep only employee names to get final result.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = `
              <h4>Final Result: Projection π<sub>ename</sub></h4>
              <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #2e7d32; text-align: center; margin-bottom: 20px;">
                  π<sub>ename</sub>(σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft) ⋈ Certified ⋈ Employees)
                </div>
                <table>
                  <thead><tr><th>ename</th></tr></thead>
                  <tbody>
                    <tr class="result-row"><td>Alice Johnson</td></tr>
                    <tr class="result-row"><td>Bob Smith</td></tr>
                    <tr class="result-row"><td>David Wilson</td></tr>
                    <tr class="result-row"><td>Frank Miller</td></tr>
                  </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 8px;">
                  <strong>Final Answer:</strong> 4 pilots can fly Boeing aircraft
                  <ul style="margin: 10px 0;">
                    <li>Alice Johnson</li>
                    <li>Bob Smith</li>
                    <li>David Wilson</li>
                    <li>Frank Miller</li>
                  </ul>
                </div>
              </div>

              <h5 style="color: #495057; margin-top: 30px;">Operation Summary:</h5>
              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 15px 0;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                  <h6 style="color: #1976d2;">σ Selection</h6>
                  <p style="font-size: 0.9em;">Filter Boeing aircraft</p>
                </div>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center;">
                  <h6 style="color: #388e3c;">⋈ Join 1</h6>
                  <p style="font-size: 0.9em;">Get certifications</p>
                </div>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center;">
                  <h6 style="color: #7b1fa2;">⋈ Join 2</h6>
                  <p style="font-size: 0.9em;">Get employee info</p>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                  <h6 style="color: #f57c00;">π Projection</h6>
                  <p style="font-size: 0.9em;">Keep only names</p>
                </div>
              </div>
            `;
            this.showFinalResult();
            break;
      }
    }

    static clearHighlights() {
        document.querySelectorAll('#content-problem2-2b #aircraft-table-2b td, #content-problem2-2b #aircraft-table-2b tr, #content-problem2-2b #certified-table-2b td, #content-problem2-2b #certified-table-2b tr, #content-problem2-2b #employees-table-2b td, #content-problem2-2b #employees-table-2b tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out');
        });
      }

      static removeKeyboardListener() {
        // Empty function for compatibility
      }

      static highlightBoeingAircraft() {
        const aircraftTable = document.querySelector('#content-problem2-2b #aircraft-table-2b');
        const rows = aircraftTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const anameCell = row.cells[1];
          if (anameCell && anameCell.textContent.includes('Boeing')) {
            row.classList.add('result-row');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showSelectionResult() {
        const resultContainer = document.querySelector('#content-problem2-2b #result-table-container');
        resultContainer.innerHTML = `
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>aname</th>
                <th>cruisingrange</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td></tr>
              <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td></tr>
              <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td></tr>
            </tbody>
          </table>
        `;
      }

      static highlightBoeingCertified() {
        // Highlight relevant aircraft rows
        Problem2B.highlightBoeingAircraft();

        // Highlight relevant certified rows
        const certifiedTable = document.querySelector('#content-problem2-2b #certified-table-2b');
        const certifiedRows = certifiedTable.querySelectorAll('tbody tr');
        certifiedRows.forEach(row => {
          const aidCell = row.cells[1];
          if (aidCell && ['101', '103', '105'].includes(aidCell.textContent)) {
            row.classList.add('result-row');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showFirstJoinResult() {
        const resultContainer = document.querySelector('#content-problem2-2b #result-table-container');
        resultContainer.innerHTML = `
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>aname</th>
                <th>cruisingrange</th>
                <th>eid</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td><td>101</td></tr>
              <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td><td>102</td></tr>
              <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td><td>101</td></tr>
              <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td><td>104</td></tr>
              <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td><td>102</td></tr>
              <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td><td>106</td></tr>
            </tbody>
          </table>
        `;
      }

      static highlightEmployeesJoin() {
        Problem2B.highlightBoeingCertified();

        // Highlight relevant employees
        const employeesTable = document.querySelector('#content-problem2-2b #employees-table-2b');
        const employeesRows = employeesTable.querySelectorAll('tbody tr');
        employeesRows.forEach(row => {
          const eidCell = row.cells[0];
          if (eidCell && ['101', '102', '104', '106'].includes(eidCell.textContent)) {
            row.classList.add('result-row');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showSecondJoinResult() {
        const resultContainer = document.querySelector('#content-problem2-2b #result-table-container');
        resultContainer.innerHTML = `
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>aname</th>
                <th>cruisingrange</th>
                <th>eid</th>
                <th>ename</th>
                <th>salary</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td><td>101</td><td>Alice Johnson</td><td>75000</td></tr>
              <tr class="result-row"><td>101</td><td>Boeing 747</td><td>3000</td><td>102</td><td>Bob Smith</td><td>82000</td></tr>
              <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td><td>101</td><td>Alice Johnson</td><td>75000</td></tr>
              <tr class="result-row"><td>103</td><td>Boeing 777</td><td>4500</td><td>104</td><td>David Wilson</td><td>90000</td></tr>
              <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td><td>102</td><td>Bob Smith</td><td>82000</td></tr>
              <tr class="result-row"><td>105</td><td>Boeing 737</td><td>2200</td><td>106</td><td>Frank Miller</td><td>85000</td></tr>
            </tbody>
          </table>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem2-2b #result-table-container');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">🎯 Final Answer</h5>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #e8f5e8;">
            <thead>
              <tr>
                <th>ename</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Alice Johnson</td></tr>
              <tr class="result-row"><td>Bob Smith</td></tr>
              <tr class="result-row"><td>David Wilson</td></tr>
              <tr class="result-row"><td>Frank Miller</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            4 pilots certified for Boeing aircraft in total
          </div>
        `;
      }
    }

    // Problem 2c: Find Aircraft IDs that Can Fly from Bonn to Madras
    class Problem2C {
      static init() {
        this.currentStep = 0;
        this.maxSteps = 6;

        const container = document.querySelector('#content-problem2-2c .step-controls');
        container.innerHTML = `
          <h3 style="color: #495057; margin-bottom: 20px;">Problem 2c: Find aircraft IDs that can fly from Bonn to Madras</h3>
        `;

        const contentArea = document.querySelector('#content-problem2-2c .content-area');
        contentArea.innerHTML = `
          <div class="tables-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
            <div>
              <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">Aircraft Table</h4>
              <table id="aircraft-table-2c" class="data-table">
                <thead>
                  <tr>
                    <th>aid</th>
                    <th>aname</th>
                    <th>cruisingrange</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>101</td><td>Boeing 747</td><td>8000</td></tr>
                  <tr><td>102</td><td>Airbus A320</td><td>2500</td></tr>
                  <tr><td>103</td><td>Boeing 777</td><td>9500</td></tr>
                  <tr><td>104</td><td>Cessna 172</td><td>800</td></tr>
                  <tr><td>105</td><td>Boeing 737</td><td>2200</td></tr>
                  <tr><td>106</td><td>Airbus A350</td><td>15000</td></tr>
                </tbody>
              </table>
            </div>
            <div>
              <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">Flights Table</h4>
              <table id="flights-table-2c" class="data-table">
                <thead>
                  <tr>
                    <th>flno</th>
                    <th>from</th>
                    <th>to</th>
                    <th>distance</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>F101</td><td>Berlin</td><td>Paris</td><td>880</td></tr>
                  <tr><td>F102</td><td>Bonn</td><td>London</td><td>650</td></tr>
                  <tr><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
                  <tr><td>F104</td><td>London</td><td>New York</td><td>5500</td></tr>
                  <tr><td>F105</td><td>Paris</td><td>Rome</td><td>1100</td></tr>
                  <tr><td>F106</td><td>Madrid</td><td>Bonn</td><td>1300</td></tr>
                  <tr><td>F107</td><td>Madras</td><td>Tokyo</td><td>6000</td></tr>
                  <tr><td>F108</td><td>Bonn</td><td>Frankfurt</td><td>180</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Relational Algebra Expression -->
          <div class="algebra-expression" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3 style="color: #495057; margin-bottom: 15px;">Relational Algebra Expression</h3>
            <div style="font-size: 1.5em; font-family: 'Times New Roman', serif; color: #007bff;">
              π<sub>aid</sub>(σ<sub>from='Bonn' ∧ to='Madras' ∧ cruisingrange≥distance</sub>(Aircraft × Flights))
            </div>
          </div>

          <!-- Step Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-2c">
              <!-- Step dots will be generated by JavaScript -->
            </div>
            <div>
              <button class="btn" id="prev-btn-2c">Previous</button>
              <button class="btn" id="next-btn-2c">Next</button>
              <button class="btn btn-reset" id="reset-btn-2c">Reset</button>
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-2c">
            <strong>Problem Analysis:</strong> Find aircraft IDs that can execute flights from Bonn to Madras. Need to use Cartesian product to generate all aircraft-flight combinations, then use composite conditions to filter records that meet the range requirements.
          </div>

          <div id="result-area" style="margin-top: 40px;">
            <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">executeResult</h4>
            <div id="result-table-container-2c"></div>
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-2c">
            <!-- Dynamic content will be inserted here -->
          </div>
        `;

        this.bindEvents();
        this.addKeyboardListener();
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static bindEvents() {
        document.getElementById('prev-btn-2c').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn-2c').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn-2c').addEventListener('click', () => this.reset());
      }

      static nextStep() {
        if (this.currentStep < this.maxSteps) {
          this.currentStep++;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static previousStep() {
        if (this.currentStep > 0) {
          this.currentStep--;
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        document.getElementById('prev-btn-2c').disabled = this.currentStep === 0;
        document.getElementById('next-btn-2c').disabled = this.currentStep >= this.maxSteps;
      }

      static updateStepIndicator() {
        const indicator = document.getElementById('step-indicator-2c');
        let html = '';
        for (let i = 0; i <= this.maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info-2c');
        const resultExplanation = document.getElementById('result-explanation-2c');

        switch(step) {
          case 0:
            stepInfo.innerHTML = '<strong>Step 0:</strong> Problem Analysis - Find aircraft IDs that can execute flights from Bonn to Madras. Need to use Cartesian product to generate all aircraft-flight combinations, then use composite conditions to filter records that meet the range requirements.';
            this.clearResultArea();
            resultExplanation.innerHTML = '';
            break;
          case 1:
            stepInfo.innerHTML = '<strong>Step 1:</strong> Problem Understanding & Relational Algebra Analysis - Complete Expression: π<sub>aid</sub>(σ<sub>from=\'Bonn\' ∧ to=\'Madras\' ∧ cruisingrange≥distance</sub>(Aircraft × Flights))';
            resultExplanation.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 1: Problem Understanding & Relational Algebra Analysis</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Complete Relational Algebra Expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #007bff; line-height: 1.5;">
                    π<sub>aid</sub>(σ<sub>from='Bonn' ∧ to='Madras' ∧ cruisingrange≥distance</sub>(Aircraft × Flights))
                  </div>
                </div>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                  <strong>Query Goal:</strong>Find aircraft IDs capable of executing flights from Bonn to Madras
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                  <strong>Expression breakdown:</strong>
                  <ol style="margin: 10px 0;">
                    <li><strong>Aircraft × Flights</strong> - Cartesian product: Generate all aircraft-flight combinations</li>
                    <li><strong>σ<sub>conditions</sub>(...)</strong> - Selection operation:Filter records that satisfy triple constraints
                      <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>from = 'Bonn' (departure)</li>
                        <li>to = 'Madras' (destination)</li>
                        <li>cruisingrange ≥ distance (cruising range capability)</li>
                      </ul>
                    </li>
                    <li><strong>π<sub>aid</sub>(...)</strong> - Projection operation:Keep only aircraft ID column</li>
                  </ol>
                </div>
                <div style="background: #d1ecf1; padding: 10px; border-radius: 8px; margin-top: 10px;">
                  <strong>Operation order:</strong>First execute inner Cartesian product and Selection, then perform projection
                </div>
              </div>
            `;
            this.clearResultArea();
            break;
          case 2:
            stepInfo.innerHTML = '<strong>Step 2:</strong> Identify Target Flights - Selection operation σ<sub>from=\'Bonn\' ∧ to=\'Madras\'</sub>(Flights)';
            resultExplanation.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 2:Identify Target Flights - Selection operation</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #007bff;">
                    σ<sub>from='Bonn' ∧ to='Madras'</sub>(Flights)
                  </div>
                </div>
                <p>Execute Selection operation on Flights table to find flights from Bonn to Madras</p>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                  <strong>Selection condition:</strong>from = 'Bonn' AND to = 'Madras' <br>
                  <strong>Result:</strong>Found flight F103 with distance of 8500 km<br>
                  <strong>Description:</strong>This step provides target flight constraints for subsequent Cartesian product
                </div>
              </div>
            `;
            this.highlightTargetFlight();
            this.showTargetFlight();
            break;
          case 3:
            stepInfo.innerHTML = '<strong>Step 3:</strong> Cartesian Product operation - Aircraft × Flights';
            resultExplanation.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 3:Cartesian Product operation</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #007bff;">
                    Aircraft × Flights
                  </div>
                </div>
                <p>Perform Cartesian product on Aircraft and Flights tables to generate all possible aircraft-flight combinations</p>
                <div style="background: #fff8e1; padding: 15px; border-radius: 8px;">
                  <strong>operation Result:</strong>6 aircraft × 8 flights = 48 combinations<br>
                  <strong>Purpose:</strong>Associate all possible flights with each aircraft<br>
                  <strong>display:</strong>Here only shows the 6 combinations related to F103
                </div>
                <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Cartesian Product Description:</strong>Generate all tuples of (aid, aname, cruisingrange, flno, from, to, distance)
                </div>
              </div>
            `;
            this.showCartesianProduct();
            break;
          case 4:
            stepInfo.innerHTML = '<strong>Step 4:</strong> Composite Selection condition - σ<sub>from=\'Bonn\' ∧ to=\'Madras\' ∧ cruisingrange≥distance</sub>(Aircraft × Flights)';
            resultExplanation.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 4:Composite Selection condition</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff;">
                    σ<sub>from='Bonn' ∧ to='Madras' ∧ cruisingrange≥distance</sub>(Aircraft × Flights)
                  </div>
                </div>
                <p>Apply Composite Selection condition from Cartesian Product Result to filterrecords that satisfy all requirements</p>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 8px;">
                  <strong>Selection condition breakdown:</strong><br>
                  • <code>from = 'Bonn'</code> - departure point constraint<br>
                  • <code>to = 'Madras'</code> - destination constraint<br>
                  • <code>cruisingrange ≥ distance</code> - cruising range capability constraint (≥8500)
                </div>
                <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Logical operation:</strong>Three conditions must be satisfied simultaneously (∧ conjunction)
                </div>
              </div>
            `;
            this.showSelectionResult();
            break;
          case 5:
            stepInfo.innerHTML = '<strong>Step 5:</strong> Selection Result Detailed Analysis - Verify which aircraft have sufficient cruising range (≥8500km)';
            resultExplanation.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 5:Selection Result Detailed Analysis</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Current Result</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff;">
                    σ<sub>from='Bonn' ∧ to='Madras' ∧ cruisingrange≥distance</sub>(Aircraft × Flights)
                  </div>
                  <div style="margin-top: 10px; color: #28a745; font-weight: bold;">
                    = {(103, Boeing 777, 9500, F103, Bonn, Madras, 8500),<br>
                    &nbsp;&nbsp;&nbsp;(106, Airbus A350, 15000, F103, Bonn, Madras, 8500)}
                  </div>
                </div>
                <p>Evaluate cruising range capability for each aircraft, verify execution result of Selection condition</p>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                  <strong>Range comparison analysis:</strong><br>
                  • <strong>Required distance</strong>:8500km (F103 flight distance)<br>
                  • <strong>meets condition</strong>:Boeing 777 (9500 ≥ 8500) ✅<br>
                  • <strong>meets condition</strong>:Airbus A350 (15000 ≥ 8500) ✅<br>
                  • <strong>not satisfied</strong>:Other 4 aircraft have insufficient range ❌
                </div>
              </div>
            `;
            this.highlightCapableAircraft();
            this.showCapabilityAnalysis();
            break;
          case 6:
            stepInfo.innerHTML = '<strong>Step 6:</strong> Projection operation - π<sub>aid</sub> keeps only aircraft ID column';
            resultExplanation.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 6:Projection operation</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Complete Relational Algebra Expression</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff;">
                    π<sub>aid</sub>(σ<sub>from='Bonn' ∧ to='Madras' ∧ cruisingrange≥distance</sub>(Aircraft × Flights))
                  </div>
                </div>
                <p>Project aircraft ID from Selection Result to get Final Answer</p>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0;">
                  <strong>Projection operation:</strong>π<sub>aid</sub> = Keep only aid column<br>
                  <strong>Final answer:</strong>Aircraft IDs capable of executing flights from Bonn to Madras
                </div>

                <h5 style="color: #495057; margin-top: 30px;">Relational algebra operation order:</h5>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                  <ol style="font-family: 'Times New Roman', serif; font-size: 1.1em;">
                    <li><strong>Cartesian product:</strong> Aircraft × Flights</li>
                    <li><strong>Selection:</strong> σ<sub>from='Bonn' ∧ to='Madras' ∧ cruisingrange≥distance</sub>(...)</li>
                    <li><strong>projection:</strong> π<sub>aid</sub>(...)</li>
                  </ol>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 15px 0;">
                  <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #1976d2;">× (Cartesian product)</h6>
                    <p style="font-size: 0.9em;">All possible combinations</p>
                    <p style="font-size: 0.8em; color: #6c757d;">6×8 = 48 tuples</p>
                  </div>
                  <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #7b1fa2;">σ (Selection)</h6>
                    <p style="font-size: 0.9em;">Composite condition filter</p>
                    <p style="font-size: 0.8em; color: #6c757d;">48 → 2 tuples</p>
                  </div>
                  <div style="background: #fff3cd; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #856404;">π (projection)</h6>
                    <p style="font-size: 0.9em;">Extract aid column</p>
                    <p style="font-size: 0.8em; color: #6c757d;">{103, 106}</p>
                  </div>
                </div>

                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                  <strong>Relational algebra optimization:</strong>In practical execution can be optimized to π<sub>aid</sub>(σ<sub>cruisingrange≥8500</sub>(Aircraft)) ⋈ σ<sub>from='Bonn' ∧ to='Madras'</sub>(Flights)
                </div>
              </div>
            `;
            this.showFinalResult();
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('#content-problem2-2c table td, #content-problem2-2c table tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out', 'capable', 'incapable');
        });
      }

      static clearResultArea() {
        const resultContainer = document.querySelector('#content-problem2-2c #result-table-container-2c');
        if (resultContainer) {
          resultContainer.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #6c757d;">
              <p style="font-size: 1.1em;">Click step buttons to view execution results</p>
              <p style="font-size: 0.9em; margin-top: 10px;">Tip: Use ← → arrow keys for quick navigation</p>
            </div>
          `;
        }
      }

      static highlightTargetFlight() {
        const flightsTable = document.querySelector('#content-problem2-2c #flights-table-2c');
        const rows = flightsTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const fromCell = row.cells[1];
          const toCell = row.cells[2];
          if (fromCell && toCell && fromCell.textContent === 'Bonn' && toCell.textContent === 'Madras') {
            row.classList.add('result-row');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showTargetFlight() {
        const resultContainer = document.querySelector('#content-problem2-2c #result-table-container-2c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">Target Flight</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>flno</th>
                <th>from</th>
                <th>to</th>
                <th>distance</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
            </tbody>
          </table>
        `;
      }

      static showCartesianProduct() {
        const resultContainer = document.querySelector('#content-problem2-2c #result-table-container-2c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #007bff; margin-bottom: 15px;">Cartesian Product Result (Only showing Target Flight combinations)</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>aname</th>
                <th>cruisingrange</th>
                <th>flno</th>
                <th>from</th>
                <th>to</th>
                <th>distance</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>101</td><td>Boeing 747</td><td>8000</td><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
              <tr><td>102</td><td>Airbus A320</td><td>2500</td><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
              <tr><td>103</td><td>Boeing 777</td><td>9500</td><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
              <tr><td>104</td><td>Cessna 172</td><td>800</td><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
              <tr><td>105</td><td>Boeing 737</td><td>2200</td><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
              <tr><td>106</td><td>Airbus A350</td><td>15000</td><td>F103</td><td>Bonn</td><td>Madras</td><td>8500</td></tr>
            </tbody>
          </table>
        `;
      }

      static showSelectionResult() {
        const resultContainer = document.querySelector('#content-problem2-2c #result-table-container-2c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #dc3545; margin-bottom: 15px;">After Applying Selection condition</h5>
            <p style="color: #6c757d; margin-bottom: 15px;">condition:from='Bonn' AND to='Madras' AND cruisingrange ≥ distance</p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>aname</th>
                <th>cruisingrange</th>
                <th>distance</th>
                <th>Capability Assessment</th>
              </tr>
            </thead>
            <tbody>
              <tr class="filtered-out"><td>101</td><td>Boeing 747</td><td>8000</td><td>8500</td><td style="color: #dc3545;">❌ Insufficient</td></tr>
              <tr class="filtered-out"><td>102</td><td>Airbus A320</td><td>2500</td><td>8500</td><td style="color: #dc3545;">❌ Insufficient</td></tr>
              <tr class="result-row"><td>103</td><td>Boeing 777</td><td>9500</td><td>8500</td><td style="color: #28a745;">✅ satisfies</td></tr>
              <tr class="filtered-out"><td>104</td><td>Cessna 172</td><td>800</td><td>8500</td><td style="color: #dc3545;">❌ Insufficient</td></tr>
              <tr class="filtered-out"><td>105</td><td>Boeing 737</td><td>2200</td><td>8500</td><td style="color: #dc3545;">❌ Insufficient</td></tr>
              <tr class="result-row"><td>106</td><td>Airbus A350</td><td>15000</td><td>8500</td><td style="color: #28a745;">✅ satisfies</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Result: Found 2 aircraft capable of executing this flight
          </div>
        `;
      }

      static highlightCapableAircraft() {
        const aircraftTable = document.querySelector('#content-problem2-2c #aircraft-table-2c');
        const rows = aircraftTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const rangeCell = row.cells[2];
          if (rangeCell) {
            const range = parseInt(rangeCell.textContent);
            if (range >= 8500) {
              row.classList.add('capable');
            } else {
              row.classList.add('incapable');
            }
          }
        });
      }

      static showCapabilityAnalysis() {
        const resultContainer = document.querySelector('#content-problem2-2c #result-table-container-2c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #ffc107; margin-bottom: 15px;">Cruising Range Capability Analysis</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>Aircraft Type</th>
                <th>Max Range</th>
                <th>Required distance</th>
                <th>Difference</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr class="incapable"><td>Boeing 747</td><td>8000</td><td>8500</td><td>-500</td><td style="color: #dc3545;">Insufficient</td></tr>
              <tr class="incapable"><td>Airbus A320</td><td>2500</td><td>8500</td><td>-6000</td><td style="color: #dc3545;">Insufficient</td></tr>
              <tr class="capable"><td>Boeing 777</td><td>9500</td><td>8500</td><td>+1000</td><td style="color: #28a745;">satisfies</td></tr>
              <tr class="incapable"><td>Cessna 172</td><td>800</td><td>8500</td><td>-7700</td><td style="color: #dc3545;">Insufficient</td></tr>
              <tr class="incapable"><td>Boeing 737</td><td>2200</td><td>8500</td><td>-6300</td><td style="color: #dc3545;">Insufficient</td></tr>
              <tr class="capable"><td>Airbus A350</td><td>15000</td><td>8500</td><td>+6500</td><td style="color: #28a745;">satisfies</td></tr>
            </tbody>
          </table>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center;">
            <strong>Analysis conclusion:</strong>2 aircraft (Boeing 777 and Airbus A350) can satisfy the 8500 km range requirement
          </div>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem2-2c #result-table-container-2c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">🎯 Final Answer</h5>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>aid</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>103</td></tr>
              <tr class="result-row"><td>106</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Aircraft IDs capable of executing flights from Bonn to Madras:103, 106
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Result Explanation:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>aid=103 (Boeing 777)</strong>:Range 9500 km > Required 8500 km</li>
              <li><strong>aid=106 (Airbus A350)</strong>:Range 15000 km > Required 8500 km</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Cartesian product + Selection condition = Precisely filter aircraft that meet requirements
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }
    }

    // Problem 2d: Relational Division - Find Flights that Every High-Salary Pilot Can Fly
    class Problem2D {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem2-2d .step-controls');

        // Add keyboard event listener
        Problem2D.addKeyboardListener();

        container.innerHTML = `
          <h3 style="color: #495057; margin-bottom: 20px;">Problem 2d: Find aircraft that every high-salary pilot is certified for</h3>

          <!-- Method Selection -->
          <div class="method-selection" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h4 style="color: #495057; margin-bottom: 15px;">Select Solution:</h4>
            <div style="display: flex; gap: 15px; justify-content: center;">
              <button onclick="Problem2D.showMethod('division')" class="method-button active" id="method-division">Relational Algebra Division</button>
              <button onclick="Problem2D.showMethod('difference')" class="method-button" id="method-difference">Set Difference Method</button>
            </div>
          </div>

          <div class="step-navigation" style="margin: 20px 0;" id="step-nav-2d">
            <button onclick="Problem2D.showStep(1)" class="step-button">Step 1</button>
            <button onclick="Problem2D.showStep(2)" class="step-button">Step 2</button>
            <button onclick="Problem2D.showStep(3)" class="step-button">Step 3</button>
            <button onclick="Problem2D.showStep(4)" class="step-button">Step 4</button>
            <button onclick="Problem2D.showStep(5)" class="step-button">Step 5</button>
            <button onclick="Problem2D.showStep(6)" class="step-button">Step 6</button>
            <button onclick="Problem2D.showStep(7)" class="step-button">Step 7</button>
          </div>
          <div id="step-content" style="margin: 30px 0;"></div>
        `;

        const contentArea = document.querySelector('#content-problem2-2d .content-area');
        contentArea.innerHTML = `
          <div class="tables-container" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 30px; margin-top: 30px;">
            <div>
              <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">Employees Table</h4>
              <table id="employees-table-2d" class="data-table">
                <thead>
                  <tr>
                    <th>eid</th>
                    <th>ename</th>
                    <th>salary</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>101</td><td>Alice Johnson</td><td>95000</td></tr>
                  <tr><td>102</td><td>Bob Smith</td><td>82000</td></tr>
                  <tr><td>103</td><td>Carol Davis</td><td>68000</td></tr>
                  <tr><td>104</td><td>David Wilson</td><td>96000</td></tr>
                  <tr><td>105</td><td>Eva Brown</td><td>71000</td></tr>
                  <tr><td>106</td><td>Frank Miller</td><td>91000</td></tr>
                </tbody>
              </table>
            </div>
            <div>
              <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">Certified Table</h4>
              <table id="certified-table-2d" class="data-table">
                <thead>
                  <tr>
                    <th>eid</th>
                    <th>aid</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>101</td><td>747</td></tr>
                  <tr><td>101</td><td>777</td></tr>
                  <tr><td>101</td><td>A320</td></tr>
                  <tr><td>102</td><td>747</td></tr>
                  <tr><td>102</td><td>A320</td></tr>
                  <tr><td>103</td><td>777</td></tr>
                  <tr><td>104</td><td>747</td></tr>
                  <tr><td>104</td><td>777</td></tr>
                  <tr><td>104</td><td>A320</td></tr>
                  <tr><td>105</td><td>A320</td></tr>
                  <tr><td>106</td><td>747</td></tr>
                  <tr><td>106</td><td>777</td></tr>
                </tbody>
              </table>
            </div>
            <div>
              <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">Aircraft Table</h4>
              <table id="aircraft-table-2d" class="data-table">
                <thead>
                  <tr>
                    <th>aid</th>
                    <th>aname</th>
                    <th>type</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>747</td><td>Boeing 747</td><td>Wide-body</td></tr>
                  <tr><td>777</td><td>Boeing 777</td><td>Wide-body</td></tr>
                  <tr><td>A320</td><td>Airbus A320</td><td>Narrow-body</td></tr>
                  <tr><td>737</td><td>Boeing 737</td><td>Narrow-body</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Relational Algebra Expression -->
          <div class="algebra-expression" id="algebra-expression-2d" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center;">
            <h3 style="color: #495057; margin-bottom: 15px;">Relational Algebra Expression</h3>
            <div id="expression-content-2d" style="font-size: 1.5em; font-family: 'Times New Roman', serif; color: #007bff;">
              π<sub>aid</sub>(Certified) ÷ π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees))
            </div>
          </div>

          <!-- Step Controls -->
          <div class="controls">
            <div class="step-indicator" id="step-indicator-2d">
              <!-- Step dots will be generated by JavaScript -->
            </div>
          </div>

          <!-- Step Information -->
          <div class="step-info" id="step-info-2d">
            <strong>Problem Analysis:</strong> Find flights that every high-salary pilot (salary ≥ 90000) can fly. This is a typical application of relational algebra division, requiring finding aircraft "certified by all high-salary pilots".
          </div>

          <div id="result-area" style="margin-top: 40px;">
            <h4 style="text-align: center; color: #495057; margin-bottom: 15px;">executeResult</h4>
            <div id="result-table-container-2d"></div>
          </div>

          <!-- Result Explanation -->
          <div class="result-explanation" id="result-explanation-2d">
            <!-- Dynamic content will be inserted here -->
          </div>
        `;

        // Initialize with division method by default
        AppState.currentMethod = 'division';
        Problem2D.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;
        Problem2D.clearHighlights();

        const stepContent = document.getElementById('step-content');

        // Update step button active state
        document.querySelectorAll('.step-button').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        switch(step) {
          case 1:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 1: Problem Understanding & Relational Algebra Analysis</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Complete Relational Algebra Expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #007bff; line-height: 1.5;">
                    π<sub>aid</sub>(Certified) ÷ π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees))
                  </div>
                </div>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                  <strong>Query Goal:</strong>Find aircraft that every high-salary pilot (salary ≥ 90000) is certified for
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                  <strong>Relational Algebra Division (÷) Understanding:</strong>
                  <ol style="margin: 10px 0;">
                    <li><strong>Dividend</strong>:π<sub>aid</sub>(Certified) - All certified aircraft</li>
                    <li><strong>Divisor</strong>:π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees)) - High-salary pilot set</li>
                    <li><strong>Result</strong>:Aircraft in Dividend that are associated with every element in Divisor</li>
                    <li><strong>Meaning</strong>:Aircraft "Every high-salary pilot is certified for"</li>
                  </ol>
                </div>
                <div style="background: #d1ecf1; padding: 10px; border-radius: 8px; margin-top: 10px;">
                  <strong>Division concept:</strong>A ÷ B = {x | ∀y ∈ B, (x,y) ∈ A}
                </div>
              </div>
            `;
            Problem2D.clearResultArea();
            break;
          case 2:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 2:Identify High-Salary Pilots</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Current relational algebra expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #007bff;">
                    σ<sub>salary≥90000</sub>(Employees)
                  </div>
                </div>
                <p>First select high-salary pilots with salary ≥ 90000 from Employees table</p>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px;">
                  <strong>Selection condition:</strong>salary ≥ 90000 <br>
                  <strong>Operation description:</strong>Horizontal partition, filter high-salary employees<br>
                  <strong>Purpose:</strong>Determine the "Divisor" range in the division operation
                </div>
                <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Next:</strong>Project employee ID from filter result
                </div>
              </div>
            `;
            Problem2D.highlightHighSalaryEmployees();
            Problem2D.showHighSalaryEmployees();
            break;
          case 3:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 3: Construct Divisor - High-Salary Pilot ID Set</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Divisor Construction</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff;">
                    π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees)) = B
                  </div>
                </div>
                <p>Project on high-salary employees to get high-salary pilot ID set (Divisor B)</p>
                <div style="background: #fff8e1; padding: 15px; border-radius: 8px;">
                  <strong>Projection operation:</strong>π<sub>eid</sub> - Keep only employee ID column<br>
                  <strong>Divisor B:</strong>{101, 104, 106} - High-salary pilot ID set<br>
                  <strong>Meaning:</strong>These are the pilots we require to "all be certified for"
                </div>
                <div style="background: #f3e5f5; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Next:</strong>constructDividend - All certified aircraftID
                </div>
              </div>
            `;
            Problem2D.highlightHighSalaryEmployees();
            Problem2D.showDivisor();
            break;
          case 4:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 4: Construct Dividend - Certified Aircraft Set</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Dividendconstruct</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff;">
                    π<sub>aid</sub>(Certified) = A
                  </div>
                </div>
                <p>Project All certified aircraft ID from Certified table to form Dividend A</p>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                  <strong>Projection operation:</strong>π<sub>aid</sub>(Certified) - Extract all aircraft IDs<br>
                  <strong>Dividend A:</strong>All aircraft appearing in certification table<br>
                  <strong>Note:</strong>Here includes all certification records, without deduplication
                </div>
                <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Practical content:</strong>A = {(747), (777), (A320), (747), (A320), ...} - Aircraft portion of all certification relations
                </div>
              </div>
            `;
            Problem2D.highlightCertifiedAircraft();
            Problem2D.showDividend();
            break;
          case 5:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 5:executeRelational Algebra Division</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Division operation</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff;">
                    A ÷ B = π<sub>aid</sub>(Certified) ÷ {101, 104, 106}
                  </div>
                </div>
                <p>Execute Division operation to find aircraft certified for every high-salary pilot</p>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 8px;">
                  <strong>Division logic:</strong>For each aircraft aid, check if there are (eid, aid) records with every eid in Divisor<br>
                  <strong>Check process:</strong><br>
                  • 747: Does it have certification relation with 101, 104, 106?<br>
                  • 777: Does it have certification relation with 101, 104, 106?<br>
                  • A320: Does it have certification relation with 101, 104, 106?
                </div>
                <div style="background: #e8f5e8; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Verification standard:</strong>Only aircraft certified by all high-salary pilots simultaneously will appear in Result
                </div>
              </div>
            `;
            Problem2D.highlightDivisionProcess();
            Problem2D.showDivisionAnalysis();
            break;
          case 6:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 6: Division Result Verification</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Step-by-step verification process</h5>
                  <div style="font-size: 1.1em; font-family: 'Times New Roman', serif; color: #007bff;">
                    Verify if each aircraft is certified by all high-salary pilots
                  </div>
                </div>
                <p>Verify certification relation between each aircraft and high-salary pilots one by one</p>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                  <strong>Verification Result:</strong><br>
                  • <strong>747 (Boeing 747)</strong>: 101✅, 104✅, 106✅ - meets condition<br>
                  • <strong>777 (Boeing 777)</strong>: 101✅, 104✅, 106✅ - meets condition<br>
                  • <strong>A320 (Airbus A320)</strong>: 101✅, 104✅, 106❌ - Does not meet condition
                </div>
                <div style="background: #d4edda; padding: 10px; border-radius: 8px; margin-top: 10px;">
                  <strong>Aircraft that passed verification:</strong>747, 777 - These aircraft are certified by all high-salary pilots
                </div>
              </div>
            `;
            Problem2D.showVerificationProcess();
            break;
          case 7:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #007bff;">Step 7: Final Result and Division Summary</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Complete Relational Algebra Expression</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #007bff; line-height: 1.5;">
                    π<sub>aid</sub>(Certified) ÷ π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees))
                  </div>
                </div>
                <p>Complete execution result of Relational Algebra Division</p>
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0;">
                  <strong>Final answer:</strong>Aircraft IDs that every high-salary pilot is certified for
                </div>

                <h5 style="color: #495057; margin-top: 30px;">Relational Algebra Division Summary:</h5>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                      <h6 style="color: #007bff;">Mathematical definition:</h6>
                      <p style="font-size: 0.9em;">A ÷ B = {t | ∀s ∈ B, (t,s) ∈ A}</p>
                    </div>
                    <div>
                      <h6 style="color: #007bff;">practicalMeaning:</h6>
                      <p style="font-size: 0.9em;">Find elements in A that are associated with every element in B</p>
                    </div>
                  </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 15px 0;">
                  <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #1976d2;">σ (Selection)</h6>
                    <p style="font-size: 0.9em;">Filter high-salary employees</p>
                    <p style="font-size: 0.8em; color: #6c757d;">salary ≥ 90000</p>
                  </div>
                  <div style="background: #fff3cd; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #856404;">π (projection)</h6>
                    <p style="font-size: 0.9em;">Construct operands</p>
                    <p style="font-size: 0.8em; color: #6c757d;">aid, eid sets</p>
                  </div>
                  <div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #721c24;">÷ (Division)</h6>
                    <p style="font-size: 0.9em;">Universal relation</p>
                    <p style="font-size: 0.8em; color: #6c757d;">"All can" pattern</p>
                  </div>
                </div>

                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                  <strong>Practical applications:</strong>Division operation is used in databases to solve "for all..." type queries, such as: finding students who have taken all required courses, customers who have purchased all product categories, etc.
                </div>
              </div>
            `;
            Problem2D.showFinalResult();
            break;
        }
      }

      static showMethod(method) {
        AppState.currentMethod = method;

        // Update method button states
        document.querySelectorAll('.method-button').forEach(btn => {
          btn.classList.remove('active');
        });
        document.getElementById(`method-${method}`).classList.add('active');

        // Update expression based on method
        const expressionContent = document.getElementById('expression-content-2d');
        const stepNav = document.getElementById('step-nav-2d');

        if (method === 'division') {
          expressionContent.innerHTML = 'π<sub>aid</sub>(Certified) ÷ π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees))';
          stepNav.innerHTML = `
            <button onclick="Problem2D.showStep(1)" class="step-button">Step 1</button>
            <button onclick="Problem2D.showStep(2)" class="step-button">Step 2</button>
            <button onclick="Problem2D.showStep(3)" class="step-button">Step 3</button>
            <button onclick="Problem2D.showStep(4)" class="step-button">Step 4</button>
            <button onclick="Problem2D.showStep(5)" class="step-button">Step 5</button>
            <button onclick="Problem2D.showStep(6)" class="step-button">Step 6</button>
            <button onclick="Problem2D.showStep(7)" class="step-button">Step 7</button>
          `;
          Problem2D.showStep(1);
        } else {
          // Set difference method
          expressionContent.innerHTML = 'A - π<sub>aid</sub>((A × B) - π<sub>eid,aid</sub>(Certified ⋈ σ<sub>salary≥90000</sub>(Employees)))';
          stepNav.innerHTML = `
            <button onclick="Problem2D.showDifferenceStep(1)" class="step-button">Step 1</button>
            <button onclick="Problem2D.showDifferenceStep(2)" class="step-button">Step 2</button>
            <button onclick="Problem2D.showDifferenceStep(3)" class="step-button">Step 3</button>
            <button onclick="Problem2D.showDifferenceStep(4)" class="step-button">Step 4</button>
            <button onclick="Problem2D.showDifferenceStep(5)" class="step-button">Step 5</button>
            <button onclick="Problem2D.showDifferenceStep(6)" class="step-button">Step 6</button>
            <button onclick="Problem2D.showDifferenceStep(7)" class="step-button">Step 7</button>
            <button onclick="Problem2D.showDifferenceStep(8)" class="step-button">Step 8</button>
          `;
          Problem2D.showDifferenceStep(1);
        }
      }

      static showDifferenceStep(step) {
        AppState.currentStep = step;
        Problem2D.clearHighlights();

        const stepContent = document.getElementById('step-content');

        // Update step button active state
        document.querySelectorAll('.step-button').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        switch(step) {
          case 1:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 1: Set Difference Method Understanding and Complete Expression</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Complete Relational Algebra Expression</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #dc3545; line-height: 1.8;">
                    <div>A - π<sub>aid</sub>((A × B) - π<sub>eid,aid</sub>(Certified ⋈ σ<sub>salary≥90000</sub>(Employees)))</div>
                    <div style="font-size: 0.8em; color: #6c757d; margin-top: 10px;">
                      Where:A = π<sub>aid</sub>(Aircraft), B = π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees))
                    </div>
                  </div>
                </div>
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 15px 0;">
                  <strong>Set Difference MethodCore Concept:</strong>
                  <ol style="margin: 10px 0;">
                    <li><strong>A</strong>:Complete aircraft set (minuend)</li>
                    <li><strong>A × B</strong>:Ideal certification relation (every high-salary pilot should be certified for every aircraft)</li>
                    <li><strong>Practical certification relation</strong>:Certified ⋈ High-salary pilots</li>
                    <li><strong>Missing certifications</strong>:Ideal - practical</li>
                    <li><strong>Aircraft with missing certifications</strong>:Project aircraft from missing certifications</li>
                    <li><strong>Final Result</strong>: All aircraft - Aircraft with missing certifications</li>
                  </ol>
                </div>
                <div style="background: #fff3cd; padding: 10px; border-radius: 8px;">
                  <strong>Advantages:</strong>Construct ideal status through Cartesian product, then gradually exclude aircraft that do not meet conditions
                </div>
              </div>
            `;
            Problem2D.clearResultArea();
            break;
          case 2:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 2: Construct complete aircraft set A</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.4em; font-family: 'Times New Roman', serif; color: #dc3545;">
                    A = π<sub>aid</sub>(Aircraft)
                  </div>
                </div>
                <p>Project all aircraft IDs from the Aircraft table to form set A (minuend)</p>
                <div style="background: #e2e3e5; padding: 15px; border-radius: 8px;">
                  <strong>Projection operation:</strong>π<sub>aid</sub>(Aircraft) - Extract all aircraft IDs<br>
                  <strong>Result set A:</strong> {747, 777, A320, 737}<br>
                  <strong>Meaning:</strong> All aircraft in the database, serving as the minuend for the final set difference
                </div>
                <div style="background: #d1ecf1; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Next:</strong> Construct high-salary pilot set B
                </div>
              </div>
            `;
            Problem2D.showAllAircraft();
            break;
          case 3:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 3: Construct high-salary pilot set B</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.4em; font-family: 'Times New Roman', serif; color: #dc3545;">
                    B = π<sub>eid</sub>(σ<sub>salary≥90000</sub>(Employees))
                  </div>
                </div>
                <p>First filter high-salary pilots, then project employee IDs to form set B</p>
                <div style="background: #d4edda; padding: 15px; border-radius: 8px;">
                  <strong>Selection operation:</strong> σ<sub>salary≥90000</sub>(Employees) - filter employees with salary ≥ 90000<br>
                  <strong>Projection operation:</strong> π<sub>eid</sub>(...) - extract employee IDs<br>
                  <strong>Result set B:</strong> {101, 104, 106} - High-salary pilot IDs
                </div>
                <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Next:</strong> Construct ideal certification relation A × B
                </div>
              </div>
            `;
            Problem2D.highlightHighSalaryEmployees();
            Problem2D.showHighSalaryEmployeesAsSetB();
            break;
          case 4:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 4: Construct ideal certification relation (Cartesian product)</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.4em; font-family: 'Times New Roman', serif; color: #dc3545;">
                    A × B
                  </div>
                </div>
                <p>Calculate the Cartesian product of aircraft set A and high-salary pilot set B, representing "in the ideal case, every high-salary pilot should be certified for every aircraft"</p>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                  <strong>Cartesian product:</strong>A × B = {747, 777, A320, 737} × {101, 104, 106}<br>
                  <strong>Ideal certification relation:</strong> 12 (eid, aid) pairs<br>
                  <strong>Meaning:</strong> If every high-salary pilot is certified for every aircraft, there should be these 12 certification relations
                </div>
                <div style="background: #f3e5f5; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Next:</strong> Find practically existing high-salary pilot certification relations
                </div>
              </div>
            `;
            Problem2D.showCartesianProduct();
            break;
          case 5:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 5: Find practical high-salary pilot certification relations</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #dc3545;">
                    π<sub>eid,aid</sub>(Certified ⋈ σ<sub>salary≥90000</sub>(Employees))
                  </div>
                </div>
                <p>Join the certification table with high-salary pilots, then project (eid, aid) pairs to obtain practically existing certification relations</p>
                <div style="background: #d1ecf1; padding: 15px; border-radius: 8px;">
                  <strong>Natural join:</strong> Certified ⋈ σ<sub>salary≥90000</sub>(Employees)<br>
                  <strong>Projection operation:</strong> π<sub>eid,aid</sub>(...) - Keep only employee IDs and aircraft IDs<br>
                  <strong>Practical certification relation:</strong> 8 (eid, aid) pairs
                </div>
                <div style="background: #fff3cd; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Observation:</strong> Practically there are only 8 certification relations, 4 fewer than the ideal 12
              </div>
            `;
            Problem2D.showActualCertifications();
            break;
          case 6:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 6: Find missing certification relations</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.2em; font-family: 'Times New Roman', serif; color: #dc3545; line-height: 1.5;">
                    (A × B) - π<sub>eid,aid</sub>(Certified ⋈ σ<sub>salary≥90000</sub>(Employees))
                  </div>
                </div>
                <p>Subtract practical certification relations from ideal certification relations to obtain missing certification relations</p>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px;">
                  <strong>Set difference operation:</strong> 12 ideal relations - 8 practical relations = 4 missing relations<br>
                  <strong>Missing certification relations:</strong><br>
                  • (106, A320) - Frank has no A320 certification<br>
                  • (101, 737), (104, 737), (106, 737) - No one has 737 certification
                </div>
                <div style="background: #f8d7da; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Next:</strong> Extract aircraft IDs from missing relations
                </div>
              </div>
            `;
            Problem2D.showMissingCertifications();
            break;
          case 7:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 7: Extract aircraft with missing certifications</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Relational algebra expression</h5>
                  <div style="font-size: 1.3em; font-family: 'Times New Roman', serif; color: #dc3545;">
                    π<sub>aid</sub>((A × B) - π<sub>eid,aid</sub>(Certified ⋈ σ<sub>salary≥90000</sub>(Employees)))
                  </div>
                </div>
                <p>Project aircraft IDs from missing certification relations to obtain the set of "aircraft with missing certifications"</p>
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px;">
                  <strong>Projection operation:</strong> Extract aid from missing relations<br>
                  <strong>Aircraft with missing certifications:</strong> {A320, 737}<br>
                  <strong>Meaning:</strong> These aircraft have at least one high-salary pilot who cannot be certified for them
                </div>
                <div style="background: #e8f5e8; padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em;">
                  <strong>Final step:</strong> Subtract aircraft with missing certifications from all aircraft
                </div>
              </div>
            `;
            Problem2D.showAircraftWithMissingCerts();
            break;
          case 8:
            stepContent.innerHTML = `
              <div class="step-explanation">
                <h4 style="color: #dc3545;">Step 8: Execute final set difference operation</h4>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                  <h5 style="color: #495057; margin-bottom: 10px;">Complete Relational Algebra Expression</h5>
                  <div style="font-size: 1.1em; font-family: 'Times New Roman', serif; color: #dc3545; line-height: 1.8;">
                    A - π<sub>aid</sub>((A × B) - π<sub>eid,aid</sub>(Certified ⋈ σ<sub>salary≥90000</sub>(Employees)))
                  </div>
                  <div style="font-size: 1.3em; margin-top: 15px; color: #28a745; font-weight: bold;">
                    {747, 777, A320, 737} - {A320, 737} = {747, 777}
                  </div>
                </div>
                <p>Subtract aircraft with missing certifications from complete aircraft set A to obtain the final result</p>
                <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 20px 0;">
                  <strong>Final answer:</strong> The aircraft that every high-salary pilot is certified for are 747 and 777
                </div>

                <h5 style="color: #495057; margin-top: 30px;">Complete Summary of Set Difference Method:</h5>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 15px 0;">
                  <div style="background: #e3f2fd; padding: 12px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #1976d2; margin-bottom: 5px;">Steps 1-2</h6>
                    <p style="font-size: 0.8em;">Sets A, B</p>
                  </div>
                  <div style="background: #fff3cd; padding: 12px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #856404; margin-bottom: 5px;">Steps 3-4</h6>
                    <p style="font-size: 0.8em;">Ideal vs Practical</p>
                  </div>
                  <div style="background: #f8d7da; padding: 12px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #721c24; margin-bottom: 5px;">Steps 5-7</h6>
                    <p style="font-size: 0.8em;">Missing Analysis</p>
                  </div>
                  <div style="background: #d4edda; padding: 12px; border-radius: 8px; text-align: center;">
                    <h6 style="color: #155724; margin-bottom: 5px;">Step 8</h6>
                    <p style="font-size: 0.8em;">Set Difference</p>
                  </div>
                </div>
                <div style="background: #e2e3e5; padding: 15px; border-radius: 8px; margin-top: 15px;">
                  <strong>Method Comparison:</strong> The Set Difference Method constructs an ideal state through the Cartesian product, then progressively excludes through set difference operations to obtain the same result as Relational Algebra Division {747, 777}. Each step has a clear relational algebra expression, demonstrating mathematical rigor.
                </div>
              </div>
            `;
            Problem2D.showFinalDifferenceResultStep8();
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('#content-problem2-2d table td, #content-problem2-2d table tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out', 'high-salary', 'certified-aircraft');
        });
      }

      static clearResultArea() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        if (resultContainer) {
          resultContainer.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #6c757d;">
              <p style="font-size: 1.1em;">Click step buttons to view execution results</p>
              <p style="font-size: 0.9em; margin-top: 10px;">Tip: Use ← → arrow keys for quick navigation</p>
            </div>
          `;
        }
      }

      static highlightHighSalaryEmployees() {
        const employeesTable = document.querySelector('#content-problem2-2d #employees-table-2d');
        const rows = employeesTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const salaryCell = row.cells[2];
          if (salaryCell && parseInt(salaryCell.textContent) >= 90000) {
            row.classList.add('high-salary');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showHighSalaryEmployees() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">High-salary pilotsfilterResult</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>ename</th>
                <th>salary</th>
              </tr>
            </thead>
            <tbody>
              <tr class="high-salary"><td>101</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="high-salary"><td>104</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="high-salary"><td>106</td><td>Frank Miller</td><td>91000</td></tr>
            </tbody>
          </table>
        `;
      }

      static showDivisor() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #007bff; margin-bottom: 15px;">DivisorB - High-salary pilot ID set</h5>
          </div>
          <table class="data-table" style="margin: 0 auto; max-width: 200px;">
            <thead>
              <tr>
                <th>eid</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>101</td></tr>
              <tr class="result-row"><td>104</td></tr>
              <tr class="result-row"><td>106</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #007bff;">
            B = {101, 104, 106}
          </div>
        `;
      }

      static highlightCertifiedAircraft() {
        const certifiedTable = document.querySelector('#content-problem2-2d #certified-table-2d');
        const rows = certifiedTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          row.classList.add('certified-aircraft');
        });
      }

      static showDividend() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #007bff; margin-bottom: 15px;">Dividend A - Certification Relation Projection</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>747</td><td>3 certifications</td></tr>
              <tr class="result-row"><td>777</td><td>3 certifications</td></tr>
              <tr class="result-row"><td>A320</td><td>4 certifications</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #007bff;">
            A = π<sub>aid</sub>(Certified) = All certified aircraft
          </div>
        `;
      }

      static highlightDivisionProcess() {
        Problem2D.highlightHighSalaryEmployees();
        Problem2D.highlightCertifiedAircraft();
      }

      static showDivisionAnalysis() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #dc3545; margin-bottom: 15px;">Division Operation Analysis</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>Aircraft ID</th>
                <th>Certified with 101</th>
                <th>Certified with 104</th>
                <th>Certified with 106</th>
                <th>Division Result</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>747</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">Include</td></tr>
              <tr><td>777</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">Include</td></tr>
              <tr><td>A320</td><td style="color: #28a745;">✅</td><td style="color: #28a745;">✅</td><td style="color: #dc3545;">❌</td><td style="color: #dc3545;">Exclude</td></tr>
            </tbody>
          </table>
        `;
      }

      static showVerificationProcess() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #ffc107; margin-bottom: 15px;">Detailed Verification Process</h5>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div style="background: #d4edda; padding: 15px; border-radius: 8px; text-align: center;">
              <h6 style="color: #155724; margin-bottom: 10px;">Boeing 747</h6>
              <p>Certification records:</p>
              <ul style="list-style: none; padding: 0;">
                <li>(101, 747) ✅</li>
                <li>(104, 747) ✅</li>
                <li>(106, 747) ✅</li>
              </ul>
              <strong style="color: #28a745;">meets condition</strong>
            </div>
            <div style="background: #d4edda; padding: 15px; border-radius: 8px; text-align: center;">
              <h6 style="color: #155724; margin-bottom: 10px;">Boeing 777</h6>
              <p>Certification records:</p>
              <ul style="list-style: none; padding: 0;">
                <li>(101, 777) ✅</li>
                <li>(104, 777) ✅</li>
                <li>(106, 777) ✅</li>
              </ul>
              <strong style="color: #28a745;">meets condition</strong>
            </div>
            <div style="background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center;">
              <h6 style="color: #721c24; margin-bottom: 10px;">Airbus A320</h6>
              <p>Certification records:</p>
              <ul style="list-style: none; padding: 0;">
                <li>(101, A320) ✅</li>
                <li>(104, A320) ✅</li>
                <li>(106, A320) ❌</li>
              </ul>
              <strong style="color: #dc3545;">Does not meet condition</strong>
            </div>
          </div>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">🎯 Final Answer</h5>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Aircraft Name</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>747</td><td>Boeing 747</td><td>Wide-body</td></tr>
              <tr class="result-row"><td>777</td><td>Boeing 777</td><td>Wide-body</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Aircraft that every high-salary pilot is certified for: 747, 777
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Division operationResult Explanation:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Boeing 747, 777</strong>: Certified by all high-salary pilots (101, 104, 106)</li>
              <li><strong>Airbus A320</strong>: Not certified by employee 106, therefore excluded</li>
              <li><strong>Boeing 737</strong>: No certification records, not in consideration</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Relational Algebra Division finds "Universal relation" = the part in the Dividend that is associated with every element of the Divisor
            </p>
          </div>
        `;
      }

      // New methods for set difference approach
      static showAllAircraft() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #6c757d; margin-bottom: 15px;">Complete Aircraft Set (Minuend)</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Aircraft Name</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlighted"><td>747</td><td>Boeing 747</td><td>Wide-body</td></tr>
              <tr class="highlighted"><td>777</td><td>Boeing 777</td><td>Wide-body</td></tr>
              <tr class="highlighted"><td>A320</td><td>Airbus A320</td><td>Narrow-body</td></tr>
              <tr class="highlighted"><td>737</td><td>Boeing 737</td><td>Narrow-body</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #6c757d;">
            Complete set = {747, 777, A320, 737}
          </div>
        `;
      }

      static showHighSalaryEmployeesAsSetB() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #007bff; margin-bottom: 15px;">Set B - High-Salary Pilot ID Set</h5>
          </div>
          <table class="data-table" style="margin: 0 auto; max-width: 200px;">
            <thead>
              <tr>
                <th>eid</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>101</td></tr>
              <tr class="result-row"><td>104</td></tr>
              <tr class="result-row"><td>106</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #007bff;">
            B = {101, 104, 106}
          </div>
          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px; color: #1976d2;">
            <strong>Set construction complete:</strong> A and B represent all aircraft and high-salary pilots respectively
          </div>
        `;
      }

      static showCartesianProduct() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #6f42c1; margin-bottom: 15px;">Ideal Certification Relation: A × B</h5>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 1.2em; margin-bottom: 10px;">
              {747, 777, A320, 737} × {101, 104, 106} = 12 (eid, aid) pairs
            </div>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>aid</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlighted"><td>101</td><td>747</td><td>Aliceshould be certified for747</td></tr>
              <tr class="highlighted"><td>101</td><td>777</td><td>Aliceshould be certified for777</td></tr>
              <tr class="highlighted"><td>101</td><td>A320</td><td>Aliceshould be certified forA320</td></tr>
              <tr class="highlighted"><td>101</td><td>737</td><td>Aliceshould be certified for737</td></tr>
              <tr class="highlighted"><td>104</td><td>747</td><td>Davidshould be certified for747</td></tr>
              <tr class="highlighted"><td>104</td><td>777</td><td>Davidshould be certified for777</td></tr>
              <tr class="highlighted"><td>104</td><td>A320</td><td>Davidshould be certified forA320</td></tr>
              <tr class="highlighted"><td>104</td><td>737</td><td>Davidshould be certified for737</td></tr>
              <tr class="highlighted"><td>106</td><td>747</td><td>Frankshould be certified for747</td></tr>
              <tr class="highlighted"><td>106</td><td>777</td><td>Frankshould be certified for777</td></tr>
              <tr class="highlighted"><td>106</td><td>A320</td><td>Frankshould be certified forA320</td></tr>
              <tr class="highlighted"><td>106</td><td>737</td><td>Frankshould be certified for737</td></tr>
            </tbody>
          </table>
          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px; color: #1976d2;">
            <strong>Ideal state:</strong> If every high-salary pilot is certified for every aircraft, there should be these 12 certification relations
          </div>
        `;
      }

      static showActualCertifications() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #17a2b8; margin-bottom: 15px;">Practical High-Salary Pilot Certification Relations</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>aid</th>
                <th>ename</th>
                <th>salary</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlighted"><td>101</td><td>747</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="highlighted"><td>101</td><td>777</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="highlighted"><td>101</td><td>A320</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="highlighted"><td>104</td><td>747</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="highlighted"><td>104</td><td>777</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="highlighted"><td>104</td><td>A320</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="highlighted"><td>106</td><td>747</td><td>Frank Miller</td><td>91000</td></tr>
              <tr class="highlighted"><td>106</td><td>777</td><td>Frank Miller</td><td>91000</td></tr>
            </tbody>
          </table>
          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px; color: #856404;">
            <strong>Practical situation:</strong> Only 8 certification relations, 4 fewer than the ideal 12
          </div>
        `;
      }

      static showMissingCertifications() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #dc3545; margin-bottom: 15px;">Missing Certification Relations</h5>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 1.2em; margin-bottom: 10px;">
              Ideal (12) - Practical (8) = <strong style="color: #dc3545;">Missing (4)</strong>
            </div>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>aid</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="error-highlight"><td>101</td><td>737</td><td>Alicedoes not have737certification</td></tr>
              <tr class="error-highlight"><td>104</td><td>737</td><td>Daviddoes not have737certification</td></tr>
              <tr class="error-highlight"><td>106</td><td>A320</td><td>Frankdoes not haveA320certification</td></tr>
              <tr class="error-highlight"><td>106</td><td>737</td><td>Frankdoes not have737certification</td></tr>
            </tbody>
          </table>
          <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-top: 15px; color: #721c24;">
            <strong>Missing analysis:</strong> These 4 missing certification relations describe that certain aircraft cannot be certified for by all high-salary pilots
          </div>
        `;
      }

      static showAircraftWithMissingCerts() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #dc3545; margin-bottom: 15px;">Aircraft with Missing Certifications</h5>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 1.2em; margin-bottom: 10px;">
              Extract aid from missing relations → <strong style="color: #dc3545;">{A320, 737}</strong>
            </div>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Aircraft Name</th>
                <th>Missing Certification Situation</th>
              </tr>
            </thead>
            <tbody>
              <tr class="error-highlight"><td>A320</td><td>Airbus A320</td><td>Frank(106)cannot be certified for</td></tr>
              <tr class="error-highlight"><td>737</td><td>Boeing 737</td><td>all high-salary pilotscannot be certified for</td></tr>
            </tbody>
          </table>
          <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-top: 15px; color: #721c24;">
            <strong>Conclusion:</strong> A320 and 737 have at least one high-salary pilot who cannot be certified for them, need to be excluded from the complete set
          </div>
        `;
      }

      static showFinalDifferenceResultStep8() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">🎯 Set Difference MethodFinal Result</h5>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 1.4em; margin-bottom: 15px;">
              <span style="color: #6c757d; font-weight: bold;">A</span>
              <span style="font-size: 1.2em; margin: 0 10px;">-</span>
              <span style="color: #dc3545; font-weight: bold;">π<sub>aid</sub>((A × B) - practical certification)</span>
            </div>
            <div style="font-size: 1.5em; color: #28a745; font-weight: bold; margin-top: 20px;">
              {747, 777, A320, 737} - {A320, 737} = {747, 777}
            </div>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Aircraft Name</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>747</td><td>Boeing 747</td><td>Wide-body</td></tr>
              <tr class="result-row"><td>777</td><td>Boeing 777</td><td>Wide-body</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Aircraft that every high-salary pilot is certified for: 747, 777
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Complete derivation verification:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li>✅ <strong>747and777</strong>:certified by all high-salary pilots(101,104,106)certification</li>
              <li>❌ <strong>A320</strong>:missing 106's certification, excluded</li>
              <li>❌ <strong>737</strong>:does not have any High-salary pilots certification, excluded</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              The Set Difference Method strictly follows the relational algebra expression step by step to calculate, the result is completely correct!
            </p>
          </div>
        `;
      }

      static showHighSalaryCertifications() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #17a2b8; margin-bottom: 15px;">High-Salary Pilot Certification Records</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>aid</th>
                <th>ename</th>
                <th>salary</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlighted"><td>101</td><td>747</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="highlighted"><td>101</td><td>777</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="highlighted"><td>101</td><td>A320</td><td>Alice Johnson</td><td>95000</td></tr>
              <tr class="highlighted"><td>104</td><td>747</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="highlighted"><td>104</td><td>777</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="highlighted"><td>104</td><td>A320</td><td>David Wilson</td><td>96000</td></tr>
              <tr class="highlighted"><td>106</td><td>747</td><td>Frank Miller</td><td>91000</td></tr>
              <tr class="highlighted"><td>106</td><td>777</td><td>Frank Miller</td><td>91000</td></tr>
            </tbody>
          </table>
          <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin-top: 15px; color: #0c5460;">
            <strong>Observation:</strong>Note that106(Frank) does not have A320 certification records, this will be used for subsequent analysis
          </div>
        `;
      }

      static showUnqualifiedAircraft() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #dc3545; margin-bottom: 15px;">Aircraft that Do Not Meet the Condition (Subtrahend)</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Aircraft Name</th>
                <th>High-Salary Pilots Who Cannot Be Certified</th>
                <th>Reason</th>
              </tr>
            </thead>
            <tbody>
              <tr class="error-highlight"><td>A320</td><td>Airbus A320</td><td>106(Frank)</td><td>no certification records</td></tr>
              <tr class="error-highlight"><td>737</td><td>Boeing 737</td><td>101,104,106(all)</td><td>no certifications</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #dc3545;">
            Exclusion set = {A320, 737}
          </div>
          <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-top: 15px; color: #721c24;">
            <strong>Exclusion logic:</strong> As long as there is one high-salary pilot who cannot be certified, the aircraft is excluded
          </div>
        `;
      }

      static showFinalDifferenceResult() {
        const resultContainer = document.querySelector('#content-problem2-2d #result-table-container-2d');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">🎯 Set Difference MethodFinal Answer</h5>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 1.3em; margin-bottom: 15px;">
              <span style="color: #6c757d; font-weight: bold;">{747, 777, A320, 737}</span>
              <span style="font-size: 1.5em; margin: 0 15px;">-</span>
              <span style="color: #dc3545; font-weight: bold;">{A320, 737}</span>
              <span style="font-size: 1.5em; margin: 0 15px;">=</span>
              <span style="color: #28a745; font-weight: bold; font-size: 1.2em;">{747, 777}</span>
            </div>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>aid</th>
                <th>Aircraft Name</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>747</td><td>Boeing 747</td><td>Wide-body</td></tr>
              <tr class="result-row"><td>777</td><td>Boeing 777</td><td>Wide-body</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Aircraft that every high-salary pilot is certified for: 747, 777
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Set Difference MethodResult Explanation:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>747 and 777</strong>: In the complete set, and not in the exclusion set ✅</li>
              <li><strong>A320</strong>: In the complete set, but also in the exclusion set ❌</li>
              <li><strong>737</strong>: In the complete set, but also in the exclusion set ❌</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              The Set Difference Method obtains the same result as Relational Algebra Division through "reverse thinking"
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem2D.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem2D.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem2D.showStep(Math.min(6, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem2D.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem2D.keyboardHandler) {
          document.removeEventListener('keydown', Problem2D.keyboardHandler);
          Problem2D.keyboardHandler = null;
        }
      }
    }

    // Problem 2e: Set Difference - Find Names of Pilots for Long-Range Planes BUT NOT Boeing
    class Problem2E {
      static init() {
        this.currentStep = 0;
        this.maxSteps = 6;

        this.bindEvents();
        this.addKeyboardListener();
        this.updateStepIndicator();
        this.showStep(0);
        this.updateButtons();
      }

      static bindEvents() {
        document.getElementById('prev-btn-2e').addEventListener('click', () => this.previousStep());
        document.getElementById('next-btn-2e').addEventListener('click', () => this.nextStep());
        document.getElementById('reset-btn-2e').addEventListener('click', () => this.reset());
      }

      static addKeyboardListener() {
        this.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            console.log('Problem2E ArrowLeft pressed');
            this.previousStep();
          } else if (e.key === 'ArrowRight') {
            console.log('Problem2E ArrowRight pressed');
            this.nextStep();
          }
        };
        document.addEventListener('keydown', this.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (this.keyboardHandler) {
          document.removeEventListener('keydown', this.keyboardHandler);
          this.keyboardHandler = null;
        }
      }

      static nextStep() {
        console.log('Problem2E nextStep called, currentStep:', this.currentStep, 'maxSteps:', this.maxSteps);
        if (this.currentStep < this.maxSteps) {
          this.currentStep++;
          console.log('Problem2E moving to step:', this.currentStep);
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        } else {
          console.log('Problem2E already at max step');
        }
      }

      static previousStep() {
        console.log('Problem2E previousStep called, currentStep:', this.currentStep);
        if (this.currentStep > 0) {
          this.currentStep--;
          console.log('Problem2E moving to step:', this.currentStep);
          this.showStep(this.currentStep);
          this.updateButtons();
          this.updateStepIndicator();
        }
      }

      static reset() {
        this.currentStep = 0;
        this.showStep(0);
        this.updateButtons();
        this.updateStepIndicator();
        this.clearHighlights();
      }

      static updateButtons() {
        document.getElementById('prev-btn-2e').disabled = this.currentStep === 0;
        document.getElementById('next-btn-2e').disabled = this.currentStep >= this.maxSteps;
      }

      static updateStepIndicator() {
        const indicator = document.getElementById('step-indicator-2e');
        let html = '';
        for (let i = 0; i <= this.maxSteps; i++) {
          let className = 'step-dot';
          if (i === this.currentStep) className += ' active';
          else if (i < this.currentStep) className += ' completed';
          html += `<div class="${className}"></div>`;
        }
        indicator.innerHTML = html;
      }

      static showStep(step) {
        this.clearHighlights();

        const stepInfo = document.getElementById('step-info-2e');
        const intermediateResults = document.getElementById('intermediate-results-2e');
        const resultExplanation = document.getElementById('result-explanation-2e');

        switch(step) {
          case 0:
            stepInfo.innerHTML = '<strong>Step 0:</strong> Initial status - Three tables showing employees, certifications, and aircraft. Goal: Find pilots who can fly long-range aircraft but NOT Boeing aircraft.';
            intermediateResults.innerHTML = '';
            resultExplanation.innerHTML = '';
            break;

          case 1:
            stepInfo.innerHTML = '<strong>Step 1:</strong> Filter long-range aircraft (cruisingrange > 3000) and find certified pilots.';
            intermediateResults.innerHTML = `
              <h4>Find Long-Range Aircraft Pilots</h4>
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>π<sub>eid</sub>(σ<sub>cruisingrange>3000</sub>(Aircraft) ⋈ Certified)</strong>
              </div>
            `;
            try {
              this.highlightLongRangeAircraft();
              this.showLongRangePilots();
            } catch(e) {
              console.error('Error in step 1:', e);
            }
            break;

          case 2:
            stepInfo.innerHTML = '<strong>Step 2:</strong> Filter Boeing aircraft and find certified pilots.';
            intermediateResults.innerHTML = `
              <h4>Find Boeing Aircraft Pilots</h4>
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>π<sub>eid</sub>(σ<sub>aname LIKE 'Boeing%'</sub>(Aircraft) ⋈ Certified)</strong>
              </div>
            `;
            try {
              this.highlightBoeingAircraft();
              this.showBoeingPilots();
            } catch(e) {
              console.error('Error in step 2:', e);
            }
            break;
          case 3:
            stepInfo.innerHTML = '<strong>Step 3:</strong> Perform set difference operation - subtract Boeing pilots from long-range pilots.';
            intermediateResults.innerHTML = `
              <h4>Set Difference Result</h4>
              <p>Long-range pilots {101, 102, 103, 104, 105, 106} - Boeing pilots {101, 102, 104, 106} = {103, 105}</p>
            `;
            try {
              this.showSetDifferenceProcess();
            } catch(e) {
              console.error('Error in step 3:', e);
            }
            break;

          case 4:
            stepInfo.innerHTML = '<strong>Step 4:</strong> Join with Employees table to get pilot details.';
            intermediateResults.innerHTML = `
              <h4>Join with Employees</h4>
              <p>Result: Carol Davis (103), Eva Brown (105)</p>
            `;
            try {
              this.showPilotDetails();
            } catch(e) {
              console.error('Error in step 4:', e);
            }
            break;

          case 5:
            stepInfo.innerHTML = '<strong>Step 5:</strong> Project pilot names (π<sub>ename</sub>).';
            intermediateResults.innerHTML = `
              <h4>Final Projection</h4>
            `;
            try {
              this.showFinalResult();
            } catch(e) {
              console.error('Error in step 5:', e);
            }
            break;

          case 6:
            stepInfo.innerHTML = '<strong>Complete:</strong> Set difference method successfully found pilots for long-range but non-Boeing aircraft.';
            resultExplanation.innerHTML = `
              <h4>Final Result</h4>
              <div style="background: #d4edda; padding: 15px; border-radius: 8px;">
                <strong>Pilots who can fly long-range aircraft but NOT Boeing:</strong>
                <ul>
                  <li>Carol Davis</li>
                  <li>Eva Brown</li>
                </ul>
              </div>
            `;
            try {
              this.showFinalResult();
            } catch(e) {
              console.error('Error in step 6:', e);
            }
            break;
        }
      }

      static clearHighlights() {
        document.querySelectorAll('#content-problem2-2e table td, #content-problem2-2e table tr').forEach(el => {
          el.classList.remove('highlighted', 'result-row', 'filtered-out', 'long-range', 'boeing-aircraft');
        });
      }

      static clearResultArea() {
        const resultContainer = document.querySelector('#content-problem2-2e #result-table-container-2e');
        if (resultContainer) {
          resultContainer.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #6c757d;">
              <p style="font-size: 1.1em;">Click step buttons to view execution results</p>
              <p style="font-size: 0.9em; margin-top: 10px;">Tip: Use ← → arrow keys for quick navigation</p>
            </div>
          `;
        }
      }

      static highlightLongRangeAircraft() {
        const aircraftTable = document.querySelector('#content-problem2-2e #aircraft-table-2e');
        const rows = aircraftTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const rangeCell = row.cells[2];
          if (rangeCell && parseInt(rangeCell.textContent) > 3000) {
            row.classList.add('long-range');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showLongRangePilots() {
        const resultContainer = document.querySelector('#content-problem2-2e #result-table-container-2e');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">long-range aircraftPilot ID Set</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>Can be certified forlong-range aircraft</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlighted"><td>101</td><td>747, 777, A320</td></tr>
              <tr class="highlighted"><td>102</td><td>747, A320</td></tr>
              <tr class="highlighted"><td>103</td><td>777</td></tr>
              <tr class="highlighted"><td>104</td><td>747, 777, A320</td></tr>
              <tr class="highlighted"><td>105</td><td>A320</td></tr>
              <tr class="highlighted"><td>106</td><td>747, 777</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #28a745;">
            long-range aircraftPilot setA = {101, 102, 103, 104, 105, 106}
          </div>
        `;
      }

      static highlightBoeingAircraft() {
        const aircraftTable = document.querySelector('#content-problem2-2e #aircraft-table-2e');
        const rows = aircraftTable.querySelectorAll('tbody tr');
        rows.forEach(row => {
          const nameCell = row.cells[1];
          if (nameCell && nameCell.textContent.includes('Boeing')) {
            row.classList.add('boeing-aircraft');
          } else {
            row.classList.add('filtered-out');
          }
        });
      }

      static showBoeingPilots() {
        const resultContainer = document.querySelector('#content-problem2-2e #result-table-container-2e');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #dc3545; margin-bottom: 15px;">Boeing aircraftPilot ID Set</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>Can be certified forBoeing aircraft</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlighted"><td>101</td><td>747, 777</td></tr>
              <tr class="highlighted"><td>102</td><td>747</td></tr>
              <tr class="highlighted"><td>104</td><td>747, 777</td></tr>
              <tr class="highlighted"><td>106</td><td>747, 777</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; font-weight: bold; color: #dc3545;">
            Boeing aircraftPilot setB = {101, 102, 104, 106}
          </div>
        `;
      }

      static showSetDifferenceProcess() {
        const resultContainer = document.querySelector('#content-problem2-2e #result-table-container-2e');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #6f42c1; margin-bottom: 15px;">Set difference operation process</h5>
          </div>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <div style="font-size: 1.3em; margin-bottom: 15px;">
              <span style="color: #28a745; font-weight: bold;">{101, 102, 103, 104, 105, 106}</span>
              <span style="font-size: 1.5em; margin: 0 15px;">-</span>
              <span style="color: #dc3545; font-weight: bold;">{101, 102, 104, 106}</span>
              <span style="font-size: 1.5em; margin: 0 15px;">=</span>
              <span style="color: #6f42c1; font-weight: bold; font-size: 1.2em;">{103, 105}</span>
            </div>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>Whether certified forlong-range aircraft</th>
                <th>Whether certified forBoeing aircraft</th>
                <th>Result</th>
              </tr>
            </thead>
            <tbody>
              <tr class="filtered-out"><td>101</td><td>✅ (747,777,A320)</td><td>✅ (747,777)</td><td>❌ excluded</td></tr>
              <tr class="filtered-out"><td>102</td><td>✅ (747,A320)</td><td>✅ (747)</td><td>❌ excluded</td></tr>
              <tr class="result-row"><td>103</td><td>✅ (777)</td><td>❌</td><td>✅ Keep</td></tr>
              <tr class="filtered-out"><td>104</td><td>✅ (747,777,A320)</td><td>✅ (747,777)</td><td>❌ excluded</td></tr>
              <tr class="result-row"><td>105</td><td>✅ (A320)</td><td>❌</td><td>✅ Keep</td></tr>
              <tr class="filtered-out"><td>106</td><td>✅ (747,777)</td><td>✅ (747,777)</td><td>❌ excluded</td></tr>
            </tbody>
          </table>
        `;
      }

      static showPilotDetails() {
        const resultContainer = document.querySelector('#content-problem2-2e #result-table-container-2e');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #17a2b8; margin-bottom: 15px;">Pilot Detailed Information</h5>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>eid</th>
                <th>ename</th>
                <th>salary</th>
                <th>certified for long-range aircraft</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>103</td><td>Carol Davis</td><td>68000</td><td>777 (Boeing 777, but does not count as Boeing certified pilot)</td></tr>
              <tr class="result-row"><td>105</td><td>Eva Brown</td><td>71000</td><td>A320 (Airbus A320)</td></tr>
            </tbody>
          </table>
          <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin-top: 15px; color: #0c5460;">
            <strong>Note:</strong>103Although certified for 777 (Boeing aircraft), but does not have certification for other Boeing aircraft, therefore not in"Boeing aircraftPilot"set
          </div>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem2-2e #result-table-container-2e');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h5 style="color: #28a745; margin-bottom: 15px;">🎯 Final Answer</h5>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>ename</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Carol Davis</td></tr>
              <tr class="result-row"><td>Eva Brown</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Pilots who can be certified for long-range but non-Boeing aircraft:Carol Davis, Eva Brown
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Result verification:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Carol Davis (103)</strong>:certified for 777 (9000km long-range), but 777 is her only Boeing aircraft</li>
              <li><strong>Eva Brown (105)</strong>:Only certified forA320(3200kmLong-range, Airbusmanufactured)</li>
              <li><strong>excluded Pilots</strong>:Alice, Bob, David, Frankall certified for multiple Boeing aircraft</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Set difference operationSuccessfully identified"meets condition A but does not meet condition B"target group
            </p>
          </div>
        `;
      }
    }

    // Problem 3A(i): Correlated Relational Division
    class Problem3AI {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem3-3a-i .step-controls');

        // Add keyboard event listener
        Problem3AI.addKeyboardListener();

        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem3AI.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem3AI.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem3AI.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem3AI.showStep(4)">Step4</button>
            <button class="step-btn" onclick="Problem3AI.showStep(5)">Step5</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
          </div>
          <div class="step-description">
            Correlated relational division:Find students who took all courses in their major
          </div>
        `;

        const contentArea = document.querySelector('#content-problem3-3a-i .content-area');

        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 3A(i): Correlated relational division</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Find students who have takenbooksall courses in their major<br>
              <strong>Key point:</strong>Each student only needs to take courses in their own major, reflects the "relevance" constraint
            </p>
          </div>

          <div class="schema-info">
            <h4>📋 Table Structure</h4>
            <div class="schema-grid">
              <div class="schema-table">
                <h5>Student (Student Table)</h5>
                <ul>
                  <li><strong>sid</strong> - Student ID</li>
                  <li><strong>sname</strong> - Student Name</li>
                  <li><strong>major</strong> - Major ID</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Faculty (Faculty Table)</h5>
                <ul>
                  <li><strong>deptid</strong> - Department ID</li>
                  <li><strong>dname</strong> - Department Name</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Class (Course Table)</h5>
                <ul>
                  <li><strong>cname</strong> - Course Name</li>
                  <li><strong>deptid</strong> - Department that offers the course ID</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Enrolled (Enrollment Table)</h5>
                <ul>
                  <li><strong>sid</strong> - Student ID</li>
                  <li><strong>cname</strong> - Course Name</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Sample Data Tables -->
          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <div class="data-tables-grid">
              <div class="data-table-wrapper">
                <h5>Student Student Table</h5>
                <table class="data-table" id="student-table-3a">
                  <thead>
                    <tr><th>sid</th><th>sname</th><th>major</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>1001</td><td>Zhang San</td><td>CS</td></tr>
                    <tr><td>1002</td><td>Li Si</td><td>CS</td></tr>
                    <tr><td>1003</td><td>Wang Wu</td><td>Math</td></tr>
                    <tr><td>1004</td><td>Zhao Liu</td><td>Math</td></tr>
                    <tr><td>1005</td><td>Chen Qi</td><td>Physics</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Faculty Faculty Table</h5>
                <table class="data-table" id="faculty-table-3a">
                  <thead>
                    <tr><th>deptid</th><th>dname</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>CS</td><td>Computer Science</td></tr>
                    <tr><td>Math</td><td>Mathematics</td></tr>
                    <tr><td>Physics</td><td>Physics</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Class Course Table</h5>
                <table class="data-table" id="class-table-3a">
                  <thead>
                    <tr><th>cname</th><th>deptid</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Data Structures</td><td>CS</td></tr>
                    <tr><td>Algorithm Analysis</td><td>CS</td></tr>
                    <tr><td>Database Systems</td><td>CS</td></tr>
                    <tr><td>Advanced Mathematics</td><td>Math</td></tr>
                    <tr><td>Linear Algebra</td><td>Math</td></tr>
                    <tr><td>General Physics</td><td>Physics</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Enrolled Enrollment Table</h5>
                <table class="data-table" id="enrolled-table-3a">
                  <thead>
                    <tr><th>sid</th><th>cname</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>1001</td><td>Data Structures</td></tr>
                    <tr><td>1001</td><td>Algorithm Analysis</td></tr>
                    <tr><td>1001</td><td>Database Systems</td></tr>
                    <tr><td>1002</td><td>Data Structures</td></tr>
                    <tr><td>1002</td><td>Algorithm Analysis</td></tr>
                    <tr><td>1003</td><td>Advanced Mathematics</td></tr>
                    <tr><td>1003</td><td>Linear Algebra</td></tr>
                    <tr><td>1004</td><td>Advanced Mathematics</td></tr>
                    <tr><td>1005</td><td>General Physics</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="result-table-container-3a">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;

        Problem3AI.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;

        // Update step indicators
        document.querySelectorAll('#content-problem3-3a-i .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        document.querySelector('#content-problem3-3a-i .current-step').textContent = step;

        // Clear previous highlights
        document.querySelectorAll('#content-problem3-3a-i table td, #content-problem3-3a-i table tr').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });

        const resultContainer = document.querySelector('#content-problem3-3a-i #result-table-container-3a');

        switch(step) {
          case 1: Problem3AI.showRequiredPairs(); break;
          case 2: Problem3AI.showEnrolledStudents(); break;
          case 3: Problem3AI.showMissingPairs(); break;
          case 4: Problem3AI.showStudentsWithMissing(); break;
          case 5: Problem3AI.showFinalResult(); break;
        }
      }

      static showRequiredPairs() {
        const resultContainer = document.querySelector('#content-problem3-3a-i #result-table-container-3a');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 1: Construct required course pairs for each student (RequiredPairs)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">RequiredPairs ← π<sub>sid,cname</sub>((Student ⋈<sub>major=deptid</sub> Faculty) ⋈ Class)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Join Student, Faculty, and Class tables, generate all courses for each student's major (sid, cname)pairs
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>cname</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>1001</td><td>Data Structures</td><td>CS major student 1001 required CS courses</td></tr>
              <tr class="highlight-step1"><td>1001</td><td>Algorithm Analysis</td><td>CS major student 1001 required CS courses</td></tr>
              <tr class="highlight-step1"><td>1001</td><td>Database Systems</td><td>CS major student 1001 required CS courses</td></tr>
              <tr class="highlight-step1"><td>1002</td><td>Data Structures</td><td>CS major student 1002 required CS courses</td></tr>
              <tr class="highlight-step1"><td>1002</td><td>Algorithm Analysis</td><td>CS major student 1002 required CS courses</td></tr>
              <tr class="highlight-step1"><td>1002</td><td>Database Systems</td><td>CS major student 1002 required CS courses</td></tr>
              <tr class="highlight-step1"><td>1003</td><td>Advanced Mathematics</td><td>Math major student 1003 required Math courses</td></tr>
              <tr class="highlight-step1"><td>1003</td><td>Linear Algebra</td><td>Math major student 1003 required Math courses</td></tr>
              <tr class="highlight-step1"><td>1004</td><td>Advanced Mathematics</td><td>Math major student 1004 required Math courses</td></tr>
              <tr class="highlight-step1"><td>1004</td><td>Linear Algebra</td><td>Math major student 1004 required Math courses</td></tr>
              <tr class="highlight-step1"><td>1005</td><td>General Physics</td><td>Physics major student 1005 required Physics courses</td></tr>
            </tbody>
          </table>
        `;
      }

      static showEnrolledStudents() {
        const resultContainer = document.querySelector('#content-problem3-3a-i #result-table-container-3a');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 2: Get all Student ID Set</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">AllStudents ← π<sub>sid</sub>(Student)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Project all Student IDs from Student table as candidate result set
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step2"><td>1001</td></tr>
              <tr class="highlight-step2"><td>1002</td></tr>
              <tr class="highlight-step2"><td>1003</td></tr>
              <tr class="highlight-step2"><td>1004</td></tr>
              <tr class="highlight-step2"><td>1005</td></tr>
            </tbody>
          </table>
        `;
      }

      static showMissingPairs() {
        const resultContainer = document.querySelector('#content-problem3-3a-i #result-table-container-3a');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 3: Find missing student-course pairs (MissingPairs)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">MissingPairs ← RequiredPairs - Enrolled</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Use set difference operation to find "should take but not taken" course pairs
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>cname</th>
                <th>Missing Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-missing"><td>1002</td><td>Database Systems</td><td>Li Si did not takeDatabase Systems</td></tr>
              <tr class="highlight-missing"><td>1004</td><td>Linear Algebra</td><td>Zhao Liu did not takeLinear Algebra</td></tr>
            </tbody>
          </table>
          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; color: #856404;">
            <strong>Analysis:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>1001(Zhang San)</strong>:Took all CS courses, no missing courses</li>
              <li><strong>1002(Li Si)</strong>:missingDatabase Systems</li>
              <li><strong>1003(Wang Wu)</strong>:Took all Math courses, no missing courses</li>
              <li><strong>1004(Zhao Liu)</strong>:missingLinear Algebra</li>
              <li><strong>1005(Chen Qi)</strong>:Took all Physics courses, no missing courses</li>
            </ul>
          </div>
        `;
      }

      static showStudentsWithMissing() {
        const resultContainer = document.querySelector('#content-problem3-3a-i #result-table-container-3a');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 4: Find students with missing courses (StudentsWithMissing)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">StudentsWithMissing ← π<sub>sid</sub>(MissingPairs)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Project all Student IDs with missing courses from missing pairs
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>Student Name</th>
                <th>Missing Status</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-missing"><td>1002</td><td>Li Si</td><td>missingDatabase Systems</td></tr>
              <tr class="highlight-missing"><td>1004</td><td>Zhao Liu</td><td>missingLinear Algebra</td></tr>
            </tbody>
          </table>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem3-3a-i #result-table-container-3a');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 5: Complete Correlated Relational Division - Final Result</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">Result ← π<sub>sname</sub>((AllStudents - StudentsWithMissing) ⋈ Student)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Use double negation logic: Find students "without missing courses", i.e., students who took all courses in their major
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>sname</th>
                <th>Major</th>
                <th>Completion Status</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Zhang San</td><td>CS</td><td>✓ Completed all CS courses</td></tr>
              <tr class="result-row"><td>Wang Wu</td><td>Math</td><td>✓ Completed all Math courses</td></tr>
              <tr class="result-row"><td>Chen Qi</td><td>Physics</td><td>✓ Completed all Physics courses</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Students who took all courses in their major:Zhang San、Wang Wu、Chen Qi
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Correlated Relational Division Summary:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Key Features</strong>:Each student only needs to take courses in their own major, demonstrating "correlation"</li>
              <li><strong>Double Negation Logic</strong>:Find students without missing courses = All students - Students with missing courses</li>
              <li><strong>Hierarchical Processing</strong>:First group requirements by major, then perform division operation</li>
              <li><strong>Practical Applications</strong>:Graduation qualification review, course completion assessment</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Correlated relational divisionSuccessfully identified target group that satisfies personalized full coverage conditions
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem3AI.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem3AI.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem3AI.showStep(Math.min(5, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem3AI.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem3AI.keyboardHandler) {
          document.removeEventListener('keydown', Problem3AI.keyboardHandler);
          Problem3AI.keyboardHandler = null;
        }
      }
    }

    // Problem 3A(ii): Static Relational Division
    class Problem3AII {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem3-3a-ii .step-controls');

        // Add keyboard event listener
        Problem3AII.addKeyboardListener();

        container.innerHTML = `
          <div class="method-selector" style="margin-bottom: 20px;">
            <button onclick="Problem3AII.showMethod('division')" class="method-button active" id="method-division-3aii">Static relational division</button>
            <button onclick="Problem3AII.showMethod('set-difference')" class="method-button" id="method-set-difference-3aii">Set Difference Method</button>
          </div>
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem3AII.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem3AII.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem3AII.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem3AII.showStep(4)">Step4</button>
            <button class="step-btn" onclick="Problem3AII.showStep(5)">Step5</button>
            <button class="step-btn" onclick="Problem3AII.showStep(6)">Step6</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / <span class="total-steps">4</span>
            </div>
          </div>
          <div class="step-description">
            Static relational division:Find teachers who have taught in all classrooms
          </div>
        `;

        const contentArea = document.querySelector('#content-problem3-3a-ii .content-area');

        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 3A(ii): Static relational division</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Find names of teachers who have taught in all classrooms<br>
              <strong>Key point:</strong>Fixed Divisor Set (all classrooms), demonstrating "static" feature
            </p>
          </div>

          <div class="schema-info">
            <h4>📋 Table Structure</h4>
            <div class="schema-grid">
              <div class="schema-table">
                <h5>Faculty (Faculty Table)</h5>
                <ul>
                  <li><strong>fid</strong> - Faculty ID</li>
                  <li><strong>fname</strong> - Faculty Name</li>
                  <li><strong>deptid</strong> - Belonging to Department ID</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Room (Classroom Table)</h5>
                <ul>
                  <li><strong>room_no</strong> - Room Number</li>
                  <li><strong>building</strong> - Building Location</li>
                  <li><strong>capacity</strong> - Capacity</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Teaching (Teaching Table)</h5>
                <ul>
                  <li><strong>fid</strong> - Faculty ID</li>
                  <li><strong>room_no</strong> - Room Number</li>
                  <li><strong>semester</strong> - Semester</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Sample Data Tables -->
          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <div class="data-tables-grid">
              <div class="data-table-wrapper">
                <h5>Faculty Faculty Table</h5>
                <table class="data-table" id="faculty-table-3aii">
                  <thead>
                    <tr><th>fid</th><th>fname</th><th>deptid</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>F001</td><td>Prof. Zhang</td><td>CS</td></tr>
                    <tr><td>F002</td><td>Prof. Li</td><td>Math</td></tr>
                    <tr><td>F003</td><td>Prof. Wang</td><td>CS</td></tr>
                    <tr><td>F004</td><td>Prof. Zhao</td><td>Physics</td></tr>
                    <tr><td>F005</td><td>Prof. Chen</td><td>Math</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Room Classroom Table</h5>
                <table class="data-table" id="room-table-3aii">
                  <thead>
                    <tr><th>room_no</th><th>building</th><th>capacity</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>A101</td><td>Building A</td><td>50</td></tr>
                    <tr><td>B201</td><td>Building B</td><td>100</td></tr>
                    <tr><td>C301</td><td>Building C</td><td>80</td></tr>
                    <tr><td>D401</td><td>Building D</td><td>120</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Teaching Teaching Table</h5>
                <table class="data-table" id="teaching-table-3aii">
                  <thead>
                    <tr><th>fid</th><th>room_no</th><th>semester</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>F001</td><td>A101</td><td>Spring 2024</td></tr>
                    <tr><td>F001</td><td>B201</td><td>Spring 2024</td></tr>
                    <tr><td>F001</td><td>C301</td><td>Fall 2024</td></tr>
                    <tr><td>F001</td><td>D401</td><td>Fall 2024</td></tr>
                    <tr><td>F002</td><td>A101</td><td>Spring 2024</td></tr>
                    <tr><td>F002</td><td>B201</td><td>Fall 2024</td></tr>
                    <tr><td>F002</td><td>C301</td><td>Spring 2024</td></tr>
                    <tr><td>F003</td><td>A101</td><td>Fall 2024</td></tr>
                    <tr><td>F003</td><td>B201</td><td>Spring 2024</td></tr>
                    <tr><td>F004</td><td>A101</td><td>Spring 2024</td></tr>
                    <tr><td>F005</td><td>B201</td><td>Fall 2024</td></tr>
                    <tr><td>F005</td><td>D401</td><td>Spring 2024</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="result-table-container-3aii">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;

        AppState.currentMethod = 'division';
        Problem3AII.showStep(1);
      }

      static showMethod(method) {
        AppState.currentMethod = method;

        // Update button states
        document.querySelectorAll('#content-problem3-3a-ii .method-button').forEach(btn => {
          btn.classList.remove('active');
        });
        document.getElementById(`method-${method}-3aii`).classList.add('active');

        // Update total steps display
        const totalSteps = method === 'division' ? 4 : 6;
        document.querySelector('#content-problem3-3a-ii .total-steps').textContent = totalSteps;

        // Update step buttons visibility
        const stepButtons = document.querySelectorAll('#content-problem3-3a-ii .step-btn');
        stepButtons.forEach((btn, index) => {
          btn.style.display = index < totalSteps ? 'inline-block' : 'none';
        });

        AppState.currentStep = 1;
        Problem3AII.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;

        // Update step indicators
        document.querySelectorAll('#content-problem3-3a-ii .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        document.querySelector('#content-problem3-3a-ii .current-step').textContent = step;

        // Clear previous highlights
        document.querySelectorAll('#content-problem3-3a-ii table td, #content-problem3-3a-ii table tr').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });

        if (AppState.currentMethod === 'division') {
          switch(step) {
            case 1: Problem3AII.showAllRooms(); break;
            case 2: Problem3AII.showFacultyRoomPairs(); break;
            case 3: Problem3AII.showFacultiesWithoutSomeRooms(); break;
            case 4: Problem3AII.showDivisionFinalResult(); break;
          }
        } else {
          switch(step) {
            case 1: Problem3AII.showAllFaculties(); break;
            case 2: Problem3AII.showAllRoomsSet(); break;
            case 3: Problem3AII.showCartesianProduct(); break;
            case 4: Problem3AII.showMissingTeachingPairs(); break;
            case 5: Problem3AII.showFacultiesWithMissingRooms(); break;
            case 6: Problem3AII.showSetDifferenceFinalResult(); break;
          }
        }
      }

      // Division Method Steps
      static showAllRooms() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 1:GetDivisorSet (AllRooms)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>relational division:</strong><br>
              <code class="algebra-expr">π<sub>fid,room_no</sub>(Teaching) ÷ π<sub>room_no</sub>(Room)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Relational division directly expresses"Find faculty who have teaching relations with all classrooms"
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>room_no</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>A101</td></tr>
              <tr class="highlight-step1"><td>B201</td></tr>
              <tr class="highlight-step1"><td>C301</td></tr>
              <tr class="highlight-step1"><td>D401</td></tr>
            </tbody>
          </table>
          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 20px; color: #1565c0;">
            <strong>Static Feature:</strong>DivisorSet (all classrooms) is fixed and does not depend on specific faculty or other dynamic conditions
          </div>
        `;
      }

      static showFacultyRoomPairs() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 2: Identify Dividend relation (Teaching relation)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Dividend in Division:</strong><br>
              <code class="algebra-expr">π<sub>fid,room_no</sub>(Teaching)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Dividend is existing faculty-classroom teaching relations, Division finds faculty that can pair with all classrooms
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>fid</th>
                <th>room_no</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step2"><td>F001</td><td>A101</td><td>Prof. Zhang teaches in A101</td></tr>
              <tr class="highlight-step2"><td>F001</td><td>B201</td><td>Prof. Zhang teaches in B201</td></tr>
              <tr class="highlight-step2"><td>F001</td><td>C301</td><td>Prof. Zhang teaches in C301</td></tr>
              <tr class="highlight-step2"><td>F001</td><td>D401</td><td>Prof. Zhang teaches in D401</td></tr>
              <tr class="highlight-step2"><td>F002</td><td>A101</td><td>Prof. Li teaches in A101</td></tr>
              <tr class="highlight-step2"><td>F002</td><td>B201</td><td>Prof. Li teaches in B201</td></tr>
              <tr class="highlight-step2"><td>F002</td><td>C301</td><td>Prof. Li teaches in C301</td></tr>
              <tr class="highlight-step2"><td>F003</td><td>A101</td><td>Prof. Wang teaches in A101</td></tr>
              <tr class="highlight-step2"><td>F003</td><td>B201</td><td>Prof. Wang teaches in B201</td></tr>
              <tr class="highlight-step2"><td>F004</td><td>A101</td><td>Prof. Zhao teaches in A101</td></tr>
              <tr class="highlight-step2"><td>F005</td><td>B201</td><td>Prof. Chen teaches in B201</td></tr>
              <tr class="highlight-step2"><td>F005</td><td>D401</td><td>Prof. Chen teaches in D401</td></tr>
            </tbody>
          </table>
        `;
      }

      static showFacultiesWithoutSomeRooms() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 3:Division Semantic Analysis</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Division logic:</strong><br>
              <code class="algebra-expr">A ÷ B = {x | ∀y ∈ B, (x,y) ∈ A}</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              For each faculty x, check if there exists a teaching relation (x,y) with all classrooms y in B
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>fid</th>
                <th>Missing Classrooms</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-missing"><td>F002</td><td>D401</td><td>Prof. LiDid not teach in D401</td></tr>
              <tr class="highlight-missing"><td>F003</td><td>C301, D401</td><td>Prof. WangDid not teach in C301 or D401</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>B201, C301, D401</td><td>Prof. ZhaoDid not teach in B201, C301, or D401</td></tr>
              <tr class="highlight-missing"><td>F005</td><td>A101, C301</td><td>Prof. ChenDid not teach in A101 or C301</td></tr>
            </tbody>
          </table>
          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; color: #856404;">
            <strong>Analysis:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>F001(Prof. Zhang)</strong>:Taught in all 4 classrooms, No missing</li>
              <li><strong>F002(Prof. Li)</strong>:Missing D401 classroom</li>
              <li><strong>F003(Prof. Wang)</strong>:Missing C301 and D401 classrooms</li>
              <li><strong>F004(Prof. Zhao)</strong>:Only taught in A101, Missing the other 3 classrooms</li>
              <li><strong>F005(Prof. Chen)</strong>:Missing A101 and C301 classrooms</li>
            </ul>
          </div>
        `;
      }

      static showDivisionFinalResult() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #007bff;">Step 4: Complete Static Relational Division - Final Result</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Division Expression:</strong><br>
              <code class="algebra-expr">Result ← π<sub>fname</sub>((π<sub>fid,room_no</sub>(Teaching) ÷ π<sub>room_no</sub>(Room)) ⋈ Faculty)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Division operation directly finds faculty that meet conditions, then join Faculty table to get names
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>fname</th>
                <th>Faculty ID</th>
                <th>Coverage Status</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Prof. Zhang</td><td>F001</td><td>✓ Taught in all 4 classrooms</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Faculty who taught in all classrooms:Prof. Zhang
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Static Relational Division Summary:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Division Symbol ÷</strong>:Intuitively expresses "Find elements that have relations with all elements in Divisor"</li>
              <li><strong>Static Feature</strong>:DivisorSet is fixed (all classrooms), does not depend on dynamic conditions</li>
              <li><strong>Mathematical Semantics</strong>:A ÷ B = {x | ∀y ∈ B, (x,y) ∈ A}</li>
              <li><strong>Application Scenarios</strong>:Full coverage queries, such as "faculty who teach in all classrooms"</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Static relational division uses division symbol to clearly express the semantics of full coverage queries
            </p>
          </div>
        `;
      }

      // Set Difference Method Steps
      static showAllFaculties() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 1:GetAll facultySet (AllFaculties)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">A ← π<sub>fid</sub>(Faculty)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Set Difference Method: Start from all faculty, gradually exclude faculty that do not meet conditions
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr><th>fid</th><th>Faculty Name</th></tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>F001</td><td>Prof. Zhang</td></tr>
              <tr class="highlight-step1"><td>F002</td><td>Prof. Li</td></tr>
              <tr class="highlight-step1"><td>F003</td><td>Prof. Wang</td></tr>
              <tr class="highlight-step1"><td>F004</td><td>Prof. Zhao</td></tr>
              <tr class="highlight-step1"><td>F005</td><td>Prof. Chen</td></tr>
            </tbody>
          </table>
        `;
      }

      static showAllRoomsSet() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 2:GetAll classroomsSet (AllRooms)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">B ← π<sub>room_no</sub>(Room)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Set Difference Method "Divisor": Complete set of all classrooms
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr><th>room_no</th><th>Building</th></tr>
            </thead>
            <tbody>
              <tr class="highlight-step2"><td>A101</td><td>Building A</td></tr>
              <tr class="highlight-step2"><td>B201</td><td>Building B</td></tr>
              <tr class="highlight-step2"><td>C301</td><td>Building C</td></tr>
              <tr class="highlight-step2"><td>D401</td><td>Building D</td></tr>
            </tbody>
          </table>
        `;
      }

      static showCartesianProduct() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 3:constructCartesian product (A × B)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">A × B ← π<sub>fid</sub>(Faculty) × π<sub>room_no</sub>(Room)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Generate all possible (faculty, classroom) combinations, total 5×4=20 combinations
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr><th>fid</th><th>room_no</th><th>Theoretical combinations</th></tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>F001</td><td>A101</td><td>Prof. Zhang-A101</td></tr>
              <tr class="highlight-step1"><td>F001</td><td>B201</td><td>Prof. Zhang-B201</td></tr>
              <tr class="highlight-step1"><td>F001</td><td>C301</td><td>Prof. Zhang-C301</td></tr>
              <tr class="highlight-step1"><td>F001</td><td>D401</td><td>Prof. Zhang-D401</td></tr>
              <tr class="highlight-step2"><td>F002</td><td>A101</td><td>Prof. Li-A101</td></tr>
              <tr class="highlight-step2"><td>F002</td><td>B201</td><td>Prof. Li-B201</td></tr>
              <tr class="highlight-step2"><td>F002</td><td>C301</td><td>Prof. Li-C301</td></tr>
              <tr class="highlight-missing"><td>F002</td><td>D401</td><td>Prof. Li-D401 ❌</td></tr>
              <tr class="highlight-step1"><td>F003</td><td>A101</td><td>Prof. Wang-A101</td></tr>
              <tr class="highlight-step1"><td>F003</td><td>B201</td><td>Prof. Wang-B201</td></tr>
              <tr class="highlight-missing"><td>F003</td><td>C301</td><td>Prof. Wang-C301 ❌</td></tr>
              <tr class="highlight-missing"><td>F003</td><td>D401</td><td>Prof. Wang-D401 ❌</td></tr>
              <tr class="highlight-step1"><td>F004</td><td>A101</td><td>Prof. Zhao-A101</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>B201</td><td>Prof. Zhao-B201 ❌</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>C301</td><td>Prof. Zhao-C301 ❌</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>D401</td><td>Prof. Zhao-D401 ❌</td></tr>
              <tr class="highlight-missing"><td>F005</td><td>A101</td><td>Prof. Chen-A101 ❌</td></tr>
              <tr class="highlight-step2"><td>F005</td><td>B201</td><td>Prof. Chen-B201</td></tr>
              <tr class="highlight-missing"><td>F005</td><td>C301</td><td>Prof. Chen-C301 ❌</td></tr>
              <tr class="highlight-step2"><td>F005</td><td>D401</td><td>Prof. Chen-D401</td></tr>
            </tbody>
          </table>
          <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-top: 20px; color: #721c24;">
            Marked ❌ combinations indicate theoretically should exist but practically missing teaching records
          </div>
        `;
      }

      static showMissingTeachingPairs() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 4: Find Missing Teaching Pairs (MissingPairs)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">MissingPairs ← (A × B) - π<sub>fid,room_no</sub>(Teaching)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Use set difference to find missing in theoretical combinations practicalTeachingrecords
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr><th>fid</th><th>room_no</th><th>Missing Description</th></tr>
            </thead>
            <tbody>
              <tr class="highlight-missing"><td>F002</td><td>D401</td><td>Prof. LiDid not teach in D401</td></tr>
              <tr class="highlight-missing"><td>F003</td><td>C301</td><td>Prof. WangDid not teach in C301</td></tr>
              <tr class="highlight-missing"><td>F003</td><td>D401</td><td>Prof. WangDid not teach in D401</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>B201</td><td>Prof. ZhaoDid not teach in B201</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>C301</td><td>Prof. ZhaoDid not teach in C301</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>D401</td><td>Prof. ZhaoDid not teach in D401</td></tr>
              <tr class="highlight-missing"><td>F005</td><td>A101</td><td>Prof. ChenDid not teach in A101</td></tr>
              <tr class="highlight-missing"><td>F005</td><td>C301</td><td>Prof. ChenDid not teach in C301</td></tr>
            </tbody>
          </table>
        `;
      }

      static showFacultiesWithMissingRooms() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 5: Find Faculty with Missing Records (FacultiesWithMissing)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">FacultiesWithMissing ← π<sub>fid</sub>(MissingPairs)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Project all Faculty IDs with missing teaching records from missing pairs
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr><th>fid</th><th>Faculty Name</th><th>Missing Status</th></tr>
            </thead>
            <tbody>
              <tr class="highlight-missing"><td>F002</td><td>Prof. Li</td><td>Missing D401 classroom</td></tr>
              <tr class="highlight-missing"><td>F003</td><td>Prof. Wang</td><td>Missing C301, D401 classrooms</td></tr>
              <tr class="highlight-missing"><td>F004</td><td>Prof. Zhao</td><td>Missing B201, C301, D401 classrooms</td></tr>
              <tr class="highlight-missing"><td>F005</td><td>Prof. Chen</td><td>Missing A101, C301 classrooms</td></tr>
            </tbody>
          </table>
        `;
      }

      static showSetDifferenceFinalResult() {
        const resultContainer = document.querySelector('#content-problem3-3a-ii #result-table-container-3aii');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 6: Complete Set Difference Method - Final Result</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">Result ← π<sub>fname</sub>((A - FacultiesWithMissing) ⋈ Faculty)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Subtract faculty with missing records from all faculty to obtain faculty with complete coverage
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr><th>fname</th><th>Faculty ID</th><th>Coverage Status</th></tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Prof. Zhang</td><td>F001</td><td>✓ Taught in all 4 classrooms</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Faculty who taught in all classrooms:Prof. Zhang
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Set Difference Method Summary:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Step1-2</strong>:Prepare base sets A (faculty) and B (classrooms)</li>
              <li><strong>Step3</strong>:Construct Cartesian product A×B to obtain all theoretical combinations</li>
              <li><strong>Step4</strong>:Use set difference to find missing teaching records</li>
              <li><strong>Step5-6</strong>:Identify and exclude faculty with missing records to obtain final result</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Set Difference Method Successfully identified target entities that satisfy full coverage conditions through step-by-step filtering
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem3AII.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem3AII.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem3AII.showStep(Math.min(6, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem3AII.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem3AII.keyboardHandler) {
          document.removeEventListener('keydown', Problem3AII.keyboardHandler);
          Problem3AII.keyboardHandler = null;
        }
      }
    }

    // Problem 3B: Set Difference - Students Not Taking Department Faculty Courses
    class Problem3B {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem3-3b .step-controls');

        // Add keyboard event listener
        Problem3B.addKeyboardListener();

        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem3B.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem3B.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem3B.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem3B.showStep(4)">Step4</button>
            <button class="step-btn" onclick="Problem3B.showStep(5)">Step5</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
          </div>
          <div class="step-description">
            Set difference operation:Find students who have not taken courses taught by faculty in their department
          </div>
        `;

        const contentArea = document.querySelector('#content-problem3-3b .content-area');

        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 3B: Set difference operation</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Find students who have not taken courses taught by faculty in their departmentName<br>
              <strong>Key point:</strong>Department-related exclusion query, demonstrating the application of set difference in complex condition filtering
            </p>
          </div>

          <div class="schema-info">
            <h4>📋 Table Structure</h4>
            <div class="schema-grid">
              <div class="schema-table">
                <h5>Student (Student Table)</h5>
                <ul>
                  <li><strong>sid</strong> - Student ID</li>
                  <li><strong>sname</strong> - Student Name</li>
                  <li><strong>major</strong> - Major ID</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Faculty (Faculty Table)</h5>
                <ul>
                  <li><strong>fid</strong> - Faculty ID</li>
                  <li><strong>fname</strong> - Faculty Name</li>
                  <li><strong>deptid</strong> - Belonging to Department ID</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Teaching (Teaching Table)</h5>
                <ul>
                  <li><strong>fid</strong> - Faculty ID</li>
                  <li><strong>cname</strong> - Course Name</li>
                  <li><strong>semester</strong> - Semester</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Enrolled (Enrollment Table)</h5>
                <ul>
                  <li><strong>sid</strong> - Student ID</li>
                  <li><strong>cname</strong> - Course Name</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Sample Data Tables -->
          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <div class="data-tables-grid">
              <div class="data-table-wrapper">
                <h5>Student Student Table</h5>
                <table class="data-table" id="student-table-3b">
                  <thead>
                    <tr><th>sid</th><th>sname</th><th>major</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>S001</td><td>Zhang San</td><td>CS</td></tr>
                    <tr><td>S002</td><td>Li Si</td><td>CS</td></tr>
                    <tr><td>S003</td><td>Wang Wu</td><td>Math</td></tr>
                    <tr><td>S004</td><td>Zhao Liu</td><td>Math</td></tr>
                    <tr><td>S005</td><td>Chen Qi</td><td>Physics</td></tr>
                    <tr><td>S006</td><td>Sun Ba</td><td>Physics</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Faculty Faculty Table</h5>
                <table class="data-table" id="faculty-table-3b">
                  <thead>
                    <tr><th>fid</th><th>fname</th><th>deptid</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>F001</td><td>Prof. Zhang</td><td>CS</td></tr>
                    <tr><td>F002</td><td>Prof. Li</td><td>Math</td></tr>
                    <tr><td>F003</td><td>Prof. Wang</td><td>CS</td></tr>
                    <tr><td>F004</td><td>Prof. Zhao</td><td>Physics</td></tr>
                    <tr><td>F005</td><td>Prof. Chen</td><td>Math</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Teaching Teaching Table</h5>
                <table class="data-table" id="teaching-table-3b">
                  <thead>
                    <tr><th>fid</th><th>cname</th><th>semester</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>F001</td><td>Data Structures</td><td>Spring 2024</td></tr>
                    <tr><td>F001</td><td>Algorithm Analysis</td><td>Fall 2024</td></tr>
                    <tr><td>F002</td><td>Advanced Mathematics</td><td>Spring 2024</td></tr>
                    <tr><td>F002</td><td>Linear Algebra</td><td>Fall 2024</td></tr>
                    <tr><td>F003</td><td>Database Systems</td><td>Spring 2024</td></tr>
                    <tr><td>F004</td><td>General Physics</td><td>Fall 2024</td></tr>
                    <tr><td>F005</td><td>Probability Theory</td><td>Spring 2024</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Enrolled Enrollment Table</h5>
                <table class="data-table" id="enrolled-table-3b">
                  <thead>
                    <tr><th>sid</th><th>cname</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>S001</td><td>Data Structures</td></tr>
                    <tr><td>S001</td><td>Advanced Mathematics</td></tr>
                    <tr><td>S002</td><td>Algorithm Analysis</td></tr>
                    <tr><td>S002</td><td>General Physics</td></tr>
                    <tr><td>S003</td><td>Advanced Mathematics</td></tr>
                    <tr><td>S003</td><td>Data Structures</td></tr>
                    <tr><td>S004</td><td>Linear Algebra</td></tr>
                    <tr><td>S004</td><td>Database Systems</td></tr>
                    <tr><td>S005</td><td>Probability Theory</td></tr>
                    <tr><td>S005</td><td>Algorithm Analysis</td></tr>
                    <tr><td>S006</td><td>General Physics</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="result-table-container-3b">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;

        Problem3B.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;

        // Update step indicators
        document.querySelectorAll('#content-problem3-3b .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        document.querySelector('#content-problem3-3b .current-step').textContent = step;

        // Clear previous highlights
        document.querySelectorAll('#content-problem3-3b table td, #content-problem3-3b table tr').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });

        const resultContainer = document.querySelector('#content-problem3-3b #result-table-container-3b');

        switch(step) {
          case 1: Problem3B.showAllStudents(); break;
          case 2: Problem3B.showDepartmentFacultyCourses(); break;
          case 3: Problem3B.showStudentDepartmentCourses(); break;
          case 4: Problem3B.showStudentsWithDepartmentCourses(); break;
          case 5: Problem3B.showFinalResult(); break;
        }
      }

      static showAllStudents() {
        const resultContainer = document.querySelector('#content-problem3-3b #result-table-container-3b');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 1:GetAll studentsSet (AllStudents)</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">AllStudents ← π<sub>sid</sub>(Student)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Set difference operation "Minuend":Complete set of all students
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>sname</th>
                <th>major</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>CS</td></tr>
              <tr class="highlight-step1"><td>S002</td><td>Li Si</td><td>CS</td></tr>
              <tr class="highlight-step1"><td>S003</td><td>Wang Wu</td><td>Math</td></tr>
              <tr class="highlight-step1"><td>S004</td><td>Zhao Liu</td><td>Math</td></tr>
              <tr class="highlight-step1"><td>S005</td><td>Chen Qi</td><td>Physics</td></tr>
              <tr class="highlight-step1"><td>S006</td><td>Sun Ba</td><td>Physics</td></tr>
            </tbody>
          </table>
        `;
      }

      static showDepartmentFacultyCourses() {
        const resultContainer = document.querySelector('#content-problem3-3b #result-table-container-3b');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 2: Find department faculty courses corresponding to student majors</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">DeptCourses ← π<sub>major,cname</sub>((Student ⋈<sub>major=deptid</sub> Faculty) ⋈ Teaching)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Join Student, Faculty, and Teaching tables to find courses offered by department faculty for each major
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>major</th>
                <th>cname</th>
                <th>Teaching Faculty</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>CS</td><td>Data Structures</td><td>Prof. Zhang(CS)</td><td>Courses offered by CS department faculty</td></tr>
              <tr class="highlight-step1"><td>CS</td><td>Algorithm Analysis</td><td>Prof. Zhang(CS)</td><td>Courses offered by CS department faculty</td></tr>
              <tr class="highlight-step1"><td>CS</td><td>Database Systems</td><td>Prof. Wang(CS)</td><td>Courses offered by CS department faculty</td></tr>
              <tr class="highlight-step2"><td>Math</td><td>Advanced Mathematics</td><td>Prof. Li(Math)</td><td>Courses offered by Math department faculty</td></tr>
              <tr class="highlight-step2"><td>Math</td><td>Linear Algebra</td><td>Prof. Li(Math)</td><td>Courses offered by Math department faculty</td></tr>
              <tr class="highlight-step2"><td>Math</td><td>Probability Theory</td><td>Prof. Chen(Math)</td><td>Courses offered by Math department faculty</td></tr>
              <tr class="highlight-missing"><td>Physics</td><td>General Physics</td><td>Prof. Zhao(Physics)</td><td>Courses offered by Physics department faculty</td></tr>
            </tbody>
          </table>
          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; color: #856404;">
            <strong>Important Concept:</strong>The term "department faculty courses" refers to courses offered by faculty in the student's major, demonstrating department correlation
          </div>
        `;
      }

      static showStudentDepartmentCourses() {
        const resultContainer = document.querySelector('#content-problem3-3b #result-table-container-3b');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 3: Construct student-department course correspondence relation</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">StudentDeptCourses ← π<sub>sid,cname</sub>(Student ⋈ DeptCourses)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Match all courses offered by department faculty for each student's major
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>sname</th>
                <th>cname</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Data Structures</td><td>CS student's department courses</td></tr>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Algorithm Analysis</td><td>CS student's department courses</td></tr>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Database Systems</td><td>CS student's department courses</td></tr>
              <tr class="highlight-step1"><td>S002</td><td>Li Si</td><td>Data Structures</td><td>CS student's department courses</td></tr>
              <tr class="highlight-step1"><td>S002</td><td>Li Si</td><td>Algorithm Analysis</td><td>CS student's department courses</td></tr>
              <tr class="highlight-step1"><td>S002</td><td>Li Si</td><td>Database Systems</td><td>CS student's department courses</td></tr>
              <tr class="highlight-step2"><td>S003</td><td>Wang Wu</td><td>Advanced Mathematics</td><td>Math student's department courses</td></tr>
              <tr class="highlight-step2"><td>S003</td><td>Wang Wu</td><td>Linear Algebra</td><td>Math student's department courses</td></tr>
              <tr class="highlight-step2"><td>S003</td><td>Wang Wu</td><td>Probability Theory</td><td>Math student's department courses</td></tr>
              <tr class="highlight-step2"><td>S004</td><td>Zhao Liu</td><td>Advanced Mathematics</td><td>Math student's department courses</td></tr>
              <tr class="highlight-step2"><td>S004</td><td>Zhao Liu</td><td>Linear Algebra</td><td>Math student's department courses</td></tr>
              <tr class="highlight-step2"><td>S004</td><td>Zhao Liu</td><td>Probability Theory</td><td>Math student's department courses</td></tr>
              <tr class="highlight-missing"><td>S005</td><td>Chen Qi</td><td>General Physics</td><td>Physics student's department courses</td></tr>
              <tr class="highlight-missing"><td>S006</td><td>Sun Ba</td><td>General Physics</td><td>Physics student's department courses</td></tr>
            </tbody>
          </table>
        `;
      }

      static showStudentsWithDepartmentCourses() {
        const resultContainer = document.querySelector('#content-problem3-3b #result-table-container-3b');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 4: Find students who took department faculty courses</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">StudentsWithDeptCourses ← π<sub>sid</sub>(StudentDeptCourses ⋈ Enrolled)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Join StudentDeptCourses and Enrolled to find students who actually took department courses
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>sname</th>
                <th>Took Department Courses</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Data Structures</td><td>CS student took CS department courses</td></tr>
              <tr class="highlight-step1"><td>S002</td><td>Li Si</td><td>Algorithm Analysis</td><td>CS student took CS department courses</td></tr>
              <tr class="highlight-step2"><td>S003</td><td>Wang Wu</td><td>Advanced Mathematics</td><td>Math student took Math department courses</td></tr>
              <tr class="highlight-step2"><td>S004</td><td>Zhao Liu</td><td>Linear Algebra</td><td>Math student took Math department courses</td></tr>
              <tr class="highlight-missing"><td>S005</td><td>Chen Qi</td><td>Probability Theory</td><td>Physics student took Math department course (cross-department enrollment)</td></tr>
              <tr class="highlight-missing"><td>S006</td><td>Sun Ba</td><td>General Physics</td><td>Physics student took Physics department courses</td></tr>
            </tbody>
          </table>
          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; color: #856404;">
            <strong>Analysis:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>S001(Zhang San)</strong>:Took department course"Data Structures"</li>
              <li><strong>S002(Li Si)</strong>:Took department course"Algorithm Analysis"</li>
              <li><strong>S003(Wang Wu)</strong>:Took department course"Advanced Mathematics"</li>
              <li><strong>S004(Zhao Liu)</strong>:Took department course"Linear Algebra"</li>
              <li><strong>S005(Chen Qi)</strong>:Took"Probability Theory", but this is offered by Math department, not department (Physics) course</li>
              <li><strong>S006(Sun Ba)</strong>:Took department course"General Physics"</li>
            </ul>
          </div>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem3-3b #result-table-container-3b');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #dc3545;">Step 5: Complete Set Difference Operation - Final Result</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Set Difference Expression:</strong><br>
              <code class="algebra-expr">Result ← π<sub>sname</sub>((AllStudents - StudentsWithDeptCourses) ⋈ Student)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Subtract students who took department faculty courses from all students to obtain students who did not take department courses
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>sname</th>
                <th>Major</th>
                <th>Enrollment Status</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Chen Qi</td><td>Physics</td><td>❌ Did not take Physics department faculty courses</td></tr>
            </tbody>
          </table>
          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Students who did not take department faculty courses:Chen Qi
          </div>
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Set Difference Operation Summary:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Set Difference (A - B)</strong>:Find elements in A but not in B</li>
              <li><strong>Department-related queries</strong>:Consider correspondence relation between student major and faculty department</li>
              <li><strong>Exclusion Logic</strong>:Find objects that do not meet conditions by subtracting objects that meet conditions</li>
              <li><strong>Composite Conditions</strong>:Involves multi-table joins and complex belonging relation judgments</li>
            </ul>
            <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 15px 0;">
              <strong>Key Analysis:</strong><br>
              • <strong>Chen Qi</strong>Although took "Probability Theory" course, but this is a course offered by Math department faculty<br>
              • As a Physics major student, Chen Qi did not take any courses offered by Physics department faculty<br>
              • Other students all took at least one department faculty course
            </div>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Set difference operation Successfully identified target objects that did not satisfy department-related conditions
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem3B.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem3B.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem3B.showStep(Math.min(5, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem3B.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem3B.keyboardHandler) {
          document.removeEventListener('keydown', Problem3B.keyboardHandler);
          Problem3B.keyboardHandler = null;
        }
      }
    }

    // Problem 3C: Self-Join - Students Taking Multiple Courses at Same Time
    class Problem3C {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem3-3c .step-controls');

        // Add keyboard event listener
        Problem3C.addKeyboardListener();

        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem3C.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem3C.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem3C.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem3C.showStep(4)">Step4</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 4
            </div>
          </div>
          <div class="step-description">
            Self-join:Find students taking multiple courses at the same time
          </div>
        `;

        const contentArea = document.querySelector('#content-problem3-3c .content-area');

        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 3C: Self-join</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Find students taking multiple courses at the same timeName<br>
              <strong>Key point:</strong>Self-join practical applications, handling time conflict detection problems
            </p>
          </div>

          <div class="schema-info">
            <h4>📋 Table Structure</h4>
            <div class="schema-grid">
              <div class="schema-table">
                <h5>Student (Student Table)</h5>
                <ul>
                  <li><strong>sid</strong> - Student ID</li>
                  <li><strong>sname</strong> - Student Name</li>
                  <li><strong>major</strong> - Major ID</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Class (Course Table)</h5>
                <ul>
                  <li><strong>cname</strong> - Course Name</li>
                  <li><strong>time_slot</strong> - Class Time Slot</li>
                  <li><strong>room</strong> - Classroom</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Enrolled (Enrollment Table)</h5>
                <ul>
                  <li><strong>sid</strong> - Student ID</li>
                  <li><strong>cname</strong> - Course Name</li>
                  <li><strong>semester</strong> - Semester</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Sample Data Tables -->
          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <div class="data-tables-grid">
              <div class="data-table-wrapper">
                <h5>Student Student Table</h5>
                <table class="data-table" id="student-table-3c">
                  <thead>
                    <tr><th>sid</th><th>sname</th><th>major</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>S001</td><td>Zhang San</td><td>CS</td></tr>
                    <tr><td>S002</td><td>Li Si</td><td>CS</td></tr>
                    <tr><td>S003</td><td>Wang Wu</td><td>Math</td></tr>
                    <tr><td>S004</td><td>Zhao Liu</td><td>Math</td></tr>
                    <tr><td>S005</td><td>Chen Qi</td><td>Physics</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Class Course Table</h5>
                <table class="data-table" id="class-table-3c">
                  <thead>
                    <tr><th>cname</th><th>time_slot</th><th>room</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Data Structures</td><td>Monday Period 9-10</td><td>A101</td></tr>
                    <tr><td>Algorithm Analysis</td><td>Monday Period 9-10</td><td>B201</td></tr>
                    <tr><td>Database Systems</td><td>Tuesday Period 3-4</td><td>C301</td></tr>
                    <tr><td>Advanced Mathematics</td><td>Wednesday Period 1-2</td><td>D401</td></tr>
                    <tr><td>Linear Algebra</td><td>Wednesday Period 1-2</td><td>E501</td></tr>
                    <tr><td>Probability Theory</td><td>Thursday Period 5-6</td><td>F601</td></tr>
                    <tr><td>General Physics</td><td>Thursday Period 5-6</td><td>G701</td></tr>
                    <tr><td>Discrete Mathematics</td><td>Friday Period 7-8</td><td>H801</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Enrolled Enrollment Table</h5>
                <table class="data-table" id="enrolled-table-3c">
                  <thead>
                    <tr><th>sid</th><th>cname</th><th>semester</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>S001</td><td>Data Structures</td><td>Spring 2024</td></tr>
                    <tr><td>S001</td><td>Algorithm Analysis</td><td>Spring 2024</td></tr>
                    <tr><td>S001</td><td>Database Systems</td><td>Spring 2024</td></tr>
                    <tr><td>S002</td><td>Advanced Mathematics</td><td>Spring 2024</td></tr>
                    <tr><td>S002</td><td>Linear Algebra</td><td>Spring 2024</td></tr>
                    <tr><td>S003</td><td>Probability Theory</td><td>Spring 2024</td></tr>
                    <tr><td>S003</td><td>General Physics</td><td>Spring 2024</td></tr>
                    <tr><td>S003</td><td>Discrete Mathematics</td><td>Spring 2024</td></tr>
                    <tr><td>S004</td><td>Data Structures</td><td>Spring 2024</td></tr>
                    <tr><td>S004</td><td>Probability Theory</td><td>Spring 2024</td></tr>
                    <tr><td>S005</td><td>Advanced Mathematics</td><td>Spring 2024</td></tr>
                    <tr><td>S005</td><td>Discrete Mathematics</td><td>Spring 2024</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="result-table-container-3c">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;

        Problem3C.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;

        // Update step indicators
        document.querySelectorAll('#content-problem3-3c .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        document.querySelector('#content-problem3-3c .current-step').textContent = step;

        // Clear previous highlights
        document.querySelectorAll('#content-problem3-3c table td, #content-problem3-3c table tr').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });

        const resultContainer = document.querySelector('#content-problem3-3c #result-table-container-3c');

        switch(step) {
          case 1: Problem3C.showStudentCourseTime(); break;
          case 2: Problem3C.showSelfJoinSetup(); break;
          case 3: Problem3C.showTimeConflictDetection(); break;
          case 4: Problem3C.showFinalResult(); break;
        }
      }

      static showStudentCourseTime() {
        const resultContainer = document.querySelector('#content-problem3-3c #result-table-container-3c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #6f42c1;">Step 1: Construct student-course-time relation</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational algebra expression:</strong><br>
              <code class="algebra-expr">StudentCourseTime ← Enrolled ⋈ Class</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Join Enrolled and Class tables to get time information for each student's enrolled courses
            </p>
          </div>
          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>sid</th>
                <th>sname</th>
                <th>cname</th>
                <th>time_slot</th>
                <th>room</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Data Structures</td><td>Monday Period 9-10</td><td>A101</td></tr>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Algorithm Analysis</td><td>Monday Period 9-10</td><td>B201</td></tr>
              <tr class="highlight-step1"><td>S001</td><td>Zhang San</td><td>Database Systems</td><td>Tuesday Period 3-4</td><td>C301</td></tr>
              <tr class="highlight-step2"><td>S002</td><td>Li Si</td><td>Advanced Mathematics</td><td>Wednesday Period 1-2</td><td>D401</td></tr>
              <tr class="highlight-step2"><td>S002</td><td>Li Si</td><td>Linear Algebra</td><td>Wednesday Period 1-2</td><td>E501</td></tr>
              <tr class="highlight-missing"><td>S003</td><td>Wang Wu</td><td>Probability Theory</td><td>Thursday Period 5-6</td><td>F601</td></tr>
              <tr class="highlight-missing"><td>S003</td><td>Wang Wu</td><td>General Physics</td><td>Thursday Period 5-6</td><td>G701</td></tr>
              <tr class="highlight-missing"><td>S003</td><td>Wang Wu</td><td>Discrete Mathematics</td><td>Friday Period 7-8</td><td>H801</td></tr>
              <tr class="highlight-step1"><td>S004</td><td>Zhao Liu</td><td>Data Structures</td><td>Monday Period 9-10</td><td>A101</td></tr>
              <tr class="highlight-step1"><td>S004</td><td>Zhao Liu</td><td>Probability Theory</td><td>Thursday Period 5-6</td><td>F601</td></tr>
              <tr class="highlight-step2"><td>S005</td><td>Chen Qi</td><td>Advanced Mathematics</td><td>Wednesday Period 1-2</td><td>D401</td></tr>
              <tr class="highlight-step2"><td>S005</td><td>Chen Qi</td><td>Discrete Mathematics</td><td>Friday Period 7-8</td><td>H801</td></tr>
            </tbody>
          </table>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px; color: #495057;">
            <strong>Time Conflict Identification:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Monday Period 9-10</strong>:Zhang San(Data Structures + Algorithm Analysis), Zhao Liu(Data Structures) - Zhang San has time conflict</li>
              <li><strong>Wednesday Period 1-2</strong>:Li Si(Advanced Mathematics + Linear Algebra), Chen Qi(Advanced Mathematics) - Li Si has time conflict</li>
              <li><strong>Thursday Period 5-6</strong>:Wang Wu(Probability Theory + General Physics), Zhao Liu(Probability Theory) - Wang Wu has time conflict</li>
            </ul>
          </div>
        `;
      }

      static showSelfJoinSetup() {
        const resultContainer = document.querySelector('#content-problem3-3c #result-table-container-3c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #6f42c1;">Step 2: Set Up Self-join Conditions</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Self-join Expression:</strong><br>
              <code class="algebra-expr">SCT1 ⋈<sub>Conditions</sub> SCT2 where SCT1 = SCT2 = StudentCourseTime</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Use the same table as two different relations for join to detect time conflicts
            </p>
          </div>

          <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px auto; max-width: 800px;">
            <h5 style="color: #1976d2; margin-bottom: 15px;">Self-join Conditions Design</h5>
            <div style="text-align: left;">
              <p style="margin: 8px 0;"><strong>Join condition:</strong></p>
              <ul style="margin: 10px 0 10px 20px;">
                <li><code>SCT1.sid = SCT2.sid</code> - Same student</li>
                <li><code>SCT1.time_slot = SCT2.time_slot</code> - Same time slot</li>
                <li><code>SCT1.cname ≠ SCT2.cname</code> - Different courses</li>
              </ul>

              <p style="margin: 15px 0 8px 0;"><strong>Logic Explanation:</strong></p>
              <ul style="margin: 10px 0 10px 20px;">
                <li>Find distinct courses that the same student enrolled in the same time slot</li>
                <li>Avoid complex aggregation operations through self-join</li>
                <li>Directly identify specific course pairs with time conflicts</li>
              </ul>
            </div>
          </div>

          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th colspan="3">Course 1 (SCT1)</th>
                <th colspan="3">Course 2 (SCT2)</th>
                <th>Conflict Type</th>
              </tr>
              <tr>
                <th>sid</th>
                <th>cname1</th>
                <th>time_slot</th>
                <th>sid</th>
                <th>cname2</th>
                <th>time_slot</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1">
                <td>S001</td><td>Data Structures</td><td>Monday Period 9-10</td>
                <td>S001</td><td>Algorithm Analysis</td><td>Monday Period 9-10</td>
                <td>Time Conflict</td>
              </tr>
              <tr class="highlight-step2">
                <td>S002</td><td>Advanced Mathematics</td><td>Wednesday Period 1-2</td>
                <td>S002</td><td>Linear Algebra</td><td>Wednesday Period 1-2</td>
                <td>Time Conflict</td>
              </tr>
              <tr class="highlight-missing">
                <td>S003</td><td>Probability Theory</td><td>Thursday Period 5-6</td>
                <td>S003</td><td>General Physics</td><td>Thursday Period 5-6</td>
                <td>Time Conflict</td>
              </tr>
            </tbody>
          </table>
        `;
      }

      static showTimeConflictDetection() {
        const resultContainer = document.querySelector('#content-problem3-3c #result-table-container-3c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #6f42c1;">Step 3: Execute Self-join to Detect Time Conflicts</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Complete Self-join Expression:</strong><br>
              <code class="algebra-expr">TimeConflicts ← σ<sub>SCT1.sid=SCT2.sid ∧ SCT1.time_slot=SCT2.time_slot ∧ SCT1.cname≠SCT2.cname</sub>(SCT1 × SCT2)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Select records that satisfy conflict conditions after Cartesian product
            </p>
          </div>

          <table class="data-table" style="margin: 0 auto;">
            <thead>
              <tr>
                <th>Student</th>
                <th>Conflict Time</th>
                <th>Course 1</th>
                <th>Classroom1</th>
                <th>Course 2</th>
                <th>Classroom2</th>
                <th>Conflict Analysis</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1">
                <td>Zhang San(S001)</td>
                <td>Monday Period 9-10</td>
                <td>Data Structures</td>
                <td>A101</td>
                <td>Algorithm Analysis</td>
                <td>B201</td>
                <td>🚨 Needs to be in two places</td>
              </tr>
              <tr class="highlight-step2">
                <td>Li Si(S002)</td>
                <td>Wednesday Period 1-2</td>
                <td>Advanced Mathematics</td>
                <td>D401</td>
                <td>Linear Algebra</td>
                <td>E501</td>
                <td>🚨 Classroom distance conflict</td>
              </tr>
              <tr class="highlight-missing">
                <td>Wang Wu(S003)</td>
                <td>Thursday Period 5-6</td>
                <td>Probability Theory</td>
                <td>F601</td>
                <td>General Physics</td>
                <td>G701</td>
                <td>🚨 Cross-disciplinary conflict</td>
              </tr>
            </tbody>
          </table>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; color: #856404;">
            <h5 style="color: #856404; margin-bottom: 10px;">🔍 Detailed Conflict Analysis</h5>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Zhang San</strong>:Enrolled in Data Structures (A101) and Algorithm Analysis (B201) at Monday Period 9-10, physically impossible to be in two classrooms simultaneously</li>
              <li><strong>Li Si</strong>:Enrolled in Advanced Mathematics (D401) and Linear Algebra (E501) at Wednesday Period 1-2, cannot attend both classes simultaneously even if classrooms are different</li>
              <li><strong>Wang Wu</strong>:Thursday Period 5-6 enrolled in Probability Theory (F601) and General Physics (G701), cross-disciplinary time conflict</li>
              <li><strong>Zhao Liu、Chen Qi</strong>:Although enrolled in multiple courses, the time arrangement is reasonable with no conflicts</li>
            </ul>
          </div>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem3-3c #result-table-container-3c');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #6f42c1;">Step 4: Output Final Result</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Result Extraction Expression:</strong><br>
              <code class="algebra-expr">Result ← π<sub>sname</sub>(TimeConflicts ⋈ Student)</code>
            </p>
            <p style="margin: 10px 0; color: #666;">
              Extract student names from conflict records, then deduplicate to obtain final result
            </p>
          </div>

          <table class="data-table" style="margin: 0 auto; background: #d4edda;">
            <thead>
              <tr>
                <th>sname</th>
                <th>Number of Conflicting Courses</th>
                <th>Time Conflict Details</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>Zhang San</td><td>2courses</td><td>Monday Period 9-10:Data Structures ⚡ Algorithm Analysis</td></tr>
              <tr class="result-row"><td>Li Si</td><td>2courses</td><td>Wednesday Period 1-2:Advanced Mathematics ⚡ Linear Algebra</td></tr>
              <tr class="result-row"><td>Wang Wu</td><td>2courses</td><td>Thursday Period 5-6:Probability Theory ⚡ General Physics</td></tr>
            </tbody>
          </table>

          <div style="text-align: center; margin-top: 15px; color: #28a745; font-weight: bold;">
            Students who enrolled in multiple courses at the same time:Zhang San、Li Si、Wang Wu
          </div>

          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>Self-join Summary:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Self-join (Self-Join)</strong>:Join a table with itself to compare different records within the table</li>
              <li><strong>Time Conflict Detection</strong>:Discover conflicts by comparing different enrollment records of the same student</li>
              <li><strong>Conditions Combinations</strong>:Same student + Same time + Different courses = Time Conflict</li>
              <li><strong>Practical Values</strong>:Conflict detection in scenarios such as enrollment systems, meeting arrangements, resource scheduling</li>
            </ul>

            <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 15px 0;">
              <strong>Technical Points:</strong><br>
              • <strong>Alias Usage</strong>:SCT1 and SCT2 distinguish different instances of the same table<br>
              • <strong>Conditions Design</strong>:Precisely define logical conditions for conflicts<br>
              • <strong>Result Deduplication</strong>:Avoid duplicate records of the same conflict<br>
              • <strong>Performance Optimization</strong>:Reasonable index design to improve self-join efficiency
            </div>

            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              Self-join Successfully identified all students with time arrangement conflicts
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem3C.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem3C.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem3C.showStep(Math.min(4, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem3C.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem3C.keyboardHandler) {
          document.removeEventListener('keydown', Problem3C.keyboardHandler);
          Problem3C.keyboardHandler = null;
        }
      }
    }

    // Problem 4.1: SQL Implementation of Relational Division
    class Problem41 {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem4-4-1 .step-controls');

        // Add keyboard event listener
        Problem41.addKeyboardListener();

        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem41.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem41.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem41.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem41.showStep(4)">Step4</button>
            <button class="step-btn" onclick="Problem41.showStep(5)">Step5</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
          </div>
          <div class="step-description">
            SQL implementation of relational division: Find members who borrowed all "McGraw-Hill" publisher books
          </div>
        `;

        const contentArea = document.querySelector('#content-problem4-4-1 .content-area');

        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 4.1: SQL Implementation of Relational Division</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Problem 1.a - Find members who borrowed all "McGraw-Hill" publisher books<br>
              <strong>Key point:</strong>Demonstrate relational division implementation in SQL using double NOT EXISTS
            </p>
          </div>

          <div class="schema-info">
            <h4>📋 Library Database Structure</h4>
            <div class="schema-grid">
              <div class="schema-table">
                <h5>Member (Member Table)</h5>
                <ul>
                  <li><strong>memb_no</strong> - Member Number (PK)</li>
                  <li><strong>name</strong> - Name</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Book (Books Table)</h5>
                <ul>
                  <li><strong>isbn</strong> - ISBN (PK)</li>
                  <li><strong>title</strong> - Book Title</li>
                  <li><strong>authors</strong> - Authors</li>
                  <li><strong>publisher</strong> - Publisher</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Borrowed (Borrowing Records)</h5>
                <ul>
                  <li><strong>memb_no</strong> - Member Number (FK)</li>
                  <li><strong>isbn</strong> - ISBN (FK)</li>
                  <li><strong>date</strong> - Borrowed Date</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Sample Data Tables -->
          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <div class="data-tables-grid">
              <div class="data-table-wrapper">
                <h5>Member Member Table</h5>
                <table class="data-table" id="member-table-41">
                  <thead>
                    <tr><th>memb_no</th><th>name</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>M001</td><td>Alice Smith</td></tr>
                    <tr><td>M002</td><td>Bob Johnson</td></tr>
                    <tr><td>M003</td><td>Carol Brown</td></tr>
                    <tr><td>M004</td><td>David Wilson</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Book Book Table</h5>
                <table class="data-table" id="book-table-41">
                  <thead>
                    <tr><th>isbn</th><th>title</th><th>publisher</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>978-1-25</td><td>Database Systems</td><td>McGraw-Hill</td></tr>
                    <tr><td>978-1-26</td><td>Data Structures</td><td>McGraw-Hill</td></tr>
                    <tr><td>978-1-27</td><td>Algorithms</td><td>McGraw-Hill</td></tr>
                    <tr><td>978-2-01</td><td>Networks</td><td>Pearson</td></tr>
                    <tr><td>978-2-02</td><td>Operating Systems</td><td>Wiley</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Borrowed Borrowed Table</h5>
                <table class="data-table" id="borrowed-table-41">
                  <thead>
                    <tr><th>memb_no</th><th>isbn</th><th>date</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>M001</td><td>978-1-25</td><td>2023-10-01</td></tr>
                    <tr><td>M001</td><td>978-1-26</td><td>2023-10-02</td></tr>
                    <tr><td>M001</td><td>978-1-27</td><td>2023-10-03</td></tr>
                    <tr><td>M002</td><td>978-1-25</td><td>2023-10-04</td></tr>
                    <tr><td>M002</td><td>978-1-26</td><td>2023-10-05</td></tr>
                    <tr><td>M003</td><td>978-1-26</td><td>2023-10-06</td></tr>
                    <tr><td>M003</td><td>978-2-01</td><td>2023-10-07</td></tr>
                    <tr><td>M004</td><td>978-1-25</td><td>2023-10-08</td></tr>
                    <tr><td>M004</td><td>978-1-26</td><td>2023-10-09</td></tr>
                    <tr><td>M004</td><td>978-1-27</td><td>2023-10-10</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="result-table-container-41">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;

        Problem41.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;

        // Update step indicators
        document.querySelectorAll('#content-problem4-4-1 .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        document.querySelector('#content-problem4-4-1 .current-step').textContent = step;

        // Clear previous highlights
        document.querySelectorAll('#content-problem4-4-1 table td, #content-problem4-4-1 table tr').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });

        const resultContainer = document.querySelector('#content-problem4-4-1 #result-table-container-41');

        switch(step) {
          case 1: Problem41.showBasicConcept(); break;
          case 2: Problem41.showInnerNotExists(); break;
          case 3: Problem41.showOuterNotExists(); break;
          case 4: Problem41.showCompleteSQL(); break;
          case 5: Problem41.showFinalResult(); break;
        }
      }

      static showBasicConcept() {
        const resultContainer = document.querySelector('#content-problem4-4-1 #result-table-container-41');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 1: Relational Division SQL Concept</h4>
            <p style="margin: 10px 0; color: #666;">
              <strong>Relational Algebra:</strong><br>
              <code class="algebra-expr">Borrowed ÷ McGraw-Hill books = {Members who borrowed all McGraw-Hill books}</code>
            </p>
          </div>

          <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px auto; max-width: 900px;">
            <h5 style="color: #1976d2; margin-bottom: 15px;">SQLDouble Negation Logic</h5>
            <div style="text-align: left;">
              <p style="margin: 10px 0;"><strong>Problem Conversion:</strong></p>
              <ul style="margin: 10px 0 10px 20px;">
                <li>Original: Find members who borrowed all McGraw-Hill books</li>
                <li>Conversion: Find members for whom <span style="color: #d32f2f;">there does not exist</span> a McGraw-Hill book that they <span style="color: #d32f2f;">did not borrow</span></li>
                <li>SQL: NOT EXISTS (McGraw-Hill books WHERE NOT EXISTS (borrowed by this member))</li>
              </ul>

              <p style="margin: 15px 0 10px 0;"><strong>Why Use Double Negation?</strong></p>
              <ul style="margin: 10px 0 10px 20px;">
                <li>SQL does not have a direct "FOR ALL" quantifier</li>
                <li>But has EXISTS and NOT EXISTS</li>
                <li>Mathematical Equivalence:∀x P(x) ≡ ¬∃x ¬P(x)</li>
              </ul>
            </div>
          </div>

          <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #333; margin-bottom: 10px;">SQL Structure Preview</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #1976d2;">SELECT M.memb_no, M.name
FROM Member M
WHERE NOT EXISTS (
  -- There does not exist such a McGraw-Hill book
  SELECT *
  FROM Book B
  WHERE B.publisher = 'McGraw-Hill'
   AND NOT EXISTS (
    -- This member did not borrow this book
    SELECT *
    FROM Borrowed BR
    WHERE BR.memb_no = M.memb_no
     AND BR.isbn = B.isbn
   )
)</code></pre>
          </div>
        `;
      }

      static showInnerNotExists() {
        const resultContainer = document.querySelector('#content-problem4-4-1 #result-table-container-41');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 2: Inner NOT EXISTS - Find Specific Pilot Certification</h4>
            <p style="margin: 10px 0; color: #666;">
              Check if Pilot P has certification for Aircraft A
            </p>
          </div>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #856404;">Inner Query Logic</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #856404;">-- For Pilot Alice (101) and Aircraft Boeing 747 (1)
SELECT *
FROM Certified C
WHERE C.eid = 101
 AND C.aid = 1
-- Result:Records exist → NOT EXISTS returns FALSE → Alice can be certified for Boeing 747</code></pre>
          </div>

          <table class="data-table" style="margin: 20px auto;">
            <thead>
              <tr>
                <th>Pilot</th>
                <th>Aircraft</th>
                <th>Has Certification</th>
                <th>NOT EXISTSResult</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>Alice(101)</td><td>Boeing 747(1)</td><td>✓ Yes</td><td>FALSE</td></tr>
              <tr class="highlight-step1"><td>Alice(101)</td><td>Airbus A320(2)</td><td>✓ Yes</td><td>FALSE</td></tr>
              <tr class="highlight-step1"><td>Alice(101)</td><td>Boeing 777(3)</td><td>✓ Yes</td><td>FALSE</td></tr>
              <tr class="highlight-step2"><td>Bob(102)</td><td>Boeing 747(1)</td><td>✓ Yes</td><td>FALSE</td></tr>
              <tr class="highlight-step2"><td>Bob(102)</td><td>Airbus A320(2)</td><td>✓ Yes</td><td>FALSE</td></tr>
              <tr class="highlight-missing"><td>Bob(102)</td><td>Boeing 777(3)</td><td>✗ No</td><td>TRUE</td></tr>
            </tbody>
          </table>

          <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <strong>Key Understanding:</strong>
            <ul style="margin: 10px 0;">
              <li>Inner NOT EXISTS checks"PilotPcannot be certified forAircraftA"</li>
              <li>If certification records are found, NOT EXISTS returns FALSE(Can be certified for)</li>
              <li>If no certification records exist, NOT EXISTS returns TRUE(cannot be certified for)</li>
            </ul>
          </div>
        `;
      }

      static showOuterNotExists() {
        const resultContainer = document.querySelector('#content-problem4-4-1 #result-table-container-41');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 3: Outer NOT EXISTS - Check All Aircraft</h4>
            <p style="margin: 10px 0; color: #666;">
              Find pilots for whom there does not exist an aircraft they cannot be certified for
            </p>
          </div>

          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #1565c0;">Outer Query Logic</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #1565c0;">-- For Pilot Alice(101)
SELECT *
FROM Aircraft A
WHERE NOT EXISTS (
  -- Does Alice have certification for this aircraft?
  SELECT * FROM Certified C
  WHERE C.eid = 101 AND C.aid = A.aid
)
-- Result:No aircraft found that Alice cannot be certified for → Outer NOT EXISTS returns TRUE</code></pre>
          </div>

          <table class="data-table" style="margin: 20px auto;">
            <thead>
              <tr>
                <th>Pilot</th>
                <th>cannot be certified for aircraft</th>
                <th>Outer NOT EXISTS</th>
                <th>Conclusion</th>
              </tr>
            </thead>
            <tbody>
              <tr class="highlight-step1"><td>Alice(101)</td><td>None</td><td>TRUE</td><td>✓ Can be certified for all aircraft</td></tr>
              <tr class="highlight-missing"><td>Bob(102)</td><td>Boeing 777</td><td>FALSE</td><td>✗ Cannot be certified for all aircraft</td></tr>
              <tr class="highlight-missing"><td>Carol(103)</td><td>Boeing 747</td><td>FALSE</td><td>✗ Cannot be certified for all aircraft</td></tr>
              <tr class="highlight-step1"><td>David(104)</td><td>None</td><td>TRUE</td><td>✓ Can be certified for all aircraft</td></tr>
            </tbody>
          </table>

          <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <strong>Double Negation Magic:</strong>
            <ul style="margin: 10px 0;">
              <li><strong>Inner NOT EXISTS</strong>:Find aircraft that pilot cannot be certified for</li>
              <li><strong>Outer NOT EXISTS</strong>:Confirm no such aircraft exists</li>
              <li><strong>Combined Effect</strong>:FindCan be certified for all aircraft Pilots</li>
            </ul>
          </div>
        `;
      }

      static showCompleteSQL() {
        const resultContainer = document.querySelector('#content-problem4-4-1 #result-table-container-41');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 4:Complete SQL Implementation</h4>
            <p style="margin: 10px 0; color: #666;">
              Combine double NOT EXISTS into complete SQL query
            </p>
          </div>

          <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #333; margin-bottom: 15px;">Complete SQL Query</h5>
            <pre style="background: white; padding: 20px; border-radius: 5px; overflow-x: auto; font-size: 14px;">
<code style="color: #1976d2;">-- FindCan be certified for all aircraft Pilots
SELECT P.eid, P.ename
FROM Pilots P
WHERE NOT EXISTS (
  -- There does not exist such an aircraft
  SELECT *
  FROM Aircraft A
  WHERE NOT EXISTS (
    -- This pilot does not have certification for this aircraft
    SELECT *
    FROM Certified C
    WHERE C.eid = P.eid
     AND C.aid = A.aid
  )
)
ORDER BY P.eid;</code></pre>
          </div>

          <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #2e7d32; margin-bottom: 15px;">Execution Process Trace</h5>
            <div style="background: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 13px;">
              <div style="margin-bottom: 15px;">
                <strong>Check Alice(101):</strong><br>
                &nbsp;&nbsp;→ Check Aircraft 1: Has certification ✓<br>
                &nbsp;&nbsp;→ Check Aircraft 2: Has certification ✓<br>
                &nbsp;&nbsp;→ Check Aircraft 3: Has certification ✓<br>
                &nbsp;&nbsp;<span style="color: #2e7d32;">→ Result: Include in final result ✓</span>
              </div>
              <div style="margin-bottom: 15px;">
                <strong>Check Bob(102):</strong><br>
                &nbsp;&nbsp;→ Check Aircraft 1: Has certification ✓<br>
                &nbsp;&nbsp;→ Check Aircraft 2: Has certification ✓<br>
                &nbsp;&nbsp;→ Check Aircraft 3: <span style="color: #d32f2f;">No certification ✗</span><br>
                &nbsp;&nbsp;<span style="color: #d32f2f;">→ Result: Not included in final result ✗</span>
              </div>
            </div>
          </div>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #856404;">Performance Optimization Tips</h5>
            <ul style="margin: 10px 0;">
              <li><strong>Index Optimization</strong>:on Certified(eid, aid)create composite index</li>
              <li><strong>Alternative Method 1</strong>:Use GROUP BY + HAVING COUNT</li>
              <li><strong>Alternative Method 2</strong>:Use EXCEPT/MINUS operator(if supported)</li>
            </ul>
          </div>
        `;
      }

      static showFinalResult() {
        const resultContainer = document.querySelector('#content-problem4-4-1 #result-table-container-41');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 5:Final Result with Alternative Methods</h4>
            <p style="margin: 10px 0; color: #666;">
              Query execution results and other SQL implementation methods
            </p>
          </div>

          <table class="data-table" style="margin: 20px auto; background: #d4edda;">
            <thead>
              <tr>
                <th>eid</th>
                <th>ename</th>
                <th>Number of Certified Aircraft</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>101</td><td>Alice</td><td>3/3</td><td>✓ Can be certified for all aircraft</td></tr>
              <tr class="result-row"><td>104</td><td>David</td><td>3/3</td><td>✓ Can be certified for all aircraft</td></tr>
            </tbody>
          </table>

          <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #1565c0; margin-bottom: 15px;">Alternative SQL Implementation Methods</h5>

            <div style="margin-bottom: 20px;">
              <h6 style="color: #333; margin-bottom: 10px;">Method 1:GROUP BY + HAVING</h6>
              <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #6a1b9a;">SELECT P.eid, P.ename
FROM Pilots P
JOIN Certified C ON P.eid = C.eid
GROUP BY P.eid, P.ename
HAVING COUNT(DISTINCT C.aid) = (SELECT COUNT(*) FROM Aircraft);</code></pre>
            </div>

            <div style="margin-bottom: 20px;">
              <h6 style="color: #333; margin-bottom: 10px;">Method 2:Use EXCEPT (PostgreSQL/SQL Server)</h6>
              <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #00695c;">SELECT P.eid, P.ename
FROM Pilots P
WHERE NOT EXISTS (
  SELECT aid FROM Aircraft
  EXCEPT
  SELECT aid FROM Certified WHERE eid = P.eid
);</code></pre>
            </div>

            <div>
              <h6 style="color: #333; margin-bottom: 10px;">Method 3:Use LEFT JOIN</h6>
              <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #e65100;">SELECT P.eid, P.ename
FROM Pilots P
WHERE P.eid IN (
  SELECT C.eid
  FROM Certified C
  RIGHT JOIN Aircraft A ON C.aid = A.aid AND C.eid = P.eid
  GROUP BY C.eid
  HAVING COUNT(C.aid) = COUNT(A.aid)
);</code></pre>
            </div>
          </div>

          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-top: 20px; color: #155724;">
            <strong>SQL Relational Division Summary:</strong>
            <ul style="margin: 10px 0; text-align: left;">
              <li><strong>Double NOT EXISTS</strong>:Most universal method, supported by all SQL databases</li>
              <li><strong>GROUP BY Method</strong>:Simple and intuitive, but requires knowing the total</li>
              <li><strong>EXCEPT Method</strong>:Closest to relational algebra, but not supported by all databases</li>
              <li><strong>Performance Considerations</strong>:Select optimal method based on data distribution and index configuration</li>
            </ul>
            <p style="margin-top: 15px; text-align: center; font-weight: bold;">
              SQL successfully implements relational algebra division operation
            </p>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem41.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem41.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem41.showStep(Math.min(5, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem41.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem41.keyboardHandler) {
          document.removeEventListener('keydown', Problem41.keyboardHandler);
          Problem41.keyboardHandler = null;
        }
      }
    }

    // Problem 4.2: Temporal Data Aggregation with SQL
    class Problem42 {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem4-4-2 .step-controls');
        Problem42.addKeyboardListener();
        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem42.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem42.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem42.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem42.showStep(4)">Step4</button>
            <button class="step-btn" onclick="Problem42.showStep(5)">Step5</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
          </div>
          <div class="step-description">
            SQL Time Series Aggregation: Count Monthly Appointments in 2023
          </div>
        `;

        const contentArea = document.querySelector('#content-problem4-4-2 .content-area');
        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 4.2: SQL Time Series Aggregation</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Problem 4.2 - Count monthly appointments in 2023<br>
              <strong>Key point:</strong>Demonstrate the use of PostgreSQL date functions, GROUP BY, and aggregation functions<br>
              <strong>Data Type:</strong>appointment_datetime Uses TIMESTAMP type
            </p>
          </div>
          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <table class="data-table" id="appointments-table-42">
              <thead>
                <tr><th>appointment_id</th><th>appointment_datetime</th><th>status</th></tr>
              </thead>
              <tbody>
                <tr><td>301</td><td>2023-01-15 09:00:00</td><td>Completed</td></tr>
                <tr><td>302</td><td>2023-01-22 10:30:00</td><td>Completed</td></tr>
                <tr><td>303</td><td>2023-02-05 14:00:00</td><td>Completed</td></tr>
                <tr><td>304</td><td>2023-03-01 11:00:00</td><td>Completed</td></tr>
                <tr><td>305</td><td>2023-04-10 10:00:00</td><td>Completed</td></tr>
              </tbody>
            </table>
          </div>
          <div id="result-table-container-42">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;
        Problem42.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;
        document.querySelectorAll('#content-problem4-4-2 .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });
        document.querySelector('#content-problem4-4-2 .current-step').textContent = step;

        const resultContainer = document.querySelector('#content-problem4-4-2 #result-table-container-42');
        switch(step) {
          case 1: Problem42.showDateExtraction(); break;
          case 2: Problem42.showGroupByMonth(); break;
          case 3: Problem42.showCountAggregation(); break;
          case 4: Problem42.showCompleteQuery(); break;
          case 5: Problem42.showResults(); break;
        }
      }

      static showDateExtraction() {
        const resultContainer = document.querySelector('#content-problem4-4-2 #result-table-container-42');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 1: Date Extraction Functions</h4>
            <p>Use PostgreSQL date functions to extract year and month</p>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px auto; font-size: 14px;">
              <strong>PostgreSQL vs MySQL:</strong><br>
              • PostgreSQL: <code>EXTRACT(YEAR FROM date)</code><br>
              • MySQL: <code>YEAR(date)</code><br>
              • PostgreSQL: <code>TIMESTAMP</code> Type<br>
              • MySQL: <code>DATETIME</code> Type
            </div>
          </div>
          <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
<code>-- PostgreSQL Syntax
SELECT
  appointment_id,
  EXTRACT(YEAR FROM appointment_datetime) AS year_part,
  EXTRACT(MONTH FROM appointment_datetime) AS month_part
FROM Appointments
WHERE EXTRACT(YEAR FROM appointment_datetime) = 2023;</code></pre>
        `;
      }

      static showGroupByMonth() {
        const resultContainer = document.querySelector('#content-problem4-4-2 #result-table-container-42');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 2: Group by Month</h4>
            <p>Use GROUP BY to group appointment records by year and month</p>
          </div>
          <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px;">
<code>-- PostgreSQL GROUP BY Syntax
SELECT
  EXTRACT(YEAR FROM appointment_datetime) AS appt_year,
  EXTRACT(MONTH FROM appointment_datetime) AS appt_month
FROM Appointments
WHERE EXTRACT(YEAR FROM appointment_datetime) = 2023
GROUP BY EXTRACT(YEAR FROM appointment_datetime),
     EXTRACT(MONTH FROM appointment_datetime);</code></pre>
        `;
      }

      static showCountAggregation() {
        const resultContainer = document.querySelector('#content-problem4-4-2 #result-table-container-42');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 3: COUNT Aggregation Function</h4>
            <p>Count appointments within each month group</p>
          </div>
          <table class="data-table" style="margin: 20px auto;">
            <thead>
              <tr><th>Month</th><th>Appointment Count</th></tr>
            </thead>
            <tbody>
              <tr><td>2023-01</td><td>2</td></tr>
              <tr><td>2023-02</td><td>1</td></tr>
              <tr><td>2023-03</td><td>1</td></tr>
              <tr><td>2023-04</td><td>1</td></tr>
            </tbody>
          </table>
        `;
      }

      static showCompleteQuery() {
        const resultContainer = document.querySelector('#content-problem4-4-2 #result-table-container-42');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 4: Complete PostgreSQL Query</h4>
            <p style="margin: 10px 0; color: #666;">
              Use PostgreSQL-specific date formatting and type conversion
            </p>
          </div>
          <pre style="background: #f5f5f5; padding: 20px; border-radius: 5px; font-size: 14px;">
<code style="color: #1976d2;">-- PostgreSQL Complete Query
SELECT
  EXTRACT(YEAR FROM appointment_datetime) AS year,
  EXTRACT(MONTH FROM appointment_datetime) AS month,
  TO_CHAR(appointment_datetime, 'Month') AS month_name,
  COUNT(*) AS appointment_count
FROM Appointments
WHERE appointment_datetime >= '2023-01-01'::DATE
 AND appointment_datetime < '2024-01-01'::DATE
GROUP BY EXTRACT(YEAR FROM appointment_datetime),
     EXTRACT(MONTH FROM appointment_datetime),
     TO_CHAR(appointment_datetime, 'Month')
ORDER BY year, month;</code></pre>

          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #1565c0;">PostgreSQL Alternative Syntax</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px;">
<code style="color: #1565c0;">-- Use DATE_TRUNC function (PostgreSQL-specific)
SELECT
  DATE_TRUNC('month', appointment_datetime) AS month_start,
  TO_CHAR(appointment_datetime, 'YYYY-MM') AS year_month,
  COUNT(*) AS appointment_count
FROM Appointments
WHERE appointment_datetime BETWEEN '2023-01-01' AND '2023-12-31'
GROUP BY DATE_TRUNC('month', appointment_datetime),
     TO_CHAR(appointment_datetime, 'YYYY-MM')
ORDER BY month_start;</code></pre>
          </div>
        `;
      }

      static showResults() {
        const resultContainer = document.querySelector('#content-problem4-4-2 #result-table-container-42');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 5: Query Results</h4>
          </div>
          <table class="data-table" style="margin: 20px auto; background: #d4edda;">
            <thead>
              <tr><th>Year</th><th>Month</th><th>Month Name</th><th>Appointment Count</th></tr>
            </thead>
            <tbody>
              <tr class="result-row"><td>2023</td><td>1</td><td>January</td><td>2</td></tr>
              <tr class="result-row"><td>2023</td><td>2</td><td>February</td><td>1</td></tr>
              <tr class="result-row"><td>2023</td><td>3</td><td>March</td><td>1</td></tr>
              <tr class="result-row"><td>2023</td><td>4</td><td>April</td><td>1</td></tr>
            </tbody>
          </table>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h6 style="color: #856404; margin-bottom: 10px;">🔍 PostgreSQL-Specific Features</h6>
            <ul style="margin: 0; font-size: 14px;">
              <li><strong>EXTRACT():</strong> Standard SQL, good compatibility</li>
              <li><strong>DATE_TRUNC():</strong> PostgreSQL-specific, very powerful</li>
              <li><strong>TO_CHAR():</strong> Flexible date formatting</li>
              <li><strong>::DATE:</strong> PostgreSQL type conversion syntax</li>
              <li><strong>TIMESTAMP:</strong> Timestamp accurate to microseconds</li>
            </ul>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem42.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem42.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem42.showStep(Math.min(6, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem42.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem42.keyboardHandler) {
          document.removeEventListener('keydown', Problem42.keyboardHandler);
          Problem42.keyboardHandler = null;
        }
      }
    }

    // Problem 4.3: NOT EXISTS and Date Filtering
    class Problem43 {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem4-4-3 .step-controls');
        Problem43.addKeyboardListener();
        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn" onclick="Problem43.showStep(1)">Step1</button>
            <button class="step-btn" onclick="Problem43.showStep(2)">Step2</button>
            <button class="step-btn" onclick="Problem43.showStep(3)">Step3</button>
            <button class="step-btn" onclick="Problem43.showStep(4)">Step4</button>
            <button class="step-btn" onclick="Problem43.showStep(5)">Step5</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
          </div>
          <div class="step-description">
            NOT EXISTS Query: Find Doctors Without Appointments in Last 30 Days
          </div>
        `;

        const contentArea = document.querySelector('#content-problem4-4-3 .content-area');
        contentArea.innerHTML = `
          <div class="problem-header">
            <h3>Problem 4.3: NOT EXISTS Query</h3>
            <p class="problem-description">
              <strong>Problem:</strong>Problem 4.3 - Find doctors without appointments in the last 30 days<br>
              <strong>Key point:</strong>Demonstrate the use of NOT EXISTS, date calculation, and subquery combinations<br>
              <strong>Challenge:</strong>Handle "does not exist" logic and date range filtering
            </p>
          </div>

          <div class="schema-info">
            <h4>📋 Related Table Structure</h4>
            <div class="schema-grid">
              <div class="schema-table">
                <h5>Doctors (Doctors Table)</h5>
                <ul>
                  <li><strong>doctor_id</strong> - Doctor ID (PK)</li>
                  <li><strong>name</strong> - Doctor Name</li>
                  <li><strong>specialization</strong> - Major</li>
                  <li><strong>department_id</strong> - Department ID (FK)</li>
                </ul>
              </div>
              <div class="schema-table">
                <h5>Appointments (Appointments Table)</h5>
                <ul>
                  <li><strong>appointment_id</strong> - Appointment ID (PK)</li>
                  <li><strong>doctor_id</strong> - Doctor ID (FK)</li>
                  <li><strong>appointment_datetime</strong> - Appointment Time</li>
                  <li><strong>status</strong> - Appointment Status</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="table-container">
            <h4>📊 Sample Data</h4>
            <div class="data-tables-grid">
              <div class="data-table-wrapper">
                <h5>Doctors Doctors Table</h5>
                <table class="data-table" id="doctors-table-43">
                  <thead>
                    <tr><th>doctor_id</th><th>name</th><th>specialization</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>201</td><td>Dr. Alice Smith</td><td>Cardiologist</td></tr>
                    <tr><td>202</td><td>Dr. Bob Johnson</td><td>Neurologist</td></tr>
                    <tr><td>203</td><td>Dr. Eva Lee</td><td>Cardiologist</td></tr>
                    <tr><td>204</td><td>Dr. Mike Wilson</td><td>Orthopedist</td></tr>
                    <tr><td>205</td><td>Dr. Sarah Davis</td><td>Dermatologist</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="data-table-wrapper">
                <h5>Appointments Appointments Table (Last 30 Days)</h5>
                <table class="data-table" id="appointments-table-43">
                  <thead>
                    <tr><th>appointment_id</th><th>doctor_id</th><th>appointment_datetime</th><th>status</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>301</td><td>201</td><td>2023-12-01 09:00:00</td><td>Completed</td></tr>
                    <tr><td>302</td><td>202</td><td>2023-12-05 10:30:00</td><td>Completed</td></tr>
                    <tr><td>303</td><td>203</td><td>2023-11-20 14:00:00</td><td>Completed</td></tr>
                    <tr><td>304</td><td>201</td><td>2023-12-10 15:00:00</td><td>Scheduled</td></tr>
                  </tbody>
                </table>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                  Assume current date is 2023-12-15, Last 30 days is 2023-11-15 onwards
                </p>
              </div>
            </div>
          </div>

          <div id="result-table-container-43">
            <!-- Dynamic results will be inserted here -->
          </div>
        `;
        Problem43.showStep(1);
      }

      static showStep(step) {
        AppState.currentStep = step;
        document.querySelectorAll('#content-problem4-4-3 .step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });
        document.querySelector('#content-problem4-4-3 .current-step').textContent = step;
        document.querySelectorAll('#content-problem4-4-3 table td, #content-problem4-4-3 table tr').forEach(el => {
          el.className = el.className.replace(/highlight-\w+/g, '');
        });

        const resultContainer = document.querySelector('#content-problem4-4-3 #result-table-container-43');
        switch(step) {
          case 1: Problem43.showDateCalculation(); break;
          case 2: Problem43.showInnerSubquery(); break;
          case 3: Problem43.showNotExists(); break;
          case 4: Problem43.showCompleteQuery(); break;
          case 5: Problem43.showResults(); break;
        }
      }

      static showDateCalculation() {
        const resultContainer = document.querySelector('#content-problem4-4-3 #result-table-container-43');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 1: Date Calculation and Range Determination</h4>
            <p style="margin: 10px 0; color: #666;">
              Calculate"Last 30 Days" date range
            </p>
          </div>

          <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #1976d2; margin-bottom: 15px;">PostgreSQL Date Calculation</h5>
            <div style="text-align: left;">
              <p style="margin: 10px 0;"><strong>Key Functions:</strong></p>
              <ul style="margin: 10px 0 10px 20px;">
                <li><strong>CURRENT_DATE</strong> - Get current date</li>
                <li><strong>CURRENT_TIMESTAMP</strong> - Get current timestamp</li>
                <li><strong>INTERVAL '30 days'</strong> - Time interval</li>
                <li><strong>DATE - INTERVAL</strong> - Date subtraction</li>
              </ul>
            </div>
          </div>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #856404;">Date Range Calculation Examples</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #856404;">-- CalculateLast 30 Days date range
SELECT
  CURRENT_DATE AS today,
  CURRENT_DATE - INTERVAL '30 days' AS thirty_days_ago,
  CURRENT_TIMESTAMP AS now,
  CURRENT_TIMESTAMP - INTERVAL '30 days' AS thirty_days_ago_time;

-- Example Result (assuming today is 2023-12-15)
-- today: 2023-12-15
-- thirty_days_ago: 2023-11-15
-- now: 2023-12-15 14:30:00
-- thirty_days_ago_time: 2023-11-15 14:30:00</code></pre>
          </div>

          <div style="display: flex; gap: 20px; margin: 20px auto; max-width: 800px;">
            <div style="flex: 1; background: #e8f5e9; padding: 15px; border-radius: 8px;">
              <h6 style="color: #2e7d32; margin-bottom: 10px;">✅ Last 30 Dayswith appointments</h6>
              <table class="data-table" style="font-size: 12px;">
                <thead>
                  <tr><th>Doctor</th><th>Last Appointment Date</th></tr>
                </thead>
                <tbody>
                  <tr class="highlight-step1"><td>Dr. Alice (201)</td><td>2023-12-10</td></tr>
                  <tr class="highlight-step1"><td>Dr. Bob (202)</td><td>2023-12-05</td></tr>
                </tbody>
              </table>
            </div>
            <div style="flex: 1; background: #ffebee; padding: 15px; border-radius: 8px;">
              <h6 style="color: #c62828; margin-bottom: 10px;">❌ No Appointments in 30 Days</h6>
              <table class="data-table" style="font-size: 12px;">
                <thead>
                  <tr><th>Doctor</th><th>Last Appointment Date</th></tr>
                </thead>
                <tbody>
                  <tr class="highlight-missing"><td>Dr. Eva (203)</td><td>2023-11-20</td></tr>
                  <tr class="highlight-missing"><td>Dr. Mike (204)</td><td>No Appointments</td></tr>
                  <tr class="highlight-missing"><td>Dr. Sarah (205)</td><td>No Appointments</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <strong>Analysis:</strong>
            <ul style="margin: 10px 0;">
              <li>Current Date:2023-12-15</li>
              <li>Date 30 Days Ago:2023-11-15</li>
              <li>Need to find doctors without appointments in this range Doctor</li>
            </ul>
          </div>
        `;
      }

      static showInnerSubquery() {
        const resultContainer = document.querySelector('#content-problem4-4-3 #result-table-container-43');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 2: Construct Inner Subquery</h4>
            <p style="margin: 10px 0; color: #666;">
              For each doctor find last 30 days appointment records
            </p>
          </div>

          <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #7b1fa2;">Inner Subquery Logic</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #7b1fa2;">-- Inner subquery: Check specific doctor in last 30 days appointments
SELECT *
FROM Appointments A
WHERE A.doctor_id = D.doctor_id -- Correlate with outer query Doctor
 AND A.appointment_datetime >= CURRENT_DATE - INTERVAL '30 days'</code></pre>
          </div>

          <div style="margin: 20px auto;">
            <h5 style="color: #333; text-align: center;">Subquery Execution Example</h5>

            <div style="display: flex; gap: 15px; margin: 15px auto; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 300px; background: #e8f5e9; padding: 10px; border-radius: 5px;">
                <h6 style="color: #2e7d32;">Doctor 201 (Dr. Alice) Subquery Result</h6>
                <table class="data-table" style="font-size: 11px;">
                  <thead><tr><th>appointment_id</th><th>date</th><th>status</th></tr></thead>
                  <tbody>
                    <tr class="highlight-step1"><td>301</td><td>2023-12-01</td><td>Completed</td></tr>
                    <tr class="highlight-step1"><td>304</td><td>2023-12-10</td><td>Scheduled</td></tr>
                  </tbody>
                </table>
                <p style="font-size: 10px; color: #2e7d32;"><strong>Result:</strong> Has records → EXISTS returns TRUE</p>
              </div>

              <div style="flex: 1; min-width: 300px; background: #ffebee; padding: 10px; border-radius: 5px;">
                <h6 style="color: #c62828;">Doctor 204 (Dr. Mike) Subquery Result</h6>
                <table class="data-table" style="font-size: 11px;">
                  <thead><tr><th>appointment_id</th><th>date</th><th>status</th></tr></thead>
                  <tbody>
                    <tr><td colspan="3" style="text-align: center; font-style: italic;">No records</td></tr>
                  </tbody>
                </table>
                <p style="font-size: 10px; color: #c62828;"><strong>Result:</strong> No records → EXISTS returns FALSE</p>
              </div>
            </div>
          </div>

          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <strong>Subquery Working Principle:</strong>
            <ol style="margin: 10px 0; padding-left: 20px;">
              <li><strong>Correlated Subquery</strong>:Inner query references outer query fields (D.doctor_id)</li>
              <li><strong>Dynamic Execution</strong>:For each row in outer query, inner query re-executes</li>
              <li><strong>Condition Filtering</strong>:Only return last 30 days appointment records</li>
              <li><strong>EXISTS Judgment</strong>:Check if subquery returns any rows</li>
            </ol>
          </div>
        `;
      }

      static showNotExists() {
        const resultContainer = document.querySelector('#content-problem4-4-3 #result-table-container-43');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 3:NOT EXISTS Logic</h4>
            <p style="margin: 10px 0; color: #666;">
              Use NOT EXISTS to find doctors without records meeting conditions
            </p>
          </div>

          <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #2e7d32;">NOT EXISTS Concept</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto;">
<code style="color: #2e7d32;">-- NOT EXISTS Basic Structure
SELECT D.doctor_id, D.name
FROM Doctors D
WHERE NOT EXISTS (
  -- Subquery: Find this doctor's last 30 days appointments
  SELECT 1
  FROM Appointments A
  WHERE A.doctor_id = D.doctor_id
   AND A.appointment_datetime >= CURRENT_DATE - INTERVAL '30 days'
)</code></pre>
          </div>

          <div style="margin: 20px auto;">
            <h5 style="color: #333; text-align: center;">NOT EXISTS Execution Process</h5>
            <table class="data-table" style="margin: 20px auto;">
              <thead>
                <tr>
                  <th>Doctor</th>
                  <th>Subquery Result</th>
                  <th>EXISTS</th>
                  <th>NOT EXISTS</th>
                  <th>Include in Result</th>
                </tr>
              </thead>
              <tbody>
                <tr class="highlight-step2">
                  <td>Dr. Alice (201)</td>
                  <td>2records</td>
                  <td>TRUE</td>
                  <td style="color: #d32f2f;">FALSE</td>
                  <td style="color: #d32f2f;">❌ Not included</td>
                </tr>
                <tr class="highlight-step2">
                  <td>Dr. Bob (202)</td>
                  <td>1records</td>
                  <td>TRUE</td>
                  <td style="color: #d32f2f;">FALSE</td>
                  <td style="color: #d32f2f;">❌ Not included</td>
                </tr>
                <tr class="highlight-step2">
                  <td>Dr. Eva (203)</td>
                  <td>0records*</td>
                  <td>FALSE</td>
                  <td style="color: #388e3c;">TRUE</td>
                  <td style="color: #388e3c;">✅ Include</td>
                </tr>
                <tr class="highlight-step1">
                  <td>Dr. Mike (204)</td>
                  <td>0records</td>
                  <td>FALSE</td>
                  <td style="color: #388e3c;">TRUE</td>
                  <td style="color: #388e3c;">✅ Include</td>
                </tr>
                <tr class="highlight-step1">
                  <td>Dr. Sarah (205)</td>
                  <td>0records</td>
                  <td>FALSE</td>
                  <td style="color: #388e3c;">TRUE</td>
                  <td style="color: #388e3c;">✅ Include</td>
                </tr>
              </tbody>
            </table>
            <p style="font-size: 12px; color: #666; text-align: center; margin-top: 10px;">
              *Dr. EvaHas appointments but not in last 30 days (2023-11-20 < 2023-11-15)
            </p>
          </div>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <strong>NOT EXISTS vs LEFT JOIN:</strong>
            <ul style="margin: 10px 0;">
              <li><strong>NOT EXISTS</strong>: Pure logical judgment, only cares if exists</li>
              <li><strong>LEFT JOIN + IS NULL</strong>: Can get more related information</li>
              <li><strong>Performance</strong>: NOT EXISTSUsually stops after finding first match</li>
              <li><strong>Readability</strong>: NOT EXISTSMore intuitively expresses "does not exist" semantics</li>
            </ul>
          </div>
        `;
      }

      static showCompleteQuery() {
        const resultContainer = document.querySelector('#content-problem4-4-3 #result-table-container-43');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 4:Complete Query Implementation</h4>
            <p style="margin: 10px 0; color: #666;">
              Combine date calculation, subquery, and NOT EXISTS into complete SQL
            </p>
          </div>

          <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #333; margin-bottom: 15px;">Complete PostgreSQL Query</h5>
            <pre style="background: white; padding: 20px; border-radius: 5px; overflow-x: auto; font-size: 14px;">
<code style="color: #1976d2;">-- Problem 4.3: Find doctors with no appointments in last 30 days
SELECT
  D.doctor_id,
  D.name,
  D.specialization,
  DEPT.department_name
FROM Doctors D
JOIN Departments DEPT ON D.department_id = DEPT.department_id
WHERE NOT EXISTS (
  SELECT 1
  FROM Appointments A
  WHERE A.doctor_id = D.doctor_id
   AND A.appointment_datetime >= CURRENT_DATE - INTERVAL '30 days'
   AND A.status != 'Cancelled' -- Exclude cancelled appointments
)
ORDER BY D.specialization, D.name;</code></pre>
          </div>

          <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #1565c0;">Optimized Query Version</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px;">
<code style="color: #1565c0;">-- Use specific date instead of CURRENT_DATE (easier for testing)
SELECT
  D.doctor_id,
  D.name,
  D.specialization,
  -- Display last appointment date for verification
  (SELECT MAX(A2.appointment_datetime)
   FROM Appointments A2
   WHERE A2.doctor_id = D.doctor_id) AS last_appointment
FROM Doctors D
WHERE NOT EXISTS (
  SELECT 1
  FROM Appointments A
  WHERE A.doctor_id = D.doctor_id
   AND A.appointment_datetime >= '2023-11-15'::DATE
);</code></pre>
          </div>

          <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h5 style="color: #7b1fa2;">LEFT JOIN Equivalent</h5>
            <pre style="background: white; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px;">
<code style="color: #7b1fa2;">-- Use LEFT JOIN to achieve same functionality
SELECT DISTINCT
  D.doctor_id,
  D.name,
  D.specialization
FROM Doctors D
LEFT JOIN Appointments A ON D.doctor_id = A.doctor_id
  AND A.appointment_datetime >= CURRENT_DATE - INTERVAL '30 days'
  AND A.status != 'Cancelled'
WHERE A.doctor_id IS NULL;</code></pre>
          </div>

          <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <strong>Query Feature Description:</strong>
            <ul style="margin: 10px 0; font-size: 14px;">
              <li><strong>JOIN Departments</strong>: Get department information, provide more complete result</li>
              <li><strong>Status Filtering</strong>: Exclude cancelled appointments, Only consider valid appointments</li>
              <li><strong>Sorting</strong>: Sort by major and name for easier viewing of results</li>
              <li><strong>date range</strong>: Use INTERVAL to ensure accurate 30-day calculation</li>
            </ul>
          </div>
        `;
      }

      static showResults() {
        const resultContainer = document.querySelector('#content-problem4-4-3 #result-table-container-43');
        resultContainer.innerHTML = `
          <div style="text-align: center; margin-bottom: 20px;">
            <h4 style="color: #17a2b8;">Step 5: Query Results Analysis</h4>
            <p style="margin: 10px 0; color: #666;">
              Final Result and Business Application Analysis
            </p>
          </div>

          <div style="margin: 20px auto;">
            <h5 style="color: #333; text-align: center; margin-bottom: 15px;">🔍 Last 30 DaysNo Appointments Doctor</h5>
            <table class="data-table" style="margin: 20px auto; background: #ffebee;">
              <thead>
                <tr>
                  <th>Doctor ID</th>
                  <th>Name</th>
                  <th>Specialization</th>
                  <th>Department</th>
                  <th>Last Appointment</th>
                </tr>
              </thead>
              <tbody>
                <tr class="result-row">
                  <td>203</td>
                  <td>Dr. Eva Lee</td>
                  <td>Cardiologist</td>
                  <td>Cardiology</td>
                  <td>2023-11-20</td>
                </tr>
                <tr class="result-row">
                  <td>205</td>
                  <td>Dr. Sarah Davis</td>
                  <td>Dermatologist</td>
                  <td>Dermatology</td>
                  <td>Never had appointments</td>
                </tr>
                <tr class="result-row">
                  <td>204</td>
                  <td>Dr. Mike Wilson</td>
                  <td>Orthopedist</td>
                  <td>Orthopedics</td>
                  <td>Never had appointments</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div style="display: flex; gap: 20px; margin: 20px auto; max-width: 1000px;">
            <div style="flex: 1; background: #e8f5e9; padding: 15px; border-radius: 8px;">
              <h6 style="color: #2e7d32; margin-bottom: 10px;">📊 Business Insights</h6>
              <ul style="margin: 0; font-size: 14px;">
                <li><strong>Dr. Eva</strong>: Has historical appointments but not recently active</li>
                <li><strong>Dr. Sarah & Mike</strong>: Newly hired or special circumstances</li>
                <li><strong>Total</strong>: 3doctors need attention</li>
                <li><strong>Ratio</strong>: 60% (3/5) DoctorNeeds follow-up</li>
              </ul>
            </div>
            <div style="flex: 1; background: #e3f2fd; padding: 15px; border-radius: 8px;">
              <h6 style="color: #1565c0; margin-bottom: 10px;">💡 Application Scenarios</h6>
              <ul style="margin: 0; font-size: 14px;">
                <li><strong>Resource Optimization</strong>: Reallocate idleDoctor</li>
                <li><strong>Performance Monitoring</strong>: Track doctor work status</li>
                <li><strong>Scheduling Adjustment</strong>: Optimize hospital scheduling</li>
                <li><strong>Training Arrangement</strong>: Arrange training for idle doctors</li>
              </ul>
            </div>
          </div>

          <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h6 style="color: #856404; margin-bottom: 10px;">⚠️ Query Precautions</h6>
            <ul style="margin: 0; font-size: 14px;">
              <li><strong>Timezone Handling</strong>: Ensure CURRENT_DATE uses correct timezone</li>
              <li><strong>Holiday Considerations</strong>: DoctorMay temporarily have no appointments due to holidays</li>
              <li><strong>Status Filtering</strong>: Whether cancelled appointments should be included in calculation</li>
              <li><strong>New Employees</strong>: Distinguish between newly hired and long-term no appointments situations</li>
              <li><strong>Index Optimization</strong>: inappointment_datetimecreate index to improve performance</li>
            </ul>
          </div>

          <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 20px auto;">
            <h6 style="color: #7b1fa2; margin-bottom: 10px;">🔧 Extended Query Examples</h6>
            <pre style="background: white; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 11px;">
<code style="color: #7b1fa2;">-- Count doctors without appointments by department
SELECT
  DEPT.department_name,
  COUNT(*) AS doctors_without_appointments
FROM Doctors D
JOIN Departments DEPT ON D.department_id = DEPT.department_id
WHERE NOT EXISTS (
  SELECT 1 FROM Appointments A
  WHERE A.doctor_id = D.doctor_id
   AND A.appointment_datetime >= CURRENT_DATE - INTERVAL '30 days'
)
GROUP BY DEPT.department_name
ORDER BY doctors_without_appointments DESC;</code></pre>
          </div>
        `;
      }

      static addKeyboardListener() {
        Problem43.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem43.showStep(Math.max(1, AppState.currentStep - 1));
          } else if (e.key === 'ArrowRight') {
            Problem43.showStep(Math.min(5, AppState.currentStep + 1));
          }
        };
        document.addEventListener('keydown', Problem43.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem43.keyboardHandler) {
          document.removeEventListener('keydown', Problem43.keyboardHandler);
          Problem43.keyboardHandler = null;
        }
      }
    }

    // Problem 4.4: Identify patients with more than one appointment on the same day
    class Problem44 {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem4-4-4 .step-controls');

        if (!container) {
          console.error('Problem44: Container not found!');
          return;
        }

        Problem44.addKeyboardListener();

        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn prev-btn" onclick="Problem44.previousStep()" disabled>← Previous</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
            <button class="step-btn next-btn" onclick="Problem44.nextStep()">Next →</button>
          </div>
          <div class="step-info">
            <h3>Problem 4.4: Identify patients with multiple appointments on the same day</h3>
            <p>Find patients with more than one appointment on the same day using GROUP BY and HAVING clauses</p>
          </div>
        `;

        Problem44.showStep1();
      }


      static addKeyboardListener() {
        Problem44.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem44.previousStep();
          } else if (e.key === 'ArrowRight') {
            Problem44.nextStep();
          }
        };
        document.addEventListener('keydown', Problem44.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem44.keyboardHandler) {
          document.removeEventListener('keydown', Problem44.keyboardHandler);
          Problem44.keyboardHandler = null;
        }
      }

      static previousStep() {
        if (AppState.currentStep > 1) {
          Problem44.showStep(AppState.currentStep - 1);
        }
      }

      static nextStep() {
        if (AppState.currentStep < 5) {
          Problem44.showStep(AppState.currentStep + 1);
        }
      }

      static showStep(step) {
        AppState.currentStep = step;
        const container = document.querySelector('#content-problem4-4-4 .step-controls');
        const indicator = container.querySelector('.step-indicator .current-step');
        const prevBtn = container.querySelector('.prev-btn');
        const nextBtn = container.querySelector('.next-btn');

        indicator.textContent = step;
        prevBtn.disabled = (step === 1);
        nextBtn.disabled = (step === 5);

        container.querySelectorAll('.step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        switch(step) {
          case 1: Problem44.showStep1(); break;
          case 2: Problem44.showStep2(); break;
          case 3: Problem44.showStep3(); break;
          case 4: Problem44.showStep4(); break;
          case 5: Problem44.showStep5(); break;
        }
      }

      static showStep1() {
        const contentArea = document.querySelector('#content-problem4-4-4 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>📊 Step 1: Understanding problem requirements</h4>
            <div class="concept-content">
              <p><strong>Goal:</strong> recognizeotheratsamedayhavemanytimeAppointmentpatient</p>
              <p><strong>closekey concept:</strong></p>
              <ul>
                <li><code>GROUP BY</code> - bypatientIDandAppointmentDateGroup</li>
                <li><code>HAVING</code> - FilterGrouping Result，Findcountnumber > 1</li>
                <li><code>DATE()</code> - ExtractDatePartialignoreTime</li>
                <li><code>COUNT(*)</code> - Calculateeachgrouprecordsnumber</li>
              </ul>

              <div class="table-container">
                <h5>📋 Appointments Tabledata:</h5>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>appointment_id</th>
                      <th>patient_id</th>
                      <th>doctor_id</th>
                      <th>appointment_datetime</th>
                      <th>status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>301</td>
                      <td>1</td>
                      <td>201</td>
                      <td>2023-10-01 09:00:00</td>
                      <td>Completed</td>
                    </tr>
                    <tr>
                      <td>302</td>
                      <td>2</td>
                      <td>202</td>
                      <td>2023-10-02 10:30:00</td>
                      <td>Scheduled</td>
                    </tr>
                    <tr class="highlight-yellow">
                      <td>303</td>
                      <td>3</td>
                      <td>203</td>
                      <td>2023-10-03 14:00:00</td>
                      <td>Completed</td>
                    </tr>
                    <tr class="highlight-yellow">
                      <td>304</td>
                      <td>3</td>
                      <td>203</td>
                      <td>2023-10-03 15:00:00</td>
                      <td>Cancelled</td>
                    </tr>
                  </tbody>
                </table>
                <p class="note">💡 attention：patient3atsameday(2023-10-03)havetwotimeAppointment</p>
              </div>
            </div>
          </div>
        `;
      }

      static showStep2() {
        const contentArea = document.querySelector('#content-problem4-4-4 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>🔢 Step 2: GROUP BY GroupLogic</h4>
            <div class="concept-content">
              <p><strong>Groupstrategy:</strong> bypatientIDandDateGroupcomestatisticsEachpatienteachdayAppointmenttimenumber</p>

              <div class="sql-container">
                <pre><code class="sql">
-- bypatientandDateGroup
SELECT
    patient_id,
    DATE(appointment_datetime) as appointment_date,
    COUNT(*) as appointments_count
FROM Appointments
GROUP BY patient_id, DATE(appointment_datetime)
                </code></pre>
              </div>

              <div class="table-container">
                <h5>📊 Grouping Result:</h5>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>patient_id</th>
                      <th>appointment_date</th>
                      <th>appointments_count</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1</td>
                      <td>2023-10-01</td>
                      <td class="highlight-blue">1</td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td>2023-10-02</td>
                      <td class="highlight-blue">1</td>
                    </tr>
                    <tr class="highlight-yellow">
                      <td>3</td>
                      <td>2023-10-03</td>
                      <td class="highlight-green">2</td>
                    </tr>
                  </tbody>
                </table>
                <p class="note">💡 patient3at2023-10-03have2timeAppointment，Needbyrecognizeotheroutcome</p>
              </div>
            </div>
          </div>
        `;
      }

      static showStep3() {
        const contentArea = document.querySelector('#content-problem4-4-4 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>🔍 Step 3: HAVING clauseFilter</h4>
            <div class="concept-content">
              <p><strong>FilterCondition:</strong> UseHAVING filteroutAppointmenttimenumberlargeat1records</p>

              <div class="comparison-container">
                <div class="comparison-item">
                  <h5>❌ WHERE vs ✅ HAVING</h5>
                  <ul>
                    <li><code>WHERE</code>: Filter rows before grouping</li>
                    <li><code>HAVING</code>: Filter groups after grouping</li>
                    <li>aggregationFunctiononlycanatHAVINGinUse</li>
                  </ul>
                </div>
              </div>

              <div class="sql-container">
                <pre><code class="sql">
SELECT
    patient_id,
    DATE(appointment_datetime) as appointment_date,
    COUNT(*) as appointments_count
FROM Appointments
GROUP BY patient_id, DATE(appointment_datetime)
<span class="highlight-green">HAVING COUNT(*) > 1</span>  -- FilteroutAppointmenttimenumber > 1group
                </code></pre>
              </div>

              <div class="table-container">
                <h5>🎯 FilterafterResult:</h5>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>patient_id</th>
                      <th>appointment_date</th>
                      <th>appointments_count</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="highlight-green">
                      <td>3</td>
                      <td>2023-10-03</td>
                      <td>2</td>
                    </tr>
                  </tbody>
                </table>
                <p class="note">✅ Successfully identifiedpatient3atsamedayhavemanytimeAppointment</p>
              </div>
            </div>
          </div>
        `;
      }

      static showStep4() {
        const contentArea = document.querySelector('#content-problem4-4-4 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>🔗 Step 4: CompleteQueryImplement</h4>
            <div class="concept-content">
              <p><strong>Complete solution:</strong> JoinpatientTableGetpatientname</p>

              <div class="sql-container">
                <pre><code class="sql">
-- CompleteProblem 4.4Solutionsolution
SELECT
    p.patient_id,
    p.name as patient_name,
    DATE(a.appointment_datetime) as appointment_date,
    COUNT(*) as appointments_count,
    STRING_AGG(CAST(a.appointment_id AS VARCHAR), ', ') as appointment_ids
FROM Appointments a
JOIN Patients p ON a.patient_id = p.patient_id
GROUP BY p.patient_id, p.name, DATE(a.appointment_datetime)
HAVING COUNT(*) > 1
ORDER BY appointment_date, p.patient_id;
                </code></pre>
              </div>

              <div class="explanation-grid">
                <div class="explanation-item">
                  <h5>🔗 JOINOperation</h5>
                  <p>JoinPatientsTableGetpatientnameinformation</p>
                </div>
                <div class="explanation-item">
                  <h5>📊 STRING_AGG</h5>
                  <p>willsamegroupAppointmentIDUnionand display as string</p>
                </div>
                <div class="explanation-item">
                  <h5>📅 ORDER BY</h5>
                  <p>byDateandpatientIDsortResult</p>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      static showStep5() {
        const contentArea = document.querySelector('#content-problem4-4-4 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>📋 Step 5: QueryResultandbusinessAnalysis</h4>
            <div class="concept-content">
              <div id="result-table-container-44">
                <h5>🎯 Final Result:</h5>
                <table class="data-table result-table">
                  <thead>
                    <tr>
                      <th>patient_id</th>
                      <th>patient_name</th>
                      <th>appointment_date</th>
                      <th>appointments_count</th>
                      <th>appointment_ids</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="highlight-green">
                      <td>3</td>
                      <td>Charlie White</td>
                      <td>2023-10-03</td>
                      <td>2</td>
                      <td>303, 304</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="analysis-container">
                <h5>💡 businessAnalysis:</h5>
                <div class="analysis-grid">
                  <div class="analysis-item">
                    <h6>🏥 hospitalmanagement</h6>
                    <ul>
                      <li>recognizeothercancanscheduling conflict</li>
                      <li>optimizeAppointmentTimearrangement</li>
                      <li>improve resource utilizationuserate</li>
                    </ul>
                  </div>
                  <div class="analysis-item">
                    <h6>📊 dataquality</h6>
                    <ul>
                      <li>detectionduplicateAppointment</li>
                      <li>VerificationAppointmentdepartmentunifiedLogic</li>
                      <li>recognizeidentify anomaliesexecuteforpattern</li>
                    </ul>
                  </div>
                  <div class="analysis-item">
                    <h6>🎯 GROUP BY + HAVING Apply</h6>
                    <ul>
                      <li>suitableuseataggregationdataAnalysis</li>
                      <li>useatdevelopcurrentdatapattern</li>
                      <li>supportholdcomplex statisticsQuery</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="variation-container">
                <h5>🔄 ExtendedApply:</h5>
                <div class="sql-container">
                  <pre><code class="sql">
-- FindsameTimehaveconflictAppointmentsituation
SELECT
    appointment_datetime,
    COUNT(*) as conflict_count,
    STRING_AGG(CAST(patient_id AS VARCHAR), ', ') as patients
FROM Appointments
WHERE status != 'Cancelled'
GROUP BY appointment_datetime
HAVING COUNT(*) > 1;

-- statisticsEachpatienttotalAppointmentfrequency
SELECT
    p.name,
    COUNT(*) as total_appointments,
    COUNT(DISTINCT DATE(a.appointment_datetime)) as unique_days
FROM Appointments a
JOIN Patients p ON a.patient_id = p.patient_id
GROUP BY p.patient_id, p.name
HAVING COUNT(*) > 3  -- Appointmentexceed3timepatient
ORDER BY total_appointments DESC;
                  </code></pre>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Problem 4.5: Advanced aggregation query
    class Problem45 {
      static init() {
        AppState.currentStep = 1;
        const container = document.querySelector('#content-problem4-4-5 .step-controls');

        if (!container) {
          console.error('Problem45: Container not found!');
          return;
        }

        Problem45.addKeyboardListener();

        container.innerHTML = `
          <div class="step-navigation">
            <button class="step-btn prev-btn" onclick="Problem45.previousStep()" disabled>← Previous</button>
            <div class="step-indicator">
              <span class="current-step">1</span> / 5
            </div>
            <button class="step-btn next-btn" onclick="Problem45.nextStep()">Next →</button>
          </div>
          <div class="step-info">
            <h3>Problem 4.5: Find the most frequently prescribed medication</h3>
            <p>Count the most frequently prescribed medication using GROUP BY and COUNT aggregation functions</p>
          </div>
        `;

        Problem45.showStep1();
      }

      static addKeyboardListener() {
        Problem45.keyboardHandler = (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          if (e.key === 'ArrowLeft') {
            Problem45.previousStep();
          } else if (e.key === 'ArrowRight') {
            Problem45.nextStep();
          }
        };
        document.addEventListener('keydown', Problem45.keyboardHandler);
      }

      static removeKeyboardListener() {
        if (Problem45.keyboardHandler) {
          document.removeEventListener('keydown', Problem45.keyboardHandler);
          Problem45.keyboardHandler = null;
        }
      }

      static previousStep() {
        if (AppState.currentStep > 1) {
          Problem45.showStep(AppState.currentStep - 1);
        }
      }

      static nextStep() {
        if (AppState.currentStep < 5) {
          Problem45.showStep(AppState.currentStep + 1);
        }
      }

      static showStep(step) {
        AppState.currentStep = step;
        const container = document.querySelector('#content-problem4-4-5 .step-controls');
        const indicator = container.querySelector('.step-indicator .current-step');
        const prevBtn = container.querySelector('.prev-btn');
        const nextBtn = container.querySelector('.next-btn');

        indicator.textContent = step;
        prevBtn.disabled = (step === 1);
        nextBtn.disabled = (step === 5);

        container.querySelectorAll('.step-btn').forEach((btn, index) => {
          btn.classList.toggle('active', index + 1 === step);
        });

        // Clear previous highlights
        document.querySelectorAll('#content-problem4-4-5 table td, #content-problem4-4-5 table tr').forEach(el => {
          el.classList.remove('highlight', 'highlight-blue', 'highlight-green', 'highlight-yellow');
        });

        const resultContainer = document.querySelector('#content-problem4-4-5 #result-table-container-45');
        if (resultContainer) resultContainer.remove();

        switch(step) {
          case 1: Problem45.showStep1(); break;
          case 2: Problem45.showStep2(); break;
          case 3: Problem45.showStep3(); break;
          case 4: Problem45.showStep4(); break;
          case 5: Problem45.showStep5(); break;
        }
      }

      static showStep1() {
        const contentArea = document.querySelector('#content-problem4-4-5 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>💊 Step 1: Understanding problem requirements</h4>
            <div class="concept-content">
              <p><strong>Goal:</strong> findoutprescriptionTableinmost commonopenmedication</p>
              <p><strong>AnalysisMethod:</strong></p>
              <ul>
                <li>statisticseachtypemedicationprescriptiontimenumber</li>
                <li>byfrequencyfallorder sorting</li>
                <li>Gethighest frequencyhighrecords</li>
              </ul>

              <div class="table-container">
                <h5>📋 Prescriptions Tabledata:</h5>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>prescription_id</th>
                      <th>appointment_id</th>
                      <th>medication</th>
                      <th>dosage</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>401</td>
                      <td>301</td>
                      <td class="highlight-yellow">Amlodipine</td>
                      <td>10mg/day</td>
                    </tr>
                    <tr>
                      <td>402</td>
                      <td>302</td>
                      <td class="highlight-blue">Ibuprofen</td>
                      <td>400mg</td>
                    </tr>
                    <tr>
                      <td>403</td>
                      <td>303</td>
                      <td class="highlight-green">Aspirin</td>
                      <td>81mg/day</td>
                    </tr>
                    <tr>
                      <td>404</td>
                      <td>305</td>
                      <td class="highlight-green">Aspirin</td>
                      <td>81mg/day</td>
                    </tr>
                    <tr>
                      <td>405</td>
                      <td>306</td>
                      <td class="highlight-green">Aspirin</td>
                      <td>100mg/day</td>
                    </tr>
                  </tbody>
                </table>
                <p class="note">💡 attention：Aspirinoutcurrent3time，most frequentmedication</p>
              </div>
            </div>
          </div>
        `;
      }

      static showStep2() {
        const contentArea = document.querySelector('#content-problem4-4-5 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>📊 Step 2: GROUP BY Groupstatistics</h4>
            <div class="concept-content">
              <p><strong>Groupstrategy:</strong> bymedicationnameGroupandcountnumber</p>

              <div class="sql-container">
                <pre><code class="sql">
-- bymedicationnameGroupand countoutcurrenttimenumber
SELECT
    medication,
    COUNT(*) as prescription_count
FROM Prescriptions
GROUP BY medication
                </code></pre>
              </div>

              <div class="table-container">
                <h5>📈 GroupstatisticsResult:</h5>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>medication</th>
                      <th>prescription_count</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Amlodipine</td>
                      <td class="highlight-yellow">1</td>
                    </tr>
                    <tr>
                      <td>Ibuprofen</td>
                      <td class="highlight-blue">1</td>
                    </tr>
                    <tr class="highlight-green">
                      <td>Aspirin</td>
                      <td><strong>3</strong></td>
                    </tr>
                  </tbody>
                </table>
                <p class="note">✅ Aspirinwith3timeprescriptionleadfirst</p>
              </div>
            </div>
          </div>
        `;
      }

      static showStep3() {
        const contentArea = document.querySelector('#content-problem4-4-5 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>🎯 Step 3: sortandfilter</h4>
            <div class="concept-content">
              <p><strong>Getmosthighfrequency:</strong> UseORDER BYandLIMITfindoutmost commonusemedication</p>

              <div class="comparison-container">
                <div class="comparison-item">
                  <h5>🔝 PostgreSQLMethod</h5>
                  <ul>
                    <li><code>ORDER BY COUNT(*) DESC</code></li>
                    <li><code>LIMIT 1</code> - Getnumberoneexecute</li>
                    <li>handleparallelnumberfirst situation</li>
                  </ul>
                </div>
              </div>

              <div class="sql-container">
                <pre><code class="sql">
SELECT
    medication,
    COUNT(*) as prescription_count
FROM Prescriptions
GROUP BY medication
<span class="highlight-green">ORDER BY prescription_count DESC</span>
<span class="highlight-blue">LIMIT 1</span>;  -- Gethighest frequencyhighmedication
                </code></pre>
              </div>

              <div class="table-container">
                <h5>🏆 Final Result:</h5>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>medication</th>
                      <th>prescription_count</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="highlight-green">
                      <td><strong>Aspirin</strong></td>
                      <td><strong>3</strong></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;
      }

      static showStep4() {
        const contentArea = document.querySelector('#content-problem4-4-5 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>🔗 Step 4: highlevelQuerytechnologyskillful</h4>
            <div class="concept-content">
              <p><strong>handleparallel situations:</strong> whenmanytypemedicationhaveSamemosthighfrequency when</p>

              <div class="sql-container">
                <pre><code class="sql">
-- Method1: UsewindowFunction (PostgreSQL)
WITH RankedMedications AS (
    SELECT
        medication,
        COUNT(*) as prescription_count,
        RANK() OVER (ORDER BY COUNT(*) DESC) as rank
    FROM Prescriptions
    GROUP BY medication
)
SELECT
    medication,
    prescription_count
FROM RankedMedications
WHERE rank = 1;

-- Method2: UsesubQuery
SELECT
    medication,
    COUNT(*) as prescription_count
FROM Prescriptions
GROUP BY medication
HAVING COUNT(*) = (
    SELECT MAX(med_count)
    FROM (
        SELECT COUNT(*) as med_count
        FROM Prescriptions
        GROUP BY medication
    ) as counts
);
                </code></pre>
              </div>

              <div class="explanation-grid">
                <div class="explanation-item">
                  <h5>🪟 windowFunction</h5>
                  <p>RANK()Canhandleparallelnumberfirst situation</p>
                </div>
                <div class="explanation-item">
                  <h5>📊 Subquery method</h5>
                  <p>first find mostlargevalues，againfiltermatchrecords</p>
                </div>
                <div class="explanation-item">
                  <h5>⚡ propertycanconsiderconsider</h5>
                  <p>windowFunctionusually morehigheffective</p>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      static showStep5() {
        const contentArea = document.querySelector('#content-problem4-4-5 .content-area');
        contentArea.innerHTML = `
          <div class="concept-card">
            <h4>📋 Step 5: CompleteAnalysisandApply</h4>
            <div class="concept-content">
              <div id="result-table-container-45">
                <h5>🏆 most commonusemedicationstatistics:</h5>
                <table class="data-table result-table">
                  <thead>
                    <tr>
                      <th>arrangename</th>
                      <th>medicationname</th>
                      <th>prescriptiontimenumber</th>
                      <th>occupythan</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="highlight-green">
                      <td>1</td>
                      <td><strong>Aspirin</strong></td>
                      <td>3</td>
                      <td>60%</td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td>Amlodipine</td>
                      <td>1</td>
                      <td>20%</td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td>Ibuprofen</td>
                      <td>1</td>
                      <td>20%</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="analysis-container">
                <h5>💡 businessAnalysis:</h5>
                <div class="analysis-grid">
                  <div class="analysis-item">
                    <h6>💊 pharmacymanagement</h6>
                    <ul>
                      <li>optimize inventory management</li>
                      <li>predictionmedicationrequirement</li>
                      <li>confirmprotectcommonusemedicine sufficient</li>
                    </ul>
                  </div>
                  <div class="analysis-item">
                    <h6>📊 datainsight</h6>
                    <ul>
                      <li>recognizedifferent prescription patterns</li>
                      <li>Analysisdiseasesicktrend</li>
                      <li>supportholdclinicaldecidepolicy</li>
                    </ul>
                  </div>
                  <div class="analysis-item">
                    <h6>💰 become bookscontrolmake</h6>
                    <ul>
                      <li>bulk purchase of commonusemedicine</li>
                      <li>optimizesupply chain</li>
                      <li>falllowinventorybecome books</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="variation-container">
                <h5>🔄 ExtendedQuery:</h5>
                <div class="sql-container">
                  <pre><code class="sql">
-- bydepartmentcoursestatistics most commonusemedication
SELECT
    dep.department_name,
    p.medication,
    COUNT(*) as usage_count
FROM Prescriptions p
JOIN Appointments a ON p.appointment_id = a.appointment_id
JOIN Doctors d ON a.doctor_id = d.doctor_id
JOIN Departments dep ON d.department_id = dep.department_id
GROUP BY dep.department_name, p.medication
ORDER BY dep.department_name, usage_count DESC;
                  </code></pre>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Initialize Navigation System when DOM is ready
    console.log('Script loaded, waiting for DOM...');
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMContentLoaded event fired');
      try {
        const nav = new NavigationSystem();
        console.log('NavigationSystem created successfully');
      } catch(e) {
        console.error('Error creating NavigationSystem:', e);
      }
    });
  </script>
</body>
</html>
